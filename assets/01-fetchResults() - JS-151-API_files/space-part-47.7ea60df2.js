webpackJsonp([25],{"./backend/WebBackend.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./backend/firebase.js");var i=b(n);var o=r("./backend/storages/WebBlobStorage.js");var a=b(o);var s=r("./backend/storages/index.js");var u=r("./backend/database/Database.js");var c=b(u);var l=r("./backend/auth/Auth.js");var h=b(l);var p=r("./backend/Embed.js");var f=b(p);var d=r("./backend/pubsub/WebPubSub.js");var v=b(d);var _=r("./backend/analytics/WebAnalytics.js");var y=b(_);var g=r("./backend/GenericBackend.js");var m=b(g);function b(e){return e&&e.__esModule?e:{default:e}}function E(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o);var s=a.value}catch(e){r(e);return}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function T(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var S=function(e){T(t,e);function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,t);var o=C(this,e.call(this));o.isClient=true;o.config=r;o.app=i.default.initializeApp(r.firebase);o.database=new c.default(o.app.database(),n.onDatabaseState,n.initialDatabaseState);o.storage=new a.default(o.app.storage(),{cdnHost:r.cdn.blobsurl});o.analytics=new y.default(r);o.auth=new h.default(o.app.auth(),o.storage,o.database,o.analytics,{apiEndpoint:r.urls.api,initialUser:n.initialUser,onUser:n.onUser});o.documents=new s.DocumentStore(o.storage);o.assets=new s.AssetStore(o.storage);o.embed=new f.default(r.iframely.key);o.pubsub=new v.default;return o}t.prototype.destroy=function(){var e=E(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return this.app.delete();case 2:case"end":return t.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}();return t}(m.default);t.default=S},"./backend/exports.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.Analytics=t.Database=t.BlobStorage=t.Auth=t.DatabaseState=t.Search=t.StoragePaths=t.PUBSUB_TOPICS=t.CDN=void 0;var n=r("./backend/Search.js");var i=l(n);var o=r("./backend/storages/index.js");var a=r("./backend/database/index.js");var s=r("./backend/auth/index.js");var u=r("./backend/analytics/index.js");var c=r("./backend/pubsub/index.js");function l(e){return e&&e.__esModule?e:{default:e}}t.CDN=o.CDN;t.PUBSUB_TOPICS=c.TOPICS;t.StoragePaths=o.StoragePaths;t.Search=i.default;t.DatabaseState=a.DatabaseState;t.Auth=s.GenericAuth;t.BlobStorage=o.GenericBlobStorage;t.Database=a.GenericDatabase;t.Analytics=u.GenericAnalytics},"./backend/firebase.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/firebase/app/dist/index.cjs.js");var i=o(n);r("./node_modules/firebase/auth/dist/index.esm.js");r("./node_modules/firebase/database/dist/index.esm.js");r("./node_modules/firebase/storage/dist/index.esm.js");function o(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t}t.default=i},"./flux/connectors/authUser.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/react/index.js");var i=v(n);var o=r("./node_modules/hoist-non-react-statics/index.js");var a=d(o);var s=r("./node_modules/react-redux/es/index.js");var u=r("./node_modules/aqueduc/lib/index.js");var c=r("./node_modules/react-display-name/lib/getDisplayName.js");var l=d(c);var h=r("./styleguide/index.js");var p=r("./flux/flux/index.js");var f=d(p);function d(e){return e&&e.__esModule?e:{default:e}}function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function g(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o);var s=a.value}catch(e){r(e);return}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function b(){var e=this;return function(t){var r,n,o,c,p,d;var v=(r=(0,s.connect)(function(e){var t=e.user;return{user:t}}),n=(0,u.connect)(function(e,t){return!t&&!e.user.live},function(){var t=m(regeneratorRuntime.mark(function t(r){var n=r.dispatch,i=r.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return n(f.default.user.signInWithAuthToken(i,{forceSync:true}));case 2:t.next=4;return n(f.default.user.listen());case 4:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}(),function(e,t){var r=t.dispatch;return r(f.default.user.unlisten())}),o=h.Skeleton.createSkeletonProvider(function(e){var t=e.user;if(!t.isLoggedIn)return false;return!t.live}),r(c=n(c=o(c=(d=p=function(e){g(r,e);function r(){_(this,r);return y(this,e.apply(this,arguments))}r.prototype.render=function e(){return i.createElement(t,this.props)};return r}(i.Component),p.displayName="connectAuthUser("+(0,l.default)(t)+")",d))||c)||c)||c);return(0,a.default)(v,t)}}t.default=b},"./flux/connectors/database.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i=r("./node_modules/react/index.js");var o=_(i);var a=r("./node_modules/hoist-non-react-statics/index.js");var s=v(a);var u=r("./node_modules/react-redux/es/index.js");var c=r("./node_modules/aqueduc/lib/index.js");var l=r("./node_modules/react-display-name/lib/getDisplayName.js");var h=v(l);var p=r("./styleguide/index.js");var f=r("./flux/flux/index.js");var d=v(f);function v(e){return e&&e.__esModule?e:{default:e}}function _(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t}function y(e,t){var r={};for(var n in e){if(t.indexOf(n)>=0)continue;if(!Object.prototype.hasOwnProperty.call(e,n))continue;r[n]=e[n]}return r}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function b(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function E(e,t){return e.cacheKey==t.cacheKey}function w(e,t){var r=Object.keys(e);var n=Object.keys(t);return r.some(function(r){return!t[r]||!E(e[r].query,t[r].query)})||n.some(function(r){return!e[r]||!E(e[r].query,t[r].query)})}function C(e){return(0,u.connect)(function(t,r){var n=t.database;var i=e(r);var o={};Object.keys(i).forEach(function(e){var t=i[e];if(!t)return;var r=n.hasObserver(t);var a=n.isFetched(t);o[e]={query:t,isFetched:a,hasObserver:r,error:n.getError(t),value:t.isDocumentQuery()?n.getDocument(t):n.getCollection(t)}});return{queries:o}})}function T(e){return(0,c.connect)(function(e,t){return!t||w(e.queries,t.queries)||e.hasParentLoading!=t.hasParentLoading},function(e){var t=e.dispatch,r=e.queries;if(e.hasParentLoading)return[];var n=[];var i=[];Object.keys(r).forEach(function(e){var o=r[e].query;var a=t(d.default.database.observe(o));a instanceof Promise?n.push(a):i.push(a)});return n.length>0?Promise.all(n).then(function(e){return i.concat(e)}):i},function(e,t){var r=t.dispatch;e.forEach(function(e){r(d.default.database.stopObserving(e))})})}function S(e){return p.Skeleton.createSkeletonProvider(function(e){var t=e.queries;var r=Object.keys(t).some(function(e){var r=t[e];return!r.query.options.background&&r.query.options.placeholder&&!r.isFetched});return r})}function R(e){return function(t){var r,i,a,u,c,l,f;var d=(r=p.Skeleton.connectToSkeleton(function(e){var t=e.isLoading;return{hasParentLoading:t}}),i=C(e),a=T(e),u=S(e),r(c=i(c=a(c=u(c=(f=l=function(e){b(r,e);function r(){g(this,r);return m(this,e.apply(this,arguments))}r.prototype.render=function e(){var r=this.props,i=r.queries,a=y(r,["queries"]);var s={};var u=true;Object.keys(i).forEach(function(e){var t=i[e].query.options,r=t.optimistic,n=t.waitFetched,o=t.background;var a=r?i[e].isFetched:i[e].isFetched&&i[e].hasObserver;s[e]=i[e].value;s[e+"Fetched"]=a;s[e+"Error"]=i[e].error;o||a||!n||(u=false)});if(!u)return null;return o.createElement(t,n({},s,a))};return r}(o.Component),l.displayName="connectToDatabase("+(0,h.default)(t)+")",f))||c)||c)||c)||c);return(0,s.default)(d,t)}}t.default=R},"./flux/connectors/graphQL.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i=r("./node_modules/react/index.js");var o=v(i);var a=r("./node_modules/immutable/dist/immutable.js");var s=r("./node_modules/hoist-non-react-statics/index.js");var u=d(s);var c=r("./node_modules/react-display-name/lib/getDisplayName.js");var l=d(c);var h=r("./node_modules/cancelable-promise/dist/CancelablePromise.js");var p=d(h);var f=r("./styleguide/index.js");function d(e){return e&&e.__esModule?e:{default:e}}function v(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function g(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){return e.url==t.url&&e.query==t.query&&(0,a.Map)(e.variables||{}).equals((0,a.Map)(t.variables||{}))}var b=function e(t){return t.isFetched?t:null};function E(e){return function(t){var r,i,a;var s=(i=r=function(r){g(i,r);function i(t){_(this,i);var o=y(this,r.call(this,t));a.call(o);o.pending={};var s=e(t);o.state=Object.keys(s).reduce(function(e,t,r){var i;return n({},e,(i={},i[t]={query:s[t],isFetched:false,errors:[],data:{}},i))},{});return o}i.prototype.componentDidMount=function e(){this.fetchQueries(this.props)};i.prototype.componentWillReceiveProps=function e(t){this.fetchQueries(t)};i.prototype.componentWillUnmount=function e(){var t=this;Object.keys(this.pending).forEach(function(e){return t.pending[e].cancel()})};i.prototype.render=function e(){var r=this;var i={isGraphQLLoading:false};var a=true;Object.keys(this.state).forEach(function(e){var t=r.state[e];i[e]=(t.query.mapState||b)(t);t.query.background||(i.isGraphQLLoading=i.isGraphQLLoading||!t.isFetched);void 0===i[e]&&(a=false)});if(!a)return null;return o.createElement(t,n({},i,this.props))};return i}(o.Component),r.displayName="connectToGraphQL("+(0,l.default)(t)+")",a=function t(){var r=this;this.state={};this.fetchQueries=function(t){if(t.hasParentLoading)return;var i=r.state;var o=e(t);Object.keys(o).forEach(function(e){var t=o[e];var n=i[e];if(n&&m(n.query,t)&&(r.pending[e]||n.isFetched))return;r.fetchQuery(e,t)});Object.keys(i).forEach(function(e){o[e]||r.setState(function(t){var r=n({},t);delete r[e];return r})})};this.fetchQuery=function(e,t){r.setState(function(r){var n;return n={},n[e]={query:t,data:{},isFetched:false,errors:[]},n});r.pending[e]=new p.default(function(e){e(fetch(t.url,{method:"post",headers:n({},t.headers||{},{"Content-Type":"application/json"}),body:JSON.stringify({query:t.query,operationName:t.operationName,variables:t.variables})}))}).then(function(e){return e.json()}).then(function(n){var i=n.data,o=n.errors;delete r.pending[e];r.setState(function(r){var n;return n={},n[e]={query:t,data:i,errors:o,isFetched:true},n})},function(n){delete r.pending[e];r.setState(function(r){var i;return i={},i[e]={query:t,data:r[e]?r[e].data:{},isFetched:true,errors:[{message:n.message}]},i})})}},i);return s}}function w(e){var t=f.Skeleton.connectToSkeleton(function(e){var t=e.isLoading;return{hasParentLoading:t}});var r=E(e);var n=f.Skeleton.createSkeletonProvider(function(e){return e.isGraphQLLoading});return function(e){var i=t(r(n(e)));return(0,u.default)(i,e)}}t.default=w},"./flux/connectors/index.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./flux/connectors/authUser.js");var i=c(n);var o=r("./flux/connectors/database.js");var a=c(o);var s=r("./flux/connectors/graphQL.js");var u=c(s);function c(e){return e&&e.__esModule?e:{default:e}}var l={authUser:i.default,database:a.default,graphQL:u.default};t.default=l},"./flux/flux/analytics.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(){return function(e,t,r){var n=r.analytics;return n.page()}}function i(e){return function(t,r,n){var i=n.analytics;return i.group(e)}}t.default={trackPage:n,trackGroup:i}},"./flux/flux/auth.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};var i=r("./node_modules/urljoin.js/dist/index.js");var o=l(i);var a=r("../node_modules/url/url.js");var s=l(a);var u=r("../node_modules/querystring-es3/index.js");var c=l(u);function l(e){return e&&e.__esModule?e:{default:e}}function h(e){return s.default.parse(e).pathname||""}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return function(r,i,a){var u=a.auth,l=a.config;var p=i(),f=p.user;if(!f.isLoggedIn)return;var d=(0,o.default)(e,h(t));var v=s.default.parse(t).search;var _=c.default.stringify(n({},c.default.parse(v?v.replace("?",""):""),{id_token:f.idToken}));window.location=d+"?"+_}}function f(e){var t=e.org,r=e.pathname,n=void 0===r?"":r;var i="/@"+t.baseDomain+"/";var a=(0,o.default)(i,h(n));return v(a)}function d(e){var t=e.org,r=e.space,n=e.pathname,i=void 0===n?"":n;return function(e,n,o){var a=o.auth,s=o.config;var u=n(),c=u.user;if(!c.isLoggedIn)return;var l=r.getURL(t,s.domains.spaces);return e(p(l,i))}}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";return function(t,r,n){var i=n.auth,o=n.config;var a=r(),s=a.user;if(!s.isLoggedIn)return;return t(p(o.urls.website,e))}}t.default={redirectToSpace:d,redirectToOrg:f,redirectToWebsite:v}},"./flux/flux/config.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e,t){return e}t.default={reducer:n}},"./flux/flux/database.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n="database/updated";function i(e){return function(t,r,n){var i=n.database.observe(e),o=i.pending,a=i.observerID;if(!o)return a;return o.then(function(){return a})}}function o(e){return function(t,r,n){n.database.stopObserving(e)}}function a(e){return{type:n,database:e}}function s(e,t){switch(t.type){case n:return t.database;default:return e}}t.default={reducer:s,updateDatabase:a,observe:i,stopObserving:o}},"./flux/flux/embed.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e){return function(t,r,n){var i=n.embed;return i.fetch(e)}}t.default={fetch:n}},"./flux/flux/index.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./flux/flux/database.js");var i=E(n);var o=r("./flux/flux/user.js");var a=E(o);var s=r("./flux/flux/config.js");var u=E(s);var c=r("./flux/flux/embed.js");var l=E(c);var h=r("./flux/flux/auth.js");var p=E(h);var f=r("./flux/flux/space.js");var d=E(f);var v=r("./flux/flux/organization.js");var _=E(v);var y=r("./flux/flux/analytics.js");var g=E(y);var m=r("./flux/flux/invites.js");var b=E(m);function E(e){return e&&e.__esModule?e:{default:e}}t.default={auth:p.default,database:i.default,user:a.default,config:u.default,embed:l.default,space:d.default,organization:_.default,analytics:g.default,invites:b.default}},"./flux/flux/invites.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});r("./node_modules/immutable/dist/immutable.js");var n=r("./core/index.js");function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o);var s=a.value}catch(e){r(e);return}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function o(e,t,r){var o=this;return function(){var a=i(regeneratorRuntime.mark(function i(a,s,u){var c=u.analytics,l=u.database;var h,p,f;return regeneratorRuntime.wrap(function i(o){while(1)switch(o.prev=o.next){case 0:h=s(),p=h.user;f=t.teamID&&r?r.updateFromTeamInvite(t):n.Membership.createForInvite(p.uid,t);o.next=4;return l.commit(f.toUpdate(e.uid));case 4:c.trackJoinOrg({org:e,role:f.role,isTeam:t.isTeam});case 5:case"end":return o.stop()}},i,o)}));return function(e,t,r){return a.apply(this,arguments)}}()}function a(e,t,r){return function(i,o,a){var s=n.Invite.getNewInvitesUpdate(e.uid,r&&r.uid);t.forEach(function(t){s.delete(t.query(e.uid))});return a.database.commit(s)}}t.default={useInvite:o,revokeInvites:a}},"./flux/flux/organization.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./core/index.js");function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o);var s=a.value}catch(e){r(e);return}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function o(e,t,r){var n=this;return function(){var o=i(regeneratorRuntime.mark(function i(o,a,s){var u=s.database,c=s.analytics;return regeneratorRuntime.wrap(function n(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return u.setDocument(r.query(),r);case 2:r.isUpgrade(t)?c.trackUpgrade(e,t.plan,r.plan):r.isDowngrade(t)&&c.trackDowngrade(e,t.plan,r.plan);case 3:case"end":return i.stop()}},i,n)}));return function(e,t,r){return o.apply(this,arguments)}}()}function a(e,t){var r=this;return function(){var o=i(regeneratorRuntime.mark(function i(o,a,s){var u=s.database;var c,l;return regeneratorRuntime.wrap(function r(i){while(1)switch(i.prev=i.next){case 0:c=a(),l=c.user;i.next=3;return Promise.all(e.githubBooks.toArray().map(function(e){var r=n.GitHubConfig.create({token:t,repoID:e.repoID,createdBy:l.uid});return u.commit(r.toCreateUpdate(e.spaceID))}));case 3:i.next=5;return u.commit(e.merge({githubSync:true}).toSyncUpdate());case 5:case"end":return i.stop()}},i,r)}));return function(e,t,r){return o.apply(this,arguments)}}()}function s(e,t){var r=this;return function(){var n=i(regeneratorRuntime.mark(function n(i,o,a){var s=a.database;return regeneratorRuntime.wrap(function r(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return s.commit(t.toUpdate(e.uid));case 2:case"end":return n.stop()}},n,r)}));return function(e,t,r){return n.apply(this,arguments)}}()}function u(e,t){var r=this;return function(){var n=i(regeneratorRuntime.mark(function n(i,o,a){var s=a.database;return regeneratorRuntime.wrap(function r(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return s.commit(t.toRemoveUpdate(e.uid));case 2:case"end":return n.stop()}},n,r)}));return function(e,t,r){return n.apply(this,arguments)}}()}function c(e,t){var r=this;return function(){var n=i(regeneratorRuntime.mark(function n(i,o,a){var s=a.database,u=a.analytics;return regeneratorRuntime.wrap(function r(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return s.commit(t.merge({confirmed:true}).toSyncUpdate());case 2:u.trackConfirmMigration(e);case 3:case"end":return n.stop()}},n,r)}));return function(e,t,r){return n.apply(this,arguments)}}()}function l(e,t){var r=this;return function(){var n=i(regeneratorRuntime.mark(function n(i,o,a){var s=a.database,u=a.analytics;return regeneratorRuntime.wrap(function r(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return s.commit(t.merge({confirmed:false}).toSyncUpdate());case 2:u.trackRollbackMigration(e);case 3:case"end":return n.stop()}},n,r)}));return function(e,t,r){return n.apply(this,arguments)}}()}function h(e,t){var r=this;var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){var o=i(regeneratorRuntime.mark(function i(o,a,s){var u=s.database;var c;return regeneratorRuntime.wrap(function r(i){while(1)switch(i.prev=i.next){case 0:c=n?t.importAllBranches():t.importDefaultBranch();i.next=3;return u.commit(e.updateBook(c).toSyncUpdate());case 3:case"end":return i.stop()}},i,r)}));return function(e,t,r){return o.apply(this,arguments)}}()}function p(e){var t=this;var r=e.user,n=e.org;return function(){var e=i(regeneratorRuntime.mark(function e(i,o,a){var s=a.analytics,u=a.config;var c;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:c=u.urls.website+"/export/org/"+n.uid+"?token="+r.idToken;t.next=3;return s.trackExportOrg(n);case 3:window.open(c,"_blank");case 4:case"end":return t.stop()}},e,t)}));return function(t,r,n){return e.apply(this,arguments)}}()}t.default={updateBillingConfig:o,updateSAMLIdP:s,disableSAML:u,migrateGitHubSync:a,confirmMigration:c,rollbackMigration:l,migrateBook:h,exportContent:p}},"./flux/flux/space.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/immutable/dist/immutable.js");var i=r("./core/index.js");var o=r("./backend/index.web.js");function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o);var s=a.value}catch(e){r(e);return}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function s(e,t){return function(r,n,i){var o=i.database;return o.updateDocument(e.query(),{name:t})}}function u(e,t){return function(r,n,i){var o=i.database;return o.updateDocument(e.query(),{colorPrimary:t})}}function c(e,t){return function(r,n,i){var o=i.database;return o.commit(e.merge({links:t}).toLinksUpdate())}}function l(e,t,r){var n=this;return function(){var i=a(regeneratorRuntime.mark(function i(o,a,s){var u=s.database,c=s.analytics;return regeneratorRuntime.wrap(function n(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return u.commit(t.toCustomDomainUpdate(r));case 2:c.trackSetupCustomDomain(e,t);case 3:case"end":return i.stop()}},i,n)}));return function(e,t,r){return i.apply(this,arguments)}}()}function h(e,t){return function(r,n,i){var o=i.database;return o.commit(e.toBaseNameUpdate(t))}}function p(e,t){return function(r,n,i){var a=i.database,s=i.storage,u=i.auth;var c=o.StoragePaths.spaceUpload({spaceID:e.uid,filename:t.name});return s.uploadFile(c,t,{user:u.getCurrentUser()}).then(function(t){return a.updateDocument(e.query(),{logoURL:t.downloadURL})})}}function f(e,t){var r=t.githubConfig,n=t.editOnGitHub;return function(t,i,o){var a=o.database;var s=i(),u=s.user;var c=r.merge({createdBy:u.uid});return a.commit(c.toCreateUpdate(e.uid,n))}}function d(e,t){return function(r,n,i){var o=i.database;return o.commit(t.toRemoveUpdate(e.uid))}}function v(e,t,r){return function(n,i,o){var a=o.database;return a.commit(t.merge({importBranchesFilter:r}).toUpdate(e.uid))}}function _(e,t){return function(r,n,i){var o=i.database;var a=t.toDeleteUpdate();e.defaultSpace===t.uid&&a.update(e.query(),{defaultSpace:null});return o.commit(a)}}function y(e,t){return function(r,n,i){var o=i.database;return o.updateDocument(e.query(),{googleAnalyticsID:t||null})}}function g(e,t){return function(r,n,i){var o=i.database;return o.updateDocument(e.query(),{intercomID:t||null})}}function m(e,t){return function(r,n,i){var o=i.database;return o.commit(e.setVisibility(t).toVisibilityUpdate())}}function b(e,t){return function(r,n,i){var o=i.database;return o.updateDocument(e.query(),{isUnlisted:t})}}function E(e){var t=e.org,r=e.spaceID,n=e.value,i=e.team;return function(e,o,a){var s;var u=a.database;if(i){var c;return u.updateDocument(i.query(t.uid),{spacesPermission:(n?i.spacesPermission.delete(r):i.spacesPermission.merge((c={},c[r]=false,c))).toJS()})}return u.updateDocument(t.query(),{spacesPermission:(n?t.spacesPermission.delete(r):t.spacesPermission.merge((s={},s[r]=false,s))).toJS()})}}function w(e){var t=this;var r=e.user,n=e.space,i=e.org;return function(){var e=a(regeneratorRuntime.mark(function e(o,a,s){var u=s.analytics,c=s.config;var l;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:l=c.urls.website+"/export/space/"+n.uid+"?token="+r.idToken;t.next=3;return u.trackExportSpace(i,n);case 3:window.open(l,"_blank");case 4:case"end":return t.stop()}},e,t)}));return function(t,r,n){return e.apply(this,arguments)}}()}function C(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(r,n,i){var o=i.database;return o.commit(e.toSecretTokenUpdate(t))}}t.default={updateName:s,updateColorPrimary:u,updateLinks:c,updateCustomDomain:l,updateBaseName:h,updateSecretToken:C,uploadLogo:p,configureGitHubSync:f,unlinkGitHubSync:d,updateGitHubImportBranchFilters:v,deleteSpace:_,updateGoogleAnalyticsID:y,updateIntercomID:g,updateVisibility:m,updateUnlisted:b,updateSpacePermissions:E,exportContent:w}},"./flux/flux/user.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("../node_modules/querystring-es3/index.js");var i=a(n);var o=r("./core/index.js");function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(i,o){try{var a=t[i](o);var s=a.value}catch(e){r(e);return}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var u="user/updated";function c(e){return{type:u,user:e}}function l(){return function(e,t,r){var n=r.auth;return n.listen()}}function h(){return function(e,t,r){var n=r.auth;n.unlisten()}}function p(e,t){switch(t.type){case u:return t.user;default:return e}}function f(e,t){var r=this;return function(){var n=s(regeneratorRuntime.mark(function n(i,o,a){var s=a.auth;return regeneratorRuntime.wrap(function r(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return s.signIn(e,t);case 2:case"end":return n.stop()}},n,r)}));return function(e,t,r){return n.apply(this,arguments)}}()}function d(e,t,r){var n=this;return function(){var i=s(regeneratorRuntime.mark(function i(o,a,s){var u=s.auth,c=s.analytics;return regeneratorRuntime.wrap(function n(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return u.signUp(e,t,r);case 2:case"end":return i.stop()}},i,n)}));return function(e,t,r){return i.apply(this,arguments)}}()}function v(){return function(e,t,r){var n=r.auth;var o=t(),a=o.user;window.location="/?"+i.default.stringify({id_token:a.idToken,auth_action:"signout"})}}function _(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return a.updateEmail(e);case 2:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function y(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return a.verifyEmail(e);case 2:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function g(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return a.updatePassword(e);case 2:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function m(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return a.updateProfile(e);case 2:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function b(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;var s,u;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:s=i(),u=s.user;r.next=3;return a.uploadPhoto(u,e);case 3:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function E(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return a.signInWithAuthToken(e);case 2:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function w(){var e=this;return function(){var t=s(regeneratorRuntime.mark(function t(r,n,i){var o=i.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return o.signInWithGoogle();case 2:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function C(){var e=this;return function(){var t=s(regeneratorRuntime.mark(function t(r,n,i){var o=i.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return o.signInWithGitHub();case 2:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function T(e,t){var r=this;return function(){var n=s(regeneratorRuntime.mark(function n(i,o,a){var s=a.auth;return regeneratorRuntime.wrap(function r(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",s.reauthenticate(e,t));case 1:case"end":return n.stop()}},n,r)}));return function(e,t,r){return n.apply(this,arguments)}}()}function S(){var e=this;for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(){var t=s(regeneratorRuntime.mark(function t(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",a.reauthenticateWithGoogle.apply(a,r));case 1:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function R(){var e=this;for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(){var t=s(regeneratorRuntime.mark(function t(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",a.reauthenticateWithGithub.apply(a,r));case 1:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function N(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return a.resetPassword(e);case 2:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function O(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return a.verifyPasswordResetCode(e);case 2:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function P(e,t){var r=this;return function(){var n=s(regeneratorRuntime.mark(function n(i,o,a){var s=a.auth;return regeneratorRuntime.wrap(function r(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return s.confirmPasswordReset(e,t);case 2:case"end":return n.stop()}},n,r)}));return function(e,t,r){return n.apply(this,arguments)}}()}function I(e){var t=this;return function(){var r=s(regeneratorRuntime.mark(function r(n,i,o){var a=o.auth;return regeneratorRuntime.wrap(function t(r){while(1)switch(r.prev=r.next){case 0:r.next=2;return a.checkActionCode(e);case 2:case"end":return r.stop()}},r,t)}));return function(e,t,n){return r.apply(this,arguments)}}()}function x(e,t){var r=this;return function(){var n=s(regeneratorRuntime.mark(function n(i,o,a){var s=a.auth;return regeneratorRuntime.wrap(function r(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return s.applyActionCode(e,t);case 2:case"end":return n.stop()}},n,r)}));return function(e,t,r){return n.apply(this,arguments)}}()}function k(){var e=this;return function(){var t=s(regeneratorRuntime.mark(function t(r,n,i){var o=i.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return o.linkWithGoogle();case 2:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function A(){var e=this;return function(){var t=s(regeneratorRuntime.mark(function t(r,n,i){var o=i.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return o.linkWithGithub();case 2:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function D(){var e=this;return function(){var t=s(regeneratorRuntime.mark(function t(r,n,i){var o=i.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return o.unlinkGoogle();case 2:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function L(){var e=this;return function(){var t=s(regeneratorRuntime.mark(function t(r,n,i){var o=i.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return o.unlinkGithub();case 2:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function F(){var e=this;return function(){var t=s(regeneratorRuntime.mark(function t(r,n,i){var o=i.auth;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:t.next=2;return o.deleteAccount();case 2:case"end":return t.stop()}},t,e)}));return function(e,r,n){return t.apply(this,arguments)}}()}function j(e){var t=this;var r=e.user;return function(){var e=s(regeneratorRuntime.mark(function e(n,i,o){var a=o.analytics,s=o.config;var u;return regeneratorRuntime.wrap(function e(t){while(1)switch(t.prev=t.next){case 0:u=s.urls.website+"/export/user?token="+r.idToken;t.next=3;return a.trackExportUser(r.uid);case 3:window.open(u,"_blank");case 4:case"end":return t.stop()}},e,t)}));return function(t,r,n){return e.apply(this,arguments)}}()}t.default={reducer:p,updateUser:c,listen:l,unlisten:h,signIn:f,signUp:d,signInWithAuthToken:E,signInWithGoogle:w,signInWithGitHub:C,updateEmail:_,updatePassword:g,updateProfile:m,uploadPhoto:b,verifyEmail:y,signOut:v,reauthenticate:T,reauthenticateWithGoogle:S,reauthenticateWithGithub:R,resetPassword:N,verifyPasswordResetCode:O,confirmPasswordReset:P,checkActionCode:I,applyActionCode:x,linkWithGoogle:k,linkWithGithub:A,unlinkGithub:L,unlinkGoogle:D,deleteAccount:F,exportContent:j}},"./node_modules/@firebase/app/dist/index.cjs.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/@firebase/util/dist/index.cjs.js");var i=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var o="[DEFAULT]";var a=[];var s=function(){function e(e,t,r){this.firebase_=r;this.isDeleted_=false;this.services_={};this.name_=t.name;this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled||false;this.options_=n.deepCopy(e);this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(e){a.push(e);setTimeout(function(){return e(null)},0)},removeAuthTokenListener:function(e){a=a.filter(function(t){return t!==e})}}}Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){this.checkDestroyed_();return this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed_();this._automaticDataCollectionEnabled=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"name",{get:function(){this.checkDestroyed_();return this.name_},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"options",{get:function(){this.checkDestroyed_();return this.options_},enumerable:true,configurable:true});e.prototype.delete=function(){var e=this;return new Promise(function(t){e.checkDestroyed_();t()}).then(function(){e.firebase_.INTERNAL.removeApp(e.name_);var t=[];Object.keys(e.services_).forEach(function(r){Object.keys(e.services_[r]).forEach(function(n){t.push(e.services_[r][n])})});return Promise.all(t.map(function(e){return e.INTERNAL.delete()}))}).then(function(){e.isDeleted_=true;e.services_={}})};e.prototype._getService=function(e,t){void 0===t&&(t=o);this.checkDestroyed_();this.services_[e]||(this.services_[e]={});if(!this.services_[e][t]){var r=t!==o?t:void 0;var n=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),r);this.services_[e][t]=n}return this.services_[e][t]};e.prototype.extendApp=function(e){var t=this;n.deepExtend(this,e);if(e.INTERNAL&&e.INTERNAL.addAuthTokenListener){a.forEach(function(e){t.INTERNAL.addAuthTokenListener(e)});a=[]}};e.prototype.checkDestroyed_=function(){this.isDeleted_&&c("app-deleted",{name:this.name_})};return e}();s.prototype.name&&s.prototype.options||s.prototype.delete||console.log("dc");function u(){var e={};var t={};var r={};var a={__esModule:true,initializeApp:p,app:h,apps:null,Promise:Promise,SDK_VERSION:"5.0.4",INTERNAL:{registerService:d,createFirebaseNamespace:u,extendNamespace:v,createSubscribe:n.createSubscribe,ErrorFactory:n.ErrorFactory,removeApp:l,factories:t,useAsService:y,Promise:Promise,deepExtend:n.deepExtend}};n.patchProperty(a,"default",a);Object.defineProperty(a,"apps",{get:f});function l(t){var r=e[t];_(r,"delete");delete e[t]}function h(t){t=t||o;i(e,t)||c("no-app",{name:t});return e[t]}n.patchProperty(h,"App",s);function p(t,r){void 0===r&&(r={});if("object"!==typeof r||null===r){var n=r;r={name:n}}var u=r;void 0===u.name&&(u.name=o);var l=u.name;"string"===typeof l&&l||c("bad-app-name",{name:l+""});i(e,l)&&c("duplicate-app",{name:l});var h=new s(t,u,a);e[l]=h;_(h,"create");return h}function f(){return Object.keys(e).map(function(t){return e[t]})}function d(e,i,o,u,l){t[e]&&c("duplicate-service",{name:e});t[e]=i;if(u){r[e]=u;f().forEach(function(e){u("create",e)})}var p=function(t){void 0===t&&(t=h());"function"!==typeof t[e]&&c("invalid-app-argument",{name:e});return t[e]()};void 0!==o&&n.deepExtend(p,o);a[e]=p;s.prototype[e]=function(){var t=[];for(var r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this._getService.bind(this,e);return n.apply(this,l?t:[])};return p}function v(e){n.deepExtend(a,e)}function _(e,n){Object.keys(t).forEach(function(t){var i=y(e,t);if(null===i)return;r[i]&&r[i](n,e)})}function y(e,t){if("serverAuth"===t)return null;var r=t;var n=e.options;return r}return a}function c(e,t){throw h.create(e,t)}var l={"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."};var h=new n.ErrorFactory("app","Firebase",l);var p=u();t.firebase=p;t.default=p},"./node_modules/@firebase/database/dist/index.cjs.js":function(e,t,r){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:true});function i(e){return e&&"object"===typeof e&&"default"in e?e["default"]:e}var o=r("./node_modules/@firebase/util/dist/index.cjs.js");var a=r("./node_modules/@firebase/logger/dist/index.esm.js");var s=r("./node_modules/tslib/tslib.es6.js");var u=i(r("./node_modules/@firebase/app/dist/index.cjs.js"));var c=function(){function e(e){this.domStorage_=e;this.prefix_="firebase:"}e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),o.stringify(t))};e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:o.jsonEval(t)};e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))};e.prototype.prefixedName_=function(e){return this.prefix_+e};e.prototype.toString=function(){return this.domStorage_.toString()};return e}();var l=function(){function e(){this.cache_={};this.isInMemoryStorage=true}e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t};e.prototype.get=function(e){if(o.contains(this.cache_,e))return this.cache_[e];return null};e.prototype.remove=function(e){delete this.cache_[e]};return e}();var h=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){var t=window[e];t.setItem("firebase:sentinel","cache");t.removeItem("firebase:sentinel");return new c(t)}}catch(e){}return new l};var p=h("localStorage");var f=h("sessionStorage");var d=new a.Logger("@firebase/database");var v=function(){var e=1;return function(){return e++}}();var _=function(e){var t=o.stringToByteArray(e);var r=new o.Sha1;r.update(t);var n=r.digest();return o.base64.encodeByteArray(n)};var y=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var r="";for(var n=0;n<e.length;n++){Array.isArray(e[n])||e[n]&&"object"===typeof e[n]&&"number"===typeof e[n].length?r+=y.apply(null,e[n]):"object"===typeof e[n]?r+=o.stringify(e[n]):r+=e[n];r+=" "}return r};var g=null;var m=true;var b=function(e,t){o.assert(!t||true===e||false===e,"Can't turn on custom loggers persistently.");if(true===e){d.logLevel=a.LogLevel.VERBOSE;g=d.log.bind(d);t&&f.set("logging_enabled",true)}else if("function"===typeof e)g=e;else{g=null;f.remove("logging_enabled")}};var E=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];if(true===m){m=false;null===g&&true===f.get("logging_enabled")&&b(true)}if(g){var r=y.apply(null,e);g(r)}};var w=function(e){return function(){var t=[];for(var r=0;r<arguments.length;r++)t[r]=arguments[r];E.apply(void 0,[e].concat(t))}};var C=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE INTERNAL ERROR: "+y.apply(void 0,e);d.error(r)};var T=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE FATAL ERROR: "+y.apply(void 0,e);d.error(r);throw new Error(r)};var S=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE WARNING: "+y.apply(void 0,e);d.warn(r)};var R=function(){"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&S("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")};var N=function(e){return"number"===typeof e&&(e!=e||e==Number.POSITIVE_INFINITY||e==Number.NEGATIVE_INFINITY)};var O=function(e){if(o.isNodeSdk()||"complete"===document.readyState)e();else{var t=false;var r=function(){if(!document.body){setTimeout(r,Math.floor(10));return}if(!t){t=true;e()}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",r,false);window.addEventListener("load",r,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&r()});window.attachEvent("onload",r)}}};var P="[MIN_NAME]";var I="[MAX_NAME]";var x=function(e,t){if(e===t)return 0;if(e===P||t===I)return-1;if(t===P||e===I)return 1;var r=V(e),n=V(t);return null!==r?null!==n?r-n==0?e.length-t.length:r-n:-1:null!==n?1:e<t?-1:1};var k=function(e,t){return e===t?0:e<t?-1:1};var A=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+o.stringify(t))};var D=function(e){if("object"!==typeof e||null===e)return o.stringify(e);var t=[];for(var r in e)t.push(r);t.sort();var n="{";for(var i=0;i<t.length;i++){0!==i&&(n+=",");n+=o.stringify(t[i]);n+=":";n+=D(e[t[i]])}n+="}";return n};var L=function(e,t){var r=e.length;if(r<=t)return[e];var n=[];for(var i=0;i<r;i+=t)i+t>r?n.push(e.substring(i,r)):n.push(e.substring(i,i+t));return n};var F=function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;++r)t(r,e[r]);else o.forEach(e,function(e,r){return t(r,e)})};var j=function(e){o.assert(!N(e),"Invalid JSON number");var t=11,r=52;var n=(1<<t-1)-1,i,a,s,u,c,l,h;if(0===e){a=0;s=0;i=1/e===-Infinity?1:0}else{i=e<0;e=Math.abs(e);if(e>=Math.pow(2,1-n)){u=Math.min(Math.floor(Math.log(e)/Math.LN2),n);a=u+n;s=Math.round(e*Math.pow(2,r-u)-Math.pow(2,r))}else{a=0;s=Math.round(e/Math.pow(2,1-n-r))}}l=[];for(c=r;c;c-=1){l.push(s%2?1:0);s=Math.floor(s/2)}for(c=t;c;c-=1){l.push(a%2?1:0);a=Math.floor(a/2)}l.push(i?1:0);l.reverse();h=l.join("");var p="";for(c=0;c<64;c+=8){var f=parseInt(h.substr(c,8),2).toString(16);1===f.length&&(f="0"+f);p+=f}return p.toLowerCase()};var M=function(){return!!("object"===typeof window&&window["chrome"]&&window["chrome"]["extension"]&&!/^chrome/.test(window.location.href))};var U=function(){return"object"===typeof Windows&&"object"===typeof Windows.UI};var W=function(e,t){var r="Unknown Error";"too_big"===e?r="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==e?r="Client doesn't have permission to access the desired data.":"unavailable"==e&&(r="The service is unavailable");var n=new Error(e+" at "+t.path.toString()+": "+r);n.code=e.toUpperCase();return n};var q=new RegExp("^-?\\d{1,10}$");var V=function(e){if(q.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null};var B=function(e){try{e()}catch(e){setTimeout(function(){var t=e.stack||"";S("Exception was thrown by user callback.",t);throw e},Math.floor(0))}};var Q=function(){var e="object"===typeof window&&window["navigator"]&&window["navigator"]["userAgent"]||"";return e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0};var H=function(e,t){var r=setTimeout(e,t);"object"===typeof r&&r["unref"]&&r["unref"]();return r};var G=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");var r=0;for(var n=0;n<this.pieces_.length;n++)if(this.pieces_[n].length>0){this.pieces_[r]=this.pieces_[n];r++}this.pieces_.length=r;this.pieceNum_=0}else{this.pieces_=e;this.pieceNum_=t}}Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:true,configurable:true});e.prototype.getFront=function(){if(this.pieceNum_>=this.pieces_.length)return null;return this.pieces_[this.pieceNum_]};e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_};e.prototype.popFront=function(){var t=this.pieceNum_;t<this.pieces_.length&&t++;return new e(this.pieces_,t)};e.prototype.getBack=function(){if(this.pieceNum_<this.pieces_.length)return this.pieces_[this.pieces_.length-1];return null};e.prototype.toString=function(){var e="";for(var t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"};e.prototype.toUrlEncodedString=function(){var e="";for(var t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"};e.prototype.slice=function(e){void 0===e&&(e=0);return this.pieces_.slice(this.pieceNum_+e)};e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;var t=[];for(var r=this.pieceNum_;r<this.pieces_.length-1;r++)t.push(this.pieces_[r]);return new e(t,0)};e.prototype.child=function(t){var r=[];for(var n=this.pieceNum_;n<this.pieces_.length;n++)r.push(this.pieces_[n]);if(t instanceof e)for(var n=t.pieceNum_;n<t.pieces_.length;n++)r.push(t.pieces_[n]);else{var i=t.split("/");for(var n=0;n<i.length;n++)i[n].length>0&&r.push(i[n])}return new e(r,0)};e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length};e.relativePath=function(t,r){var n=t.getFront(),i=r.getFront();if(null===n)return r;if(n===i)return e.relativePath(t.popFront(),r.popFront());throw new Error("INTERNAL ERROR: innerPath ("+r+") is not within outerPath ("+t+")")};e.comparePaths=function(e,t){var r=e.slice();var n=t.slice();for(var i=0;i<r.length&&i<n.length;i++){var o=x(r[i],n[i]);if(0!==o)return o}if(r.length===n.length)return 0;return r.length<n.length?-1:1};e.prototype.equals=function(e){if(this.getLength()!==e.getLength())return false;for(var t=this.pieceNum_,r=e.pieceNum_;t<=this.pieces_.length;t++,r++)if(this.pieces_[t]!==e.pieces_[r])return false;return true};e.prototype.contains=function(e){var t=this.pieceNum_;var r=e.pieceNum_;if(this.getLength()>e.getLength())return false;while(t<this.pieces_.length){if(this.pieces_[t]!==e.pieces_[r])return false;++t;++r}return true};return e}();var z=function(){function e(e,t){this.errorPrefix_=t;this.parts_=e.slice();this.byteLength_=Math.max(1,this.parts_.length);for(var r=0;r<this.parts_.length;r++)this.byteLength_+=o.stringLength(this.parts_[r]);this.checkValid_()}Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:true,configurable:true});Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:true,configurable:true});e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1);this.parts_.push(e);this.byteLength_+=o.stringLength(e);this.checkValid_()};e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=o.stringLength(e);this.parts_.length>0&&(this.byteLength_-=1)};e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())};e.prototype.toErrorString=function(){if(0==this.parts_.length)return"";return"in property '"+this.parts_.join(".")+"'"};return e}();var K="5";var Y="v";var X="s";var $="r";var J="f";var Z="firebaseio.com";var ee="ls";var te="websocket";var re="long_polling";var ne=function(){function e(e,t,r,n,i){void 0===i&&(i="");this.secure=t;this.namespace=r;this.webSocketOnly=n;this.persistenceKey=i;this.host=e.toLowerCase();this.domain=this.host.substr(this.host.indexOf(".")+1);this.internalHost=p.get("host:"+e)||this.host}e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()};e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)};e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain};e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain};e.prototype.updateHost=function(e){if(e!==this.internalHost){this.internalHost=e;this.isCacheableHost()&&p.set("host:"+this.host,this.internalHost)}};e.prototype.connectionURL=function(e,t){o.assert("string"===typeof e,"typeof type must == string");o.assert("object"===typeof t,"typeof params must == object");var r;if(e===te)r=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==re)throw new Error("Unknown connection type: "+e);r=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t["ns"]=this.namespace);var n=[];o.forEach(t,function(e,t){n.push(e+"="+t)});return r+n.join("&")};e.prototype.toString=function(){var e=this.toURLString();this.persistenceKey&&(e+="<"+this.persistenceKey+">");return e};e.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host};return e}();function ie(e){var t="";var r=e.split("/");for(var n=0;n<r.length;n++)if(r[n].length>0){var i=r[n];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}function oe(e){var t={};"?"===e.charAt(0)&&(e=e.substring(1));for(var r=0,n=e.split("&");r<n.length;r++){var i=n[r];if(0===i.length)continue;var o=i.split("=");2===o.length?t[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):S("Invalid query segment '"+i+"' in query '"+e+"'")}return t}var ae=function(e){var t=se(e),r=t.subdomain;"firebase"===t.domain&&T(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead");r&&"undefined"!=r||"localhost"===t.domain||T("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com");t.secure||R();var n="ws"===t.scheme||"wss"===t.scheme;return{repoInfo:new ne(t.host,t.secure,r,n),path:new G(t.pathString)}};var se=function(e){var t="",r="",n="",i="";var o=true,a="https",s=443;if("string"===typeof e){var u=e.indexOf("//");if(u>=0){a=e.substring(0,u-1);e=e.substring(u+2)}var c=e.indexOf("/");-1===c&&(c=e.length);var l=e.indexOf("?");-1===l&&(l=e.length);t=e.substring(0,Math.min(c,l));c<l&&(i=ie(e.substring(c,l)));var h=oe(e.substring(Math.min(e.length,l)));u=t.indexOf(":");if(u>=0){o="https"===a||"wss"===a;s=parseInt(t.substring(u+1),10)}else u=e.length;var p=t.split(".");if(3===p.length){r=p[1];n=p[0].toLowerCase()}else 2===p.length?r=p[0]:"localhost"===p[0].slice(0,u).toLowerCase()&&(r="localhost");""===n&&"ns"in h&&(n=h["ns"])}return{host:t,port:s,domain:r,subdomain:n,secure:o,scheme:a,pathString:i}};var ue=/[\[\].#$\/\u0000-\u001F\u007F]/;var ce=/[\[\].#$\u0000-\u001F\u007F]/;var le=10485760;var he=function(e){return"string"===typeof e&&0!==e.length&&!ue.test(e)};var pe=function(e){return"string"===typeof e&&0!==e.length&&!ce.test(e)};var fe=function(e){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/"));return pe(e)};var de=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!N(e)||e&&"object"===typeof e&&o.contains(e,".sv")};var ve=function(e,t,r,n,i){if(i&&void 0===r)return;_e(o.errorPrefix(e,t,i),r,n)};var _e=function(e,t,r){var n=r instanceof G?new z(r,e):r;if(void 0===t)throw new Error(e+"contains undefined "+n.toErrorString());if("function"===typeof t)throw new Error(e+"contains a function "+n.toErrorString()+" with contents = "+t.toString());if(N(t))throw new Error(e+"contains "+t.toString()+" "+n.toErrorString());if("string"===typeof t&&t.length>le/3&&o.stringLength(t)>le)throw new Error(e+"contains a string greater than "+le+" utf8 bytes "+n.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){var i=false,a=false;o.forEach(t,function(t,r){if(".value"===t)i=true;else if(".priority"!==t&&".sv"!==t){a=true;if(!he(t))throw new Error(e+" contains an invalid key ("+t+") "+n.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}n.push(t);_e(e,r,n);n.pop()});if(i&&a)throw new Error(e+' contains ".value" child '+n.toErrorString()+" in addition to actual children.")}};var ye=function(e,t){var r,n;for(r=0;r<t.length;r++){n=t[r];var i=n.slice();for(var o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!he(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(G.comparePaths);var a=null;for(r=0;r<t.length;r++){n=t[r];if(null!==a&&a.contains(n))throw new Error(e+"contains a path "+a.toString()+" that is ancestor of another path "+n.toString());a=n}};var ge=function(e,t,r,n,i){if(i&&void 0===r)return;var a=o.errorPrefix(e,t,i);if(!(r&&"object"===typeof r)||Array.isArray(r))throw new Error(a+" must be an object containing the children to replace.");var s=[];o.forEach(r,function(e,t){var r=new G(e);_e(a,t,n.child(r));if(".priority"===r.getBack()&&!de(t))throw new Error(a+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)});ye(a,s)};var me=function(e,t,r,n){if(n&&void 0===r)return;if(N(r))throw new Error(o.errorPrefix(e,t,n)+"is "+r.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!de(r))throw new Error(o.errorPrefix(e,t,n)+"must be a valid Firebase priority (a string, finite number, server value, or null).")};var be=function(e,t,r,n){if(n&&void 0===r)return;switch(r){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(o.errorPrefix(e,t,n)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Ee=function(e,t,r,n){if(n&&void 0===r)return;if(!he(r))throw new Error(o.errorPrefix(e,t,n)+'was an invalid key = "'+r+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')};var we=function(e,t,r,n){if(n&&void 0===r)return;if(!pe(r))throw new Error(o.errorPrefix(e,t,n)+'was an invalid path = "'+r+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};var Ce=function(e,t,r,n){r&&(r=r.replace(/^\/*\.info(\/|$)/,"/"));we(e,t,r,n)};var Te=function(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")};var Se=function(e,t,r){var n=r.path.toString();if(!("string"===typeof r.repoInfo.host)||0===r.repoInfo.host.length||!he(r.repoInfo.namespace)&&"localhost"!==r.repoInfo.host.split(":")[0]||0!==n.length&&!fe(n))throw new Error(o.errorPrefix(e,t,false)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};var Re=function(e,t,r,n){if(n&&void 0===r)return;if("boolean"!==typeof r)throw new Error(o.errorPrefix(e,t,n)+"must be a boolean.")};var Ne=function(){function e(e,t){this.repo_=e;this.path_=t}e.prototype.cancel=function(e){o.validateArgCount("OnDisconnect.cancel",0,1,arguments.length);o.validateCallback("OnDisconnect.cancel",1,e,true);var t=new o.Deferred;this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e));return t.promise};e.prototype.remove=function(e){o.validateArgCount("OnDisconnect.remove",0,1,arguments.length);Te("OnDisconnect.remove",this.path_);o.validateCallback("OnDisconnect.remove",1,e,true);var t=new o.Deferred;this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e));return t.promise};e.prototype.set=function(e,t){o.validateArgCount("OnDisconnect.set",1,2,arguments.length);Te("OnDisconnect.set",this.path_);ve("OnDisconnect.set",1,e,this.path_,false);o.validateCallback("OnDisconnect.set",2,t,true);var r=new o.Deferred;this.repo_.onDisconnectSet(this.path_,e,r.wrapCallback(t));return r.promise};e.prototype.setWithPriority=function(e,t,r){o.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length);Te("OnDisconnect.setWithPriority",this.path_);ve("OnDisconnect.setWithPriority",1,e,this.path_,false);me("OnDisconnect.setWithPriority",2,t,false);o.validateCallback("OnDisconnect.setWithPriority",3,r,true);var n=new o.Deferred;this.repo_.onDisconnectSetWithPriority(this.path_,e,t,n.wrapCallback(r));return n.promise};e.prototype.update=function(e,t){o.validateArgCount("OnDisconnect.update",1,2,arguments.length);Te("OnDisconnect.update",this.path_);if(Array.isArray(e)){var r={};for(var n=0;n<e.length;++n)r[""+n]=e[n];e=r;S("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ge("OnDisconnect.update",1,e,this.path_,false);o.validateCallback("OnDisconnect.update",2,t,true);var i=new o.Deferred;this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t));return i.promise};return e}();var Oe=function(){function e(e,t){this.committed=e;this.snapshot=t}e.prototype.toJSON=function(){o.validateArgCount("TransactionResult.toJSON",0,1,arguments.length);return{committed:this.committed,snapshot:this.snapshot.toJSON()}};return e}();var Pe=function(){var e="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";var t=0;var r=[];return function(n){var i=n===t;t=n;var a;var s=new Array(8);for(a=7;a>=0;a--){s[a]=e.charAt(n%64);n=Math.floor(n/64)}o.assert(0===n,"Cannot push at time == 0");var u=s.join("");if(i){for(a=11;a>=0&&63===r[a];a--)r[a]=0;r[a]++}else for(a=0;a<12;a++)r[a]=Math.floor(64*Math.random());for(a=0;a<12;a++)u+=e.charAt(r[a]);o.assert(20===u.length,"nextPushId: Length should be 20.");return u}}();var Ie=function(){function e(e,t){this.name=e;this.node=t}e.Wrap=function(t,r){return new e(t,r)};return e}();var xe=function(){function e(){}e.prototype.getCompare=function(){return this.compare.bind(this)};e.prototype.indexedValueChanged=function(e,t){var r=new Ie(P,e);var n=new Ie(P,t);return 0!==this.compare(r,n)};e.prototype.minPost=function(){return Ie.MIN};return e}();var ke;var Ae=function(e){s.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return ke},set:function(e){ke=e},enumerable:true,configurable:true});t.prototype.compare=function(e,t){return x(e.name,t.name)};t.prototype.isDefinedOn=function(e){throw o.assertionError("KeyIndex.isDefinedOn not expected to be called.")};t.prototype.indexedValueChanged=function(e,t){return false};t.prototype.minPost=function(){return Ie.MIN};t.prototype.maxPost=function(){return new Ie(I,ke)};t.prototype.makePost=function(e,t){o.assert("string"===typeof e,"KeyIndex indexValue must always be a string.");return new Ie(e,ke)};t.prototype.toString=function(){return".key"};return t}(xe);var De=new Ae;var Le;function Fe(e){Le=e}var je=function(e){return"number"===typeof e?"number:"+j(e):"string:"+e};var Me=function(e){if(e.isLeafNode()){var t=e.val();o.assert("string"===typeof t||"number"===typeof t||"object"===typeof t&&o.contains(t,".sv"),"Priority must be a string or number.")}else o.assert(e===Le||e.isEmpty(),"priority of unexpected type.");o.assert(e===Le||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Ue;var We=function(){function e(t,r){void 0===r&&(r=e.__childrenNodeConstructor.EMPTY_NODE);this.value_=t;this.priorityNode_=r;this.lazyHash_=null;o.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value.");Me(this.priorityNode_)}Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Ue},set:function(e){Ue=e},enumerable:true,configurable:true});e.prototype.isLeafNode=function(){return true};e.prototype.getPriority=function(){return this.priorityNode_};e.prototype.updatePriority=function(t){return new e(this.value_,t)};e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE};e.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE};e.prototype.hasChild=function(){return false};e.prototype.getPredecessorChildName=function(e,t){return null};e.prototype.updateImmediateChild=function(t,r){return".priority"===t?this.updatePriority(r):r.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)};e.prototype.updateChild=function(t,r){var n=t.getFront();if(null===n)return r;if(r.isEmpty()&&".priority"!==n)return this;o.assert(".priority"!==n||1===t.getLength(),".priority must be the last token in a path");return this.updateImmediateChild(n,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),r))};e.prototype.isEmpty=function(){return false};e.prototype.numChildren=function(){return 0};e.prototype.forEachChild=function(e,t){return false};e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()};e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+je(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":";e+="number"===t?j(this.value_):this.value_;this.lazyHash_=_(e)}return this.lazyHash_};e.prototype.getValue=function(){return this.value_};e.prototype.compareTo=function(t){if(t===e.__childrenNodeConstructor.EMPTY_NODE)return 1;if(t instanceof e.__childrenNodeConstructor)return-1;o.assert(t.isLeafNode(),"Unknown node type");return this.compareToLeafNode_(t)};e.prototype.compareToLeafNode_=function(t){var r=typeof t.value_;var n=typeof this.value_;var i=e.VALUE_TYPE_ORDER.indexOf(r);var a=e.VALUE_TYPE_ORDER.indexOf(n);o.assert(i>=0,"Unknown leaf type: "+r);o.assert(a>=0,"Unknown leaf type: "+n);return i===a?"object"===n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:a-i};e.prototype.withIndex=function(){return this};e.prototype.isIndexed=function(){return true};e.prototype.equals=function(e){if(e===this)return true;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return false};e.VALUE_TYPE_ORDER=["object","boolean","number","string"];return e}();var qe;var Ve;function Be(e){qe=e}function Qe(e){Ve=e}var He=function(e){s.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.compare=function(e,t){var r=e.node.getPriority();var n=t.node.getPriority();var i=r.compareTo(n);return 0===i?x(e.name,t.name):i};t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()};t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())};t.prototype.minPost=function(){return Ie.MIN};t.prototype.maxPost=function(){return new Ie(I,new We("[PRIORITY-POST]",Ve))};t.prototype.makePost=function(e,t){var r=qe(e);return new Ie(t,new We("[PRIORITY-POST]",r))};t.prototype.toString=function(){return".priority"};return t}(xe);var Ge=new He;var ze=function(){function e(e,t,r,n,i){void 0===i&&(i=null);this.isReverse_=n;this.resultGenerator_=i;this.nodeStack_=[];var o=1;while(!e.isEmpty()){e=e;o=t?r(e.key,t):1;n&&(o*=-1);if(o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e);e=this.isReverse_?e.right:e.left}}}e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_.pop();var t;t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value};if(this.isReverse_){e=e.left;while(!e.isEmpty()){this.nodeStack_.push(e);e=e.right}}else{e=e.right;while(!e.isEmpty()){this.nodeStack_.push(e);e=e.left}}return t};e.prototype.hasNext=function(){return this.nodeStack_.length>0};e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}};return e}();var Ke=function(){function e(t,r,n,i,o){this.key=t;this.value=r;this.color=null!=n?n:e.RED;this.left=null!=i?i:Xe.EMPTY_NODE;this.right=null!=o?o:Xe.EMPTY_NODE}e.prototype.copy=function(t,r,n,i,o){return new e(null!=t?t:this.key,null!=r?r:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=o?o:this.right)};e.prototype.count=function(){return this.left.count()+1+this.right.count()};e.prototype.isEmpty=function(){return false};e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)};e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)};e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()};e.prototype.minKey=function(){return this.min_().key};e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()};e.prototype.insert=function(e,t,r){var n,i;i=this;n=r(e,i.key);i=n<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===n?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r));return i.fixUp_()};e.prototype.removeMin_=function(){if(this.left.isEmpty())return Xe.EMPTY_NODE;var e=this;e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_());e=e.copy(null,null,null,e.left.removeMin_(),null);return e.fixUp_()};e.prototype.remove=function(e,t){var r,n;r=this;if(t(e,r.key)<0){r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()||(r=r.moveRedLeft_());r=r.copy(null,null,null,r.left.remove(e,t),null)}else{r.left.isRed_()&&(r=r.rotateRight_());r.right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()||(r=r.moveRedRight_());if(0===t(e,r.key)){if(r.right.isEmpty())return Xe.EMPTY_NODE;n=r.right.min_();r=r.copy(n.key,n.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()};e.prototype.isRed_=function(){return this.color};e.prototype.fixUp_=function(){var e=this;e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_());e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_());e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_());return e};e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();if(e.right.left.isRed_()){e=e.copy(null,null,null,null,e.right.rotateRight_());e=e.rotateLeft_();e=e.colorFlip_()}return e};e.prototype.moveRedRight_=function(){var e=this.colorFlip_();if(e.left.left.isRed_()){e=e.rotateRight_();e=e.colorFlip_()}return e};e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)};e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)};e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null);var t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)};e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1};e.prototype.check_=function(){var e;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)};e.RED=true;e.BLACK=false;return e}();var Ye=function(){function e(){}e.prototype.copy=function(e,t,r,n,i){return this};e.prototype.insert=function(e,t,r){return new Ke(e,t,null)};e.prototype.remove=function(e,t){return this};e.prototype.count=function(){return 0};e.prototype.isEmpty=function(){return true};e.prototype.inorderTraversal=function(e){return false};e.prototype.reverseTraversal=function(e){return false};e.prototype.minKey=function(){return null};e.prototype.maxKey=function(){return null};e.prototype.check_=function(){return 0};e.prototype.isRed_=function(){return false};return e}();var Xe=function(){function e(t,r){void 0===r&&(r=e.EMPTY_NODE);this.comparator_=t;this.root_=r}e.prototype.insert=function(t,r){return new e(this.comparator_,this.root_.insert(t,r,this.comparator_).copy(null,null,Ke.BLACK,null,null))};e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Ke.BLACK,null,null))};e.prototype.get=function(e){var t;var r=this.root_;while(!r.isEmpty()){t=this.comparator_(e,r.key);if(0===t)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null};e.prototype.getPredecessorKey=function(e){var t,r=this.root_,n=null;while(!r.isEmpty()){t=this.comparator_(e,r.key);if(0===t){if(r.left.isEmpty())return n?n.key:null;r=r.left;while(!r.right.isEmpty())r=r.right;return r.key}if(t<0)r=r.left;else if(t>0){n=r;r=r.right}}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")};e.prototype.isEmpty=function(){return this.root_.isEmpty()};e.prototype.count=function(){return this.root_.count()};e.prototype.minKey=function(){return this.root_.minKey()};e.prototype.maxKey=function(){return this.root_.maxKey()};e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)};e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)};e.prototype.getIterator=function(e){return new ze(this.root_,null,this.comparator_,false,e)};e.prototype.getIteratorFrom=function(e,t){return new ze(this.root_,e,this.comparator_,false,t)};e.prototype.getReverseIteratorFrom=function(e,t){return new ze(this.root_,e,this.comparator_,true,t)};e.prototype.getReverseIterator=function(e){return new ze(this.root_,null,this.comparator_,true,e)};e.EMPTY_NODE=new Ye;return e}();var $e=Math.log(2);var Je=function(){function e(e){var t=function(e){return parseInt(Math.log(e)/$e,10)};var r=function(e){return parseInt(Array(e+1).join("1"),2)};this.count=t(e+1);this.current_=this.count-1;var n=r(this.count);this.bits_=e+1&n}e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);this.current_--;return e};return e}();var Ze=function(e,t,r,n){e.sort(t);var i=function(t,n){var o=n-t;var a;var s;if(0==o)return null;if(1==o){a=e[t];s=r?r(a):a;return new Ke(s,a.node,Ke.BLACK,null,null)}var u=parseInt(o/2,10)+t;var c=i(t,u);var l=i(u+1,n);a=e[u];s=r?r(a):a;return new Ke(s,a.node,Ke.BLACK,c,l)};var o=function(t){var n=null;var o=null;var a=e.length;var s=function(t,n){var o=a-t;var s=a;a-=t;var c=i(o+1,s);var l=e[o];var h=r?r(l):l;u(new Ke(h,l.node,n,null,c))};var u=function(e){if(n){n.left=e;n=e}else{o=e;n=e}};for(var c=0;c<t.count;++c){var l=t.nextBitIsOne();var h=Math.pow(2,t.count-(c+1));if(l)s(h,Ke.BLACK);else{s(h,Ke.BLACK);s(h,Ke.RED)}}return o};var a=new Je(e.length);var s=o(a);return new Xe(n||t,s)};var et;var tt={};var rt=function(){function e(e,t){this.indexes_=e;this.indexSet_=t}Object.defineProperty(e,"Default",{get:function(){o.assert(tt&&Ge,"ChildrenNode.ts has not been loaded");et=et||new e({".priority":tt},{".priority":Ge});return et},enumerable:true,configurable:true});e.prototype.get=function(e){var t=o.safeGet(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t===tt?null:t};e.prototype.hasIndex=function(e){return o.contains(this.indexSet_,e.toString())};e.prototype.addIndex=function(t,r){o.assert(t!==De,"KeyIndex always exists and isn't meant to be added to the IndexMap.");var n=[];var i=false;var a=r.getIterator(Ie.Wrap);var s=a.getNext();while(s){i=i||t.isDefinedOn(s.node);n.push(s);s=a.getNext()}var u;u=i?Ze(n,t.getCompare()):tt;var c=t.toString();var l=o.clone(this.indexSet_);l[c]=t;var h=o.clone(this.indexes_);h[c]=u;return new e(h,l)};e.prototype.addToIndexes=function(t,r){var n=this;var i=o.map(this.indexes_,function(e,i){var a=o.safeGet(n.indexSet_,i);o.assert(a,"Missing index implementation for "+i);if(e===tt){if(a.isDefinedOn(t.node)){var s=[];var u=r.getIterator(Ie.Wrap);var c=u.getNext();while(c){c.name!=t.name&&s.push(c);c=u.getNext()}s.push(t);return Ze(s,a.getCompare())}return tt}var l=r.get(t.name);var h=e;l&&(h=h.remove(new Ie(t.name,l)));return h.insert(t,t.node)});return new e(i,this.indexSet_)};e.prototype.removeFromIndexes=function(t,r){var n=o.map(this.indexes_,function(e){if(e===tt)return e;var n=r.get(t.name);return n?e.remove(new Ie(t.name,n)):e});return new e(n,this.indexSet_)};return e}();function nt(e,t){return x(e.name,t.name)}function it(e,t){return x(e,t)}var ot;var at=function(){function e(e,t,r){this.children_=e;this.priorityNode_=t;this.indexMap_=r;this.lazyHash_=null;this.priorityNode_&&Me(this.priorityNode_);this.children_.isEmpty()&&o.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}Object.defineProperty(e,"EMPTY_NODE",{get:function(){return ot||(ot=new e(new Xe(it),null,rt.Default))},enumerable:true,configurable:true});e.prototype.isLeafNode=function(){return false};e.prototype.getPriority=function(){return this.priorityNode_||ot};e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)};e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?ot:t};e.prototype.getChild=function(e){var t=e.getFront();if(null===t)return this;return this.getImmediateChild(t).getChild(e.popFront())};e.prototype.hasChild=function(e){return null!==this.children_.get(e)};e.prototype.updateImmediateChild=function(t,r){o.assert(r,"We should always be passing snapshot nodes");if(".priority"===t)return this.updatePriority(r);var n=new Ie(t,r);var i=void 0,a=void 0,s=void 0;if(r.isEmpty()){i=this.children_.remove(t);a=this.indexMap_.removeFromIndexes(n,this.children_)}else{i=this.children_.insert(t,r);a=this.indexMap_.addToIndexes(n,this.children_)}s=i.isEmpty()?ot:this.priorityNode_;return new e(i,s,a)};e.prototype.updateChild=function(e,t){var r=e.getFront();if(null===r)return t;o.assert(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var n=this.getImmediateChild(r).updateChild(e.popFront(),t);return this.updateImmediateChild(r,n)};e.prototype.isEmpty=function(){return this.children_.isEmpty()};e.prototype.numChildren=function(){return this.children_.count()};e.prototype.val=function(t){if(this.isEmpty())return null;var r={};var n=0,i=0,o=true;this.forEachChild(Ge,function(a,s){r[a]=s.val(t);n++;o&&e.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=false});if(!t&&o&&i<2*n){var a=[];for(var s in r)a[s]=r[s];return a}t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val());return r};e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+je(this.getPriority().val())+":");this.forEachChild(Ge,function(t,r){var n=r.hash();""!==n&&(e+=":"+t+":"+n)});this.lazyHash_=""===e?"":_(e)}return this.lazyHash_};e.prototype.getPredecessorChildName=function(e,t,r){var n=this.resolveIndex_(r);if(n){var i=n.getPredecessorKey(new Ie(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)};e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var r=t.minKey();return r&&r.name}return this.children_.minKey()};e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new Ie(t,this.children_.get(t)):null};e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var r=t.maxKey();return r&&r.name}return this.children_.maxKey()};e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new Ie(t,this.children_.get(t)):null};e.prototype.forEachChild=function(e,t){var r=this.resolveIndex_(e);return r?r.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)};e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)};e.prototype.getIteratorFrom=function(e,t){var r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,function(e){return e});var n=this.children_.getIteratorFrom(e.name,Ie.Wrap);var i=n.peek();while(null!=i&&t.compare(i,e)<0){n.getNext();i=n.peek()}return n};e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)};e.prototype.getReverseIteratorFrom=function(e,t){var r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,function(e){return e});var n=this.children_.getReverseIteratorFrom(e.name,Ie.Wrap);var i=n.peek();while(null!=i&&t.compare(i,e)>0){n.getNext();i=n.peek()}return n};e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ut?-1:0};e.prototype.withIndex=function(t){if(t===De||this.indexMap_.hasIndex(t))return this;var r=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,r)};e.prototype.isIndexed=function(e){return e===De||this.indexMap_.hasIndex(e)};e.prototype.equals=function(e){if(e===this)return true;if(e.isLeafNode())return false;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){var r=this.getIterator(Ge);var n=t.getIterator(Ge);var i=r.getNext();var o=n.getNext();while(i&&o){if(i.name!==o.name||!i.node.equals(o.node))return false;i=r.getNext();o=n.getNext()}return null===i&&null===o}return false}return false};e.prototype.resolveIndex_=function(e){return e===De?null:this.indexMap_.get(e.toString())};e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;return e}();var st=function(e){s.__extends(t,e);function t(){return e.call(this,new Xe(it),at.EMPTY_NODE,rt.Default)||this}t.prototype.compareTo=function(e){return e===this?0:1};t.prototype.equals=function(e){return e===this};t.prototype.getPriority=function(){return this};t.prototype.getImmediateChild=function(e){return at.EMPTY_NODE};t.prototype.isEmpty=function(){return false};return t}(at);var ut=new st;Object.defineProperties(Ie,{MIN:{value:new Ie(P,at.EMPTY_NODE)},MAX:{value:new Ie(I,ut)}});Ae.__EMPTY_NODE=at.EMPTY_NODE;We.__childrenNodeConstructor=at;Fe(ut);Qe(ut);var ct=true;function lt(e,t){void 0===t&&(t=null);if(null===e)return at.EMPTY_NODE;"object"===typeof e&&".priority"in e&&(t=e[".priority"]);o.assert(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t);"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]);if("object"!==typeof e||".sv"in e){var r=e;return new We(r,lt(t))}if(e instanceof Array||!ct){var n=at.EMPTY_NODE;var i=e;o.forEach(i,function(e,t){if(o.contains(i,e)&&"."!==e.substring(0,1)){var r=lt(t);!r.isLeafNode()&&r.isEmpty()||(n=n.updateImmediateChild(e,r))}});return n.updatePriority(lt(t))}var a=[];var s=false;var u=e;o.forEach(u,function(e,t){if("string"!==typeof e||"."!==e.substring(0,1)){var r=lt(u[e]);if(!r.isEmpty()){s=s||!r.getPriority().isEmpty();a.push(new Ie(e,r))}}});if(0==a.length)return at.EMPTY_NODE;var c=Ze(a,nt,function(e){return e.name},it);if(s){var l=Ze(a,Ge.getCompare());return new at(c,lt(t),new rt({".priority":l},{".priority":Ge}))}return new at(c,lt(t),rt.Default)}Be(lt);var ht=function(e){s.__extends(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.compare=function(e,t){var r=e.node.compareTo(t.node);return 0===r?x(e.name,t.name):r};t.prototype.isDefinedOn=function(e){return true};t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)};t.prototype.minPost=function(){return Ie.MIN};t.prototype.maxPost=function(){return Ie.MAX};t.prototype.makePost=function(e,t){var r=lt(e);return new Ie(t,r)};t.prototype.toString=function(){return".value"};return t}(xe);var pt=new ht;var ft=function(e){s.__extends(t,e);function t(t){var r=e.call(this)||this;r.indexPath_=t;o.assert(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key");return r}t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)};t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()};t.prototype.compare=function(e,t){var r=this.extractChild(e.node);var n=this.extractChild(t.node);var i=r.compareTo(n);return 0===i?x(e.name,t.name):i};t.prototype.makePost=function(e,t){var r=lt(e);var n=at.EMPTY_NODE.updateChild(this.indexPath_,r);return new Ie(t,n)};t.prototype.maxPost=function(){var e=at.EMPTY_NODE.updateChild(this.indexPath_,ut);return new Ie(I,e)};t.prototype.toString=function(){return this.indexPath_.slice().join("/")};return t}(xe);var dt=function(){function e(e,t,r){this.node_=e;this.ref_=t;this.index_=r}e.prototype.val=function(){o.validateArgCount("DataSnapshot.val",0,0,arguments.length);return this.node_.val()};e.prototype.exportVal=function(){o.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length);return this.node_.val(true)};e.prototype.toJSON=function(){o.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length);return this.exportVal()};e.prototype.exists=function(){o.validateArgCount("DataSnapshot.exists",0,0,arguments.length);return!this.node_.isEmpty()};e.prototype.child=function(t){o.validateArgCount("DataSnapshot.child",0,1,arguments.length);t=String(t);we("DataSnapshot.child",1,t,false);var r=new G(t);var n=this.ref_.child(r);return new e(this.node_.getChild(r),n,Ge)};e.prototype.hasChild=function(e){o.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length);we("DataSnapshot.hasChild",1,e,false);var t=new G(e);return!this.node_.getChild(t).isEmpty()};e.prototype.getPriority=function(){o.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length);return this.node_.getPriority().val()};e.prototype.forEach=function(t){var r=this;o.validateArgCount("DataSnapshot.forEach",1,1,arguments.length);o.validateCallback("DataSnapshot.forEach",1,t,false);if(this.node_.isLeafNode())return false;var n=this.node_;return!!n.forEachChild(this.index_,function(n,i){return t(new e(i,r.ref_.child(n),Ge))})};e.prototype.hasChildren=function(){o.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length);return!this.node_.isLeafNode()&&!this.node_.isEmpty()};Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:true,configurable:true});e.prototype.numChildren=function(){o.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length);return this.node_.numChildren()};e.prototype.getRef=function(){o.validateArgCount("DataSnapshot.ref",0,0,arguments.length);return this.ref_};Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:true,configurable:true});return e}();var vt=function(){function e(e,t,r,n){this.eventType=e;this.eventRegistration=t;this.snapshot=r;this.prevName=n}e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path};e.prototype.getEventType=function(){return this.eventType};e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)};e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+o.stringify(this.snapshot.exportVal())};return e}();var _t=function(){function e(e,t,r){this.eventRegistration=e;this.error=t;this.path=r}e.prototype.getPath=function(){return this.path};e.prototype.getEventType=function(){return"cancel"};e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)};e.prototype.toString=function(){return this.path.toString()+":cancel"};return e}();var yt=function(){function e(e,t,r){this.callback_=e;this.cancelCallback_=t;this.context_=r}e.prototype.respondsTo=function(e){return"value"===e};e.prototype.createEvent=function(e,t){var r=t.getQueryParams().getIndex();return new vt("value",this,new dt(e.snapshotNode,t.getRef(),r))};e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){o.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var r=this.cancelCallback_;return function(){r.call(t,e.error)}}var n=this.callback_;return function(){n.call(t,e.snapshot)}};e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new _t(this,e,t):null};e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)};e.prototype.hasAnyCallback=function(){return null!==this.callback_};return e}();var gt=function(){function e(e,t,r){this.callbacks_=e;this.cancelCallback_=t;this.context_=r}e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;t="children_removed"===t?"child_removed":t;return o.contains(this.callbacks_,t)};e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new _t(this,e,t):null};e.prototype.createEvent=function(e,t){o.assert(null!=e.childName,"Child events should have a childName.");var r=t.getRef().child(e.childName);var n=t.getQueryParams().getIndex();return new vt(e.type,this,new dt(e.snapshotNode,r,n),e.prevName)};e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){o.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var r=this.cancelCallback_;return function(){r.call(t,e.error)}}var n=this.callbacks_[e.eventType];return function(){n.call(t,e.snapshot,e.prevName)}};e.prototype.matches=function(t){if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return true;if(this.context_===t.context_){var r=o.getCount(t.callbacks_);var n=o.getCount(this.callbacks_);if(r===n){if(1===r){var i=o.getAnyKey(t.callbacks_);var a=o.getAnyKey(this.callbacks_);return a===i&&(!t.callbacks_[i]||!this.callbacks_[a]||t.callbacks_[i]===this.callbacks_[a])}return o.every(this.callbacks_,function(e,r){return t.callbacks_[e]===r})}}}return false};e.prototype.hasAnyCallback=function(){return null!==this.callbacks_};return e}();var mt;var bt=function(){function e(e,t,r,n){this.repo=e;this.path=t;this.queryParams_=r;this.orderByCalled_=n}Object.defineProperty(e,"__referenceConstructor",{get:function(){o.assert(mt,"Reference.ts has not been loaded");return mt},set:function(e){mt=e},enumerable:true,configurable:true});e.validateQueryEndpoints_=function(e){var t=null;var r=null;e.hasStart()&&(t=e.getIndexStartValue());e.hasEnd()&&(r=e.getIndexEndValue());if(e.getIndex()===De){var n="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().";var i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){var a=e.getIndexStartName();if(a!=P)throw new Error(n);if("string"!==typeof t)throw new Error(i)}if(e.hasEnd()){var s=e.getIndexEndName();if(s!=I)throw new Error(n);if("string"!==typeof r)throw new Error(i)}}else if(e.getIndex()===Ge){if(null!=t&&!de(t)||null!=r&&!de(r))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else{o.assert(e.getIndex()instanceof ft||e.getIndex()===pt,"unknown index type.");if(null!=t&&"object"===typeof t||null!=r&&"object"===typeof r)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")}};e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")};e.prototype.validateNoPreviousOrderByCall_=function(e){if(true===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")};e.prototype.getQueryParams=function(){return this.queryParams_};e.prototype.getRef=function(){o.validateArgCount("Query.ref",0,0,arguments.length);return new e.__referenceConstructor(this.repo,this.path)};e.prototype.on=function(t,r,n,i){o.validateArgCount("Query.on",2,4,arguments.length);be("Query.on",1,t,false);o.validateCallback("Query.on",2,r,false);var a=e.getCancelAndContextArgs_("Query.on",n,i);if("value"===t)this.onValueEvent(r,a.cancel,a.context);else{var s={};s[t]=r;this.onChildEvent(s,a.cancel,a.context)}return r};e.prototype.onValueEvent=function(e,t,r){var n=new yt(e,t||null,r||null);this.repo.addEventCallbackForQuery(this,n)};e.prototype.onChildEvent=function(e,t,r){var n=new gt(e,t,r);this.repo.addEventCallbackForQuery(this,n)};e.prototype.off=function(e,t,r){o.validateArgCount("Query.off",0,3,arguments.length);be("Query.off",1,e,true);o.validateCallback("Query.off",2,t,true);o.validateContextObject("Query.off",3,r,true);var n=null;var i=null;if("value"===e){var a=t||null;n=new yt(a,null,r||null)}else if(e){if(t){i={};i[e]=t}n=new gt(i,null,r||null)}this.repo.removeEventCallbackForQuery(this,n)};e.prototype.once=function(t,r,n,i){var a=this;o.validateArgCount("Query.once",1,4,arguments.length);be("Query.once",1,t,false);o.validateCallback("Query.once",2,r,true);var s=e.getCancelAndContextArgs_("Query.once",n,i);var u=true;var c=new o.Deferred;c.promise.catch(function(){});var l=function(e){if(u){u=false;a.off(t,l);r&&r.bind(s.context)(e);c.resolve(e)}};this.on(t,l,function(e){a.off(t,l);s.cancel&&s.cancel.bind(s.context)(e);c.reject(e)});return c.promise};e.prototype.limitToFirst=function(t){o.validateArgCount("Query.limitToFirst",1,1,arguments.length);if("number"!==typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)};e.prototype.limitToLast=function(t){o.validateArgCount("Query.limitToLast",1,1,arguments.length);if("number"!==typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)};e.prototype.orderByChild=function(t){o.validateArgCount("Query.orderByChild",1,1,arguments.length);if("$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');we("Query.orderByChild",1,t,false);this.validateNoPreviousOrderByCall_("Query.orderByChild");var r=new G(t);if(r.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new ft(r);var i=this.queryParams_.orderBy(n);e.validateQueryEndpoints_(i);return new e(this.repo,this.path,i,true)};e.prototype.orderByKey=function(){o.validateArgCount("Query.orderByKey",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(De);e.validateQueryEndpoints_(t);return new e(this.repo,this.path,t,true)};e.prototype.orderByPriority=function(){o.validateArgCount("Query.orderByPriority",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Ge);e.validateQueryEndpoints_(t);return new e(this.repo,this.path,t,true)};e.prototype.orderByValue=function(){o.validateArgCount("Query.orderByValue",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(pt);e.validateQueryEndpoints_(t);return new e(this.repo,this.path,t,true)};e.prototype.startAt=function(t,r){void 0===t&&(t=null);o.validateArgCount("Query.startAt",0,2,arguments.length);ve("Query.startAt",1,t,this.path,true);Ee("Query.startAt",2,r,true);var n=this.queryParams_.startAt(t,r);e.validateLimit_(n);e.validateQueryEndpoints_(n);if(this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");if(void 0===t){t=null;r=null}return new e(this.repo,this.path,n,this.orderByCalled_)};e.prototype.endAt=function(t,r){void 0===t&&(t=null);o.validateArgCount("Query.endAt",0,2,arguments.length);ve("Query.endAt",1,t,this.path,true);Ee("Query.endAt",2,r,true);var n=this.queryParams_.endAt(t,r);e.validateLimit_(n);e.validateQueryEndpoints_(n);if(this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new e(this.repo,this.path,n,this.orderByCalled_)};e.prototype.equalTo=function(e,t){o.validateArgCount("Query.equalTo",1,2,arguments.length);ve("Query.equalTo",1,e,this.path,false);Ee("Query.equalTo",2,t,true);if(this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)};e.prototype.toString=function(){o.validateArgCount("Query.toString",0,0,arguments.length);return this.repo.toString()+this.path.toUrlEncodedString()};e.prototype.toJSON=function(){o.validateArgCount("Query.toJSON",0,1,arguments.length);return this.toString()};e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()};e.prototype.queryIdentifier=function(){var e=this.queryObject();var t=D(e);return"{}"===t?"default":t};e.prototype.isEqual=function(t){o.validateArgCount("Query.isEqual",1,1,arguments.length);if(!(t instanceof e)){var r="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(r)}var n=this.repo===t.repo;var i=this.path.equals(t.path);var a=this.queryIdentifier()===t.queryIdentifier();return n&&i&&a};e.getCancelAndContextArgs_=function(e,t,r){var n={cancel:null,context:null};if(t&&r){n.cancel=t;o.validateCallback(e,3,n.cancel,true);n.context=r;o.validateContextObject(e,4,n.context,true)}else if(t)if("object"===typeof t&&null!==t)n.context=t;else{if("function"!==typeof t)throw new Error(o.errorPrefix(e,3,true)+" must either be a cancel callback or a context object.");n.cancel=t}return n};Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:true,configurable:true});return e}();var Et=function(){function e(){this.set={}}e.prototype.add=function(e,t){this.set[e]=null===t||t};e.prototype.contains=function(e){return o.contains(this.set,e)};e.prototype.get=function(e){return this.contains(e)?this.set[e]:void 0};e.prototype.remove=function(e){delete this.set[e]};e.prototype.clear=function(){this.set={}};e.prototype.isEmpty=function(){return o.isEmpty(this.set)};e.prototype.count=function(){return o.getCount(this.set)};e.prototype.each=function(e){o.forEach(this.set,function(t,r){return e(t,r)})};e.prototype.keys=function(){var e=[];o.forEach(this.set,function(t){e.push(t)});return e};return e}();var wt=function(){function e(){this.value_=null;this.children_=null}e.prototype.find=function(e){if(null!=this.value_)return this.value_.getChild(e);if(e.isEmpty()||null==this.children_)return null;var t=e.getFront();e=e.popFront();if(this.children_.contains(t)){var r=this.children_.get(t);return r.find(e)}return null};e.prototype.remember=function(t,r){if(t.isEmpty()){this.value_=r;this.children_=null}else if(null!==this.value_)this.value_=this.value_.updateChild(t,r);else{null==this.children_&&(this.children_=new Et);var n=t.getFront();this.children_.contains(n)||this.children_.add(n,new e);var i=this.children_.get(n);t=t.popFront();i.remember(t,r)}};e.prototype.forget=function(e){if(e.isEmpty()){this.value_=null;this.children_=null;return true}if(null!==this.value_){if(this.value_.isLeafNode())return false;var t=this.value_;this.value_=null;var r=this;t.forEachChild(Ge,function(e,t){r.remember(new G(e),t)});return this.forget(e)}if(null!==this.children_){var n=e.getFront();e=e.popFront();if(this.children_.contains(n)){var i=this.children_.get(n).forget(e);i&&this.children_.remove(n)}if(this.children_.isEmpty()){this.children_=null;return true}return false}return true};e.prototype.forEachTree=function(e,t){null!==this.value_?t(e,this.value_):this.forEachChild(function(r,n){var i=new G(e.toString()+"/"+r);n.forEachTree(i,t)})};e.prototype.forEachChild=function(e){null!==this.children_&&this.children_.each(function(t,r){e(t,r)})};return e}();var Ct=function(e){e=e||{};e["timestamp"]=e["timestamp"]||(new Date).getTime();return e};var Tt=function(e,t){if(e&&"object"===typeof e){o.assert(".sv"in e,"Unexpected leaf node or priority contents");return t[e[".sv"]]}return e};var St=function(e,t){var r=new wt;e.forEachTree(new G(""),function(e,n){r.remember(e,Rt(n,t))});return r};var Rt=function(e,t){var r=e.getPriority().val();var n=Tt(r,t);var i;if(e.isLeafNode()){var o=e;var a=Tt(o.getValue(),t);return a!==o.getValue()||n!==o.getPriority().val()?new We(a,lt(n)):e}var s=e;i=s;n!==s.getPriority().val()&&(i=i.updatePriority(new We(n)));s.forEachChild(Ge,function(e,r){var n=Rt(r,t);n!==r&&(i=i.updateImmediateChild(e,n))});return i};var Nt;(function(e){e[e["OVERWRITE"]=0]="OVERWRITE";e[e["MERGE"]=1]="MERGE";e[e["ACK_USER_WRITE"]=2]="ACK_USER_WRITE";e[e["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(Nt||(Nt={}));var Ot=function(){function e(e,t,r,n){this.fromUser=e;this.fromServer=t;this.queryId=r;this.tagged=n;o.assert(!n||t,"Tagged queries must be from server.")}e.User=new e(true,false,null,false);e.Server=new e(false,true,null,false);e.forServerTaggedQuery=function(t){return new e(false,true,t,true)};return e}();var Pt=function(){function e(e,t,r){this.path=e;this.affectedTree=t;this.revert=r;this.type=Nt.ACK_USER_WRITE;this.source=Ot.User}e.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value){o.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths.");return this}var r=this.affectedTree.subtree(new G(t));return new e(G.Empty,r,this.revert)}o.assert(this.path.getFront()===t,"operationForChild called for unrelated child.");return new e(this.path.popFront(),this.affectedTree,this.revert)};return e}();var It;var xt=function(){It||(It=new Xe(k));return It};var kt=function(){function e(e,t){void 0===t&&(t=xt());this.value=e;this.children=t}e.fromObject=function(t){var r=e.Empty;o.forEach(t,function(e,t){r=r.set(new G(e),t)});return r};e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()};e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:G.Empty,value:this.value};if(e.isEmpty())return null;var r=e.getFront();var n=this.children.get(r);if(null!==n){var i=n.findRootMostMatchingPathAndValue(e.popFront(),t);if(null!=i){var o=new G(r).child(i.path);return{path:o,value:i.value}}return null}return null};e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return true})};e.prototype.subtree=function(t){if(t.isEmpty())return this;var r=t.getFront();var n=this.children.get(r);return null!==n?n.subtree(t.popFront()):e.Empty};e.prototype.set=function(t,r){if(t.isEmpty())return new e(r,this.children);var n=t.getFront();var i=this.children.get(n)||e.Empty;var o=i.set(t.popFront(),r);var a=this.children.insert(n,o);return new e(this.value,a)};e.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?e.Empty:new e(null,this.children);var r=t.getFront();var n=this.children.get(r);if(n){var i=n.remove(t.popFront());var o=void 0;o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i);return null===this.value&&o.isEmpty()?e.Empty:new e(this.value,o)}return this};e.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront();var r=this.children.get(t);return r?r.get(e.popFront()):null};e.prototype.setTree=function(t,r){if(t.isEmpty())return r;var n=t.getFront();var i=this.children.get(n)||e.Empty;var o=i.setTree(t.popFront(),r);var a=void 0;a=o.isEmpty()?this.children.remove(n):this.children.insert(n,o);return new e(this.value,a)};e.prototype.fold=function(e){return this.fold_(G.Empty,e)};e.prototype.fold_=function(e,t){var r={};this.children.inorderTraversal(function(n,i){r[n]=i.fold_(e.child(n),t)});return t(e,this.value,r)};e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,G.Empty,t)};e.prototype.findOnPath_=function(e,t,r){var n=!!this.value&&r(t,this.value);if(n)return n;if(e.isEmpty())return null;var i=e.getFront();var o=this.children.get(i);return o?o.findOnPath_(e.popFront(),t.child(i),r):null};e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,G.Empty,t)};e.prototype.foreachOnPath_=function(t,r,n){if(t.isEmpty())return this;this.value&&n(r,this.value);var i=t.getFront();var o=this.children.get(i);return o?o.foreachOnPath_(t.popFront(),r.child(i),n):e.Empty};e.prototype.foreach=function(e){this.foreach_(G.Empty,e)};e.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(r,n){n.foreach_(e.child(r),t)});this.value&&t(e,this.value)};e.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,r){r.value&&e(t,r.value)})};e.Empty=new e(null);return e}();var At=function(){function e(e,t){this.source=e;this.path=t;this.type=Nt.LISTEN_COMPLETE}e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,G.Empty):new e(this.source,this.path.popFront())};return e}();var Dt=function(){function e(e,t,r){this.source=e;this.path=t;this.snap=r;this.type=Nt.OVERWRITE}e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,G.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)};return e}();var Lt=function(){function e(e,t,r){this.source=e;this.path=t;this.children=r;this.type=Nt.MERGE}e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var r=this.children.subtree(new G(t));return r.isEmpty()?null:r.value?new Dt(this.source,G.Empty,r.value):new e(this.source,G.Empty,r)}o.assert(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation");return new e(this.source,this.path.popFront(),this.children)};e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"};return e}();var Ft=function(){function e(e,t,r){this.node_=e;this.fullyInitialized_=t;this.filtered_=r}e.prototype.isFullyInitialized=function(){return this.fullyInitialized_};e.prototype.isFiltered=function(){return this.filtered_};e.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)};e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)};e.prototype.getNode=function(){return this.node_};return e}();var jt=function(){function e(e,t){this.eventCache_=e;this.serverCache_=t}e.prototype.updateEventSnap=function(t,r,n){return new e(new Ft(t,r,n),this.serverCache_)};e.prototype.updateServerSnap=function(t,r,n){return new e(this.eventCache_,new Ft(t,r,n))};e.prototype.getEventCache=function(){return this.eventCache_};e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null};e.prototype.getServerCache=function(){return this.serverCache_};e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null};e.Empty=new e(new Ft(at.EMPTY_NODE,false,false),new Ft(at.EMPTY_NODE,false,false));return e}();var Mt=function(){function e(e,t,r,n,i){this.type=e;this.snapshotNode=t;this.childName=r;this.oldSnap=n;this.prevName=i}e.valueChange=function(t){return new e(e.VALUE,t)};e.childAddedChange=function(t,r){return new e(e.CHILD_ADDED,r,t)};e.childRemovedChange=function(t,r){return new e(e.CHILD_REMOVED,r,t)};e.childChangedChange=function(t,r,n){return new e(e.CHILD_CHANGED,r,t,n)};e.childMovedChange=function(t,r){return new e(e.CHILD_MOVED,r,t)};e.CHILD_ADDED="child_added";e.CHILD_REMOVED="child_removed";e.CHILD_CHANGED="child_changed";e.CHILD_MOVED="child_moved";e.VALUE="value";return e}();var Ut=function(){function e(e){this.index_=e}e.prototype.updateChild=function(e,t,r,n,i,a){o.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);if(s.getChild(n).equals(r.getChild(n))&&s.isEmpty()==r.isEmpty())return e;null!=a&&(r.isEmpty()?e.hasChild(t)?a.trackChildChange(Mt.childRemovedChange(t,s)):o.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?a.trackChildChange(Mt.childAddedChange(t,r)):a.trackChildChange(Mt.childChangedChange(t,r,s)));return e.isLeafNode()&&r.isEmpty()?e:e.updateImmediateChild(t,r).withIndex(this.index_)};e.prototype.updateFullNode=function(e,t,r){if(null!=r){e.isLeafNode()||e.forEachChild(Ge,function(e,n){t.hasChild(e)||r.trackChildChange(Mt.childRemovedChange(e,n))});t.isLeafNode()||t.forEachChild(Ge,function(t,n){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(n)||r.trackChildChange(Mt.childChangedChange(t,n,i))}else r.trackChildChange(Mt.childAddedChange(t,n))})}return t.withIndex(this.index_)};e.prototype.updatePriority=function(e,t){return e.isEmpty()?at.EMPTY_NODE:e.updatePriority(t)};e.prototype.filtersNodes=function(){return false};e.prototype.getIndexedFilter=function(){return this};e.prototype.getIndex=function(){return this.index_};return e}();var Wt=function(){function e(){this.changeMap_={}}e.prototype.trackChildChange=function(e){var t=e.type;var r=e.childName;o.assert(t==Mt.CHILD_ADDED||t==Mt.CHILD_CHANGED||t==Mt.CHILD_REMOVED,"Only child changes supported for tracking");o.assert(".priority"!==r,"Only non-priority child changes can be tracked.");var n=o.safeGet(this.changeMap_,r);if(n){var i=n.type;if(t==Mt.CHILD_ADDED&&i==Mt.CHILD_REMOVED)this.changeMap_[r]=Mt.childChangedChange(r,e.snapshotNode,n.snapshotNode);else if(t==Mt.CHILD_REMOVED&&i==Mt.CHILD_ADDED)delete this.changeMap_[r];else if(t==Mt.CHILD_REMOVED&&i==Mt.CHILD_CHANGED)this.changeMap_[r]=Mt.childRemovedChange(r,n.oldSnap);else if(t==Mt.CHILD_CHANGED&&i==Mt.CHILD_ADDED)this.changeMap_[r]=Mt.childAddedChange(r,e.snapshotNode);else{if(t!=Mt.CHILD_CHANGED||i!=Mt.CHILD_CHANGED)throw o.assertionError("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap_[r]=Mt.childChangedChange(r,e.snapshotNode,n.oldSnap)}}else this.changeMap_[r]=e};e.prototype.getChanges=function(){return o.getValues(this.changeMap_)};return e}();var qt=function(){function e(){}e.prototype.getCompleteChild=function(e){return null};e.prototype.getChildAfterChild=function(e,t,r){return null};return e}();var Vt=new qt;var Bt=function(){function e(e,t,r){void 0===r&&(r=null);this.writes_=e;this.viewCache_=t;this.optCompleteServerCache_=r}e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var r=null!=this.optCompleteServerCache_?new Ft(this.optCompleteServerCache_,true,false):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,r)};e.prototype.getChildAfterChild=function(e,t,r){var n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap();var i=this.writes_.calcIndexedSlice(n,t,1,r,e);return 0===i.length?null:i[0]};return e}();var Qt=function(){function e(e,t){this.viewCache=e;this.changes=t}return e}();var Ht=function(){function e(e){this.filter_=e}e.prototype.assertIndexed=function(e){o.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed");o.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")};e.prototype.applyOperation=function(t,r,n,i){var a=new Wt;var s,u;if(r.type===Nt.OVERWRITE){var c=r;if(c.source.fromUser)s=this.applyUserOverwrite_(t,c.path,c.snap,n,i,a);else{o.assert(c.source.fromServer,"Unknown source.");u=c.source.tagged||t.getServerCache().isFiltered()&&!c.path.isEmpty();s=this.applyServerOverwrite_(t,c.path,c.snap,n,i,u,a)}}else if(r.type===Nt.MERGE){var l=r;if(l.source.fromUser)s=this.applyUserMerge_(t,l.path,l.children,n,i,a);else{o.assert(l.source.fromServer,"Unknown source.");u=l.source.tagged||t.getServerCache().isFiltered();s=this.applyServerMerge_(t,l.path,l.children,n,i,u,a)}}else if(r.type===Nt.ACK_USER_WRITE){var h=r;s=h.revert?this.revertUserWrite_(t,h.path,n,i,a):this.ackUserWrite_(t,h.path,h.affectedTree,n,i,a)}else{if(r.type!==Nt.LISTEN_COMPLETE)throw o.assertionError("Unknown operation type: "+r.type);s=this.listenComplete_(t,r.path,n,a)}var p=a.getChanges();e.maybeAddValueEvent_(t,s,p);return new Qt(s,p)};e.maybeAddValueEvent_=function(e,t,r){var n=t.getEventCache();if(n.isFullyInitialized()){var i=n.getNode().isLeafNode()||n.getNode().isEmpty();var o=e.getCompleteEventSnap();(r.length>0||!e.getEventCache().isFullyInitialized()||i&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority()))&&r.push(Mt.valueChange(t.getCompleteEventSnap()))}};e.prototype.generateEventCacheAfterServerEvent_=function(e,t,r,n,i){var a=e.getEventCache();if(null!=r.shadowingWrite(t))return e;var s=void 0,u=void 0;if(t.isEmpty()){o.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data");if(e.getServerCache().isFiltered()){var c=e.getCompleteServerSnap();var l=c instanceof at?c:at.EMPTY_NODE;var h=r.calcCompleteEventChildren(l);s=this.filter_.updateFullNode(e.getEventCache().getNode(),h,i)}else{var p=r.calcCompleteEventCache(e.getCompleteServerSnap());s=this.filter_.updateFullNode(e.getEventCache().getNode(),p,i)}}else{var f=t.getFront();if(".priority"==f){o.assert(1==t.getLength(),"Can't have a priority with additional path components");var d=a.getNode();u=e.getServerCache().getNode();var v=r.calcEventCacheAfterServerOverwrite(t,d,u);s=null!=v?this.filter_.updatePriority(d,v):a.getNode()}else{var _=t.popFront();var y=void 0;if(a.isCompleteForChild(f)){u=e.getServerCache().getNode();var g=r.calcEventCacheAfterServerOverwrite(t,a.getNode(),u);y=null!=g?a.getNode().getImmediateChild(f).updateChild(_,g):a.getNode().getImmediateChild(f)}else y=r.calcCompleteChild(f,e.getServerCache());s=null!=y?this.filter_.updateChild(a.getNode(),f,y,_,n,i):a.getNode()}}return e.updateEventSnap(s,a.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())};e.prototype.applyServerOverwrite_=function(e,t,r,n,i,o,a){var s=e.getServerCache();var u;var c=o?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())u=c.updateFullNode(s.getNode(),r,null);else if(c.filtersNodes()&&!s.isFiltered()){var l=s.getNode().updateChild(t,r);u=c.updateFullNode(s.getNode(),l,null)}else{var h=t.getFront();if(!s.isCompleteForPath(t)&&t.getLength()>1)return e;var p=t.popFront();var f=s.getNode().getImmediateChild(h);var d=f.updateChild(p,r);u=".priority"==h?c.updatePriority(s.getNode(),d):c.updateChild(s.getNode(),h,d,p,Vt,null)}var v=e.updateServerSnap(u,s.isFullyInitialized()||t.isEmpty(),c.filtersNodes());var _=new Bt(n,v,i);return this.generateEventCacheAfterServerEvent_(v,t,n,_,a)};e.prototype.applyUserOverwrite_=function(e,t,r,n,i,o){var a=e.getEventCache();var s,u;var c=new Bt(n,e,i);if(t.isEmpty()){u=this.filter_.updateFullNode(e.getEventCache().getNode(),r,o);s=e.updateEventSnap(u,true,this.filter_.filtersNodes())}else{var l=t.getFront();if(".priority"===l){u=this.filter_.updatePriority(e.getEventCache().getNode(),r);s=e.updateEventSnap(u,a.isFullyInitialized(),a.isFiltered())}else{var h=t.popFront();var p=a.getNode().getImmediateChild(l);var f=void 0;if(h.isEmpty())f=r;else{var d=c.getCompleteChild(l);f=null!=d?".priority"===h.getBack()&&d.getChild(h.parent()).isEmpty()?d:d.updateChild(h,r):at.EMPTY_NODE}if(p.equals(f))s=e;else{var v=this.filter_.updateChild(a.getNode(),l,f,h,c,o);s=e.updateEventSnap(v,a.isFullyInitialized(),this.filter_.filtersNodes())}}}return s};e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)};e.prototype.applyUserMerge_=function(t,r,n,i,o,a){var s=this;var u=t;n.foreach(function(n,c){var l=r.child(n);e.cacheHasChild_(t,l.getFront())&&(u=s.applyUserOverwrite_(u,l,c,i,o,a))});n.foreach(function(n,c){var l=r.child(n);e.cacheHasChild_(t,l.getFront())||(u=s.applyUserOverwrite_(u,l,c,i,o,a))});return u};e.prototype.applyMerge_=function(e,t){t.foreach(function(t,r){e=e.updateChild(t,r)});return e};e.prototype.applyServerMerge_=function(e,t,r,n,i,o,a){var s=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var u=e;var c;c=t.isEmpty()?r:kt.Empty.setTree(t,r);var l=e.getServerCache().getNode();c.children.inorderTraversal(function(t,r){if(l.hasChild(t)){var c=e.getServerCache().getNode().getImmediateChild(t);var h=s.applyMerge_(c,r);u=s.applyServerOverwrite_(u,new G(t),h,n,i,o,a)}});c.children.inorderTraversal(function(t,r){var c=!e.getServerCache().isCompleteForChild(t)&&null==r.value;if(!l.hasChild(t)&&!c){var h=e.getServerCache().getNode().getImmediateChild(t);var p=s.applyMerge_(h,r);u=s.applyServerOverwrite_(u,new G(t),p,n,i,o,a)}});return u};e.prototype.ackUserWrite_=function(e,t,r,n,i,o){if(null!=n.shadowingWrite(t))return e;var a=e.getServerCache().isFiltered();var s=e.getServerCache();if(null!=r.value){if(t.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,s.getNode().getChild(t),n,i,a,o);if(t.isEmpty()){var u=kt.Empty;s.getNode().forEachChild(De,function(e,t){u=u.set(new G(e),t)});return this.applyServerMerge_(e,t,u,n,i,a,o)}return e}var c=kt.Empty;r.foreach(function(e,r){var n=t.child(e);s.isCompleteForPath(n)&&(c=c.set(e,s.getNode().getChild(n)))});return this.applyServerMerge_(e,t,c,n,i,a,o)};e.prototype.listenComplete_=function(e,t,r,n){var i=e.getServerCache();var o=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,t,r,Vt,n)};e.prototype.revertUserWrite_=function(e,t,r,n,i){var a;if(null!=r.shadowingWrite(t))return e;var s=new Bt(r,e,n);var u=e.getEventCache().getNode();var c=void 0;if(t.isEmpty()||".priority"===t.getFront()){var l=void 0;if(e.getServerCache().isFullyInitialized())l=r.calcCompleteEventCache(e.getCompleteServerSnap());else{var h=e.getServerCache().getNode();o.assert(h instanceof at,"serverChildren would be complete if leaf node");l=r.calcCompleteEventChildren(h)}l=l;c=this.filter_.updateFullNode(u,l,i)}else{var p=t.getFront();var f=r.calcCompleteChild(p,e.getServerCache());null==f&&e.getServerCache().isCompleteForChild(p)&&(f=u.getImmediateChild(p));c=null!=f?this.filter_.updateChild(u,p,f,t.popFront(),s,i):e.getEventCache().getNode().hasChild(p)?this.filter_.updateChild(u,p,at.EMPTY_NODE,t.popFront(),s,i):u;if(c.isEmpty()&&e.getServerCache().isFullyInitialized()){a=r.calcCompleteEventCache(e.getCompleteServerSnap());a.isLeafNode()&&(c=this.filter_.updateFullNode(c,a,i))}}a=e.getServerCache().isFullyInitialized()||null!=r.shadowingWrite(G.Empty);return e.updateEventSnap(c,a,this.filter_.filtersNodes())};return e}();var Gt=function(){function e(e){this.query_=e;this.index_=this.query_.getQueryParams().getIndex()}e.prototype.generateEventsForChanges=function(e,t,r){var n=this;var i=[];var o=[];e.forEach(function(e){e.type===Mt.CHILD_CHANGED&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push(Mt.childMovedChange(e.childName,e.snapshotNode))});this.generateEventsForType_(i,Mt.CHILD_REMOVED,e,r,t);this.generateEventsForType_(i,Mt.CHILD_ADDED,e,r,t);this.generateEventsForType_(i,Mt.CHILD_MOVED,o,r,t);this.generateEventsForType_(i,Mt.CHILD_CHANGED,e,r,t);this.generateEventsForType_(i,Mt.VALUE,e,r,t);return i};e.prototype.generateEventsForType_=function(e,t,r,n,i){var o=this;var a=r.filter(function(e){return e.type===t});a.sort(this.compareChanges_.bind(this));a.forEach(function(t){var r=o.materializeSingleChange_(t,i);n.forEach(function(n){n.respondsTo(t.type)&&e.push(n.createEvent(r,o.query_))})})};e.prototype.materializeSingleChange_=function(e,t){if("value"===e.type||"child_removed"===e.type)return e;e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_);return e};e.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw o.assertionError("Should only compare child_ events.");var r=new Ie(e.childName,e.snapshotNode);var n=new Ie(t.childName,t.snapshotNode);return this.index_.compare(r,n)};return e}();var zt=function(){function e(e,t){this.query_=e;this.eventRegistrations_=[];var r=this.query_.getQueryParams();var n=new Ut(r.getIndex());var i=r.getNodeFilter();this.processor_=new Ht(i);var o=t.getServerCache();var a=t.getEventCache();var s=n.updateFullNode(at.EMPTY_NODE,o.getNode(),null);var u=i.updateFullNode(at.EMPTY_NODE,a.getNode(),null);var c=new Ft(s,o.isFullyInitialized(),n.filtersNodes());var l=new Ft(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new jt(l,c);this.eventGenerator_=new Gt(this.query_)}e.prototype.getQuery=function(){return this.query_};e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()};e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();if(t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty()))return t.getChild(e);return null};e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length};e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)};e.prototype.removeEventRegistration=function(e,t){var r=[];if(t){o.assert(null==e,"A cancel should cancel all event registrations.");var n=this.query_.path;this.eventRegistrations_.forEach(function(e){t=t;var i=e.createCancelEvent(t,n);i&&r.push(i)})}if(e){var i=[];for(var a=0;a<this.eventRegistrations_.length;++a){var s=this.eventRegistrations_[a];if(s.matches(e)){if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(a+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return r};e.prototype.applyOperation=function(e,t,r){if(e.type===Nt.MERGE&&null!==e.source.queryId){o.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges");o.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache")}var n=this.viewCache_;var i=this.processor_.applyOperation(n,e,t,r);this.processor_.assertIndexed(i.viewCache);o.assert(i.viewCache.getServerCache().isFullyInitialized()||!n.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back");this.viewCache_=i.viewCache;return this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)};e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache();var r=[];if(!t.getNode().isLeafNode()){var n=t.getNode();n.forEachChild(Ge,function(e,t){r.push(Mt.childAddedChange(e,t))})}t.isFullyInitialized()&&r.push(Mt.valueChange(t.getNode()));return this.generateEventsForChanges_(r,t.getNode(),e)};e.prototype.generateEventsForChanges_=function(e,t,r){var n=r?[r]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,n)};return e}();var Kt;var Yt=function(){function e(){this.views_={}}Object.defineProperty(e,"__referenceConstructor",{get:function(){o.assert(Kt,"Reference.ts has not been loaded");return Kt},set:function(e){o.assert(!Kt,"__referenceConstructor has already been defined");Kt=e},enumerable:true,configurable:true});e.prototype.isEmpty=function(){return o.isEmpty(this.views_)};e.prototype.applyOperation=function(e,t,r){var n=e.source.queryId;if(null!==n){var i=o.safeGet(this.views_,n);o.assert(null!=i,"SyncTree gave us an op for an invalid query.");return i.applyOperation(e,t,r)}var a=[];o.forEach(this.views_,function(n,i){a=a.concat(i.applyOperation(e,t,r))});return a};e.prototype.addEventRegistration=function(e,t,r,n,i){var a=e.queryIdentifier();var s=o.safeGet(this.views_,a);if(!s){var u=r.calcCompleteEventCache(i?n:null);var c=false;if(u)c=true;else if(n instanceof at){u=r.calcCompleteEventChildren(n);c=false}else{u=at.EMPTY_NODE;c=false}var l=new jt(new Ft(u,c,false),new Ft(n,i,false));s=new zt(e,l);this.views_[a]=s}s.addEventRegistration(t);return s.getInitialEvents(t)};e.prototype.removeEventRegistration=function(t,r,n){var i=t.queryIdentifier();var a=[];var s=[];var u=this.hasCompleteView();if("default"===i){var c=this;o.forEach(this.views_,function(e,t){s=s.concat(t.removeEventRegistration(r,n));if(t.isEmpty()){delete c.views_[e];t.getQuery().getQueryParams().loadsAllData()||a.push(t.getQuery())}})}else{var l=o.safeGet(this.views_,i);if(l){s=s.concat(l.removeEventRegistration(r,n));if(l.isEmpty()){delete this.views_[i];l.getQuery().getQueryParams().loadsAllData()||a.push(l.getQuery())}}}u&&!this.hasCompleteView()&&a.push(new e.__referenceConstructor(t.repo,t.path));return{removed:a,events:s}};e.prototype.getQueryViews=function(){var e=this;var t=Object.keys(this.views_).map(function(t){return e.views_[t]});return t.filter(function(e){return!e.getQuery().getQueryParams().loadsAllData()})};e.prototype.getCompleteServerCache=function(e){var t=null;o.forEach(this.views_,function(r,n){t=t||n.getCompleteServerCache(e)});return t};e.prototype.viewForQuery=function(e){var t=e.getQueryParams();if(t.loadsAllData())return this.getCompleteView();var r=e.queryIdentifier();return o.safeGet(this.views_,r)};e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)};e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()};e.prototype.getCompleteView=function(){var e=o.findValue(this.views_,function(e){return e.getQuery().getQueryParams().loadsAllData()});return e||null};return e}();var Xt=function(){function e(e){this.writeTree_=e}e.prototype.addWrite=function(t,r){if(t.isEmpty())return new e(new kt(r));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var i=n.path;var o=n.value;var a=G.relativePath(i,t);o=o.updateChild(a,r);return new e(this.writeTree_.set(i,o))}var s=new kt(r);var u=this.writeTree_.setTree(t,s);return new e(u)};e.prototype.addWrites=function(e,t){var r=this;o.forEach(t,function(t,n){r=r.addWrite(e.child(t),n)});return r};e.prototype.removeWrite=function(t){if(t.isEmpty())return e.Empty;var r=this.writeTree_.setTree(t,kt.Empty);return new e(r)};e.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)};e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(G.relativePath(t.path,e)):null};e.prototype.getCompleteChildren=function(){var e=[];var t=this.writeTree_.value;null!=t?t.isLeafNode()||t.forEachChild(Ge,function(t,r){e.push(new Ie(t,r))}):this.writeTree_.children.inorderTraversal(function(t,r){null!=r.value&&e.push(new Ie(t,r.value))});return e};e.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var r=this.getCompleteNode(t);return new e(null!=r?new kt(r):this.writeTree_.subtree(t))};e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()};e.prototype.apply=function(t){return e.applySubtreeWrite_(G.Empty,this.writeTree_,t)};e.Empty=new e(new kt(null));e.applySubtreeWrite_=function(t,r,n){if(null!=r.value)return n.updateChild(t,r.value);var i=null;r.children.inorderTraversal(function(r,a){if(".priority"===r){o.assert(null!==a.value,"Priority writes must always be leaf nodes");i=a.value}else n=e.applySubtreeWrite_(t.child(r),a,n)});n.getChild(t).isEmpty()||null===i||(n=n.updateChild(t.child(".priority"),i));return n};return e}();var $t=function(){function e(){this.visibleWrites_=Xt.Empty;this.allWrites_=[];this.lastWriteId_=-1}e.prototype.childWrites=function(e){return new Jt(e,this)};e.prototype.addOverwrite=function(e,t,r,n){o.assert(r>this.lastWriteId_,"Stacking an older write on top of newer ones");void 0===n&&(n=true);this.allWrites_.push({path:e,snap:t,writeId:r,visible:n});n&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t));this.lastWriteId_=r};e.prototype.addMerge=function(e,t,r){o.assert(r>this.lastWriteId_,"Stacking an older merge on top of newer ones");this.allWrites_.push({path:e,children:t,writeId:r,visible:true});this.visibleWrites_=this.visibleWrites_.addWrites(e,t);this.lastWriteId_=r};e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var r=this.allWrites_[t];if(r.writeId===e)return r}return null};e.prototype.removeWrite=function(e){var t=this;var r=this.allWrites_.findIndex(function(t){return t.writeId===e});o.assert(r>=0,"removeWrite called with nonexistent writeId.");var n=this.allWrites_[r];this.allWrites_.splice(r,1);var i=n.visible;var a=false;var s=this.allWrites_.length-1;while(i&&s>=0){var u=this.allWrites_[s];u.visible&&(s>=r&&this.recordContainsPath_(u,n.path)?i=false:n.path.contains(u.path)&&(a=true));s--}if(i){if(a){this.resetTree_();return true}if(n.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(n.path);else{var c=n.children;o.forEach(c,function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(n.path.child(e))})}return true}return false};e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)};e.prototype.calcCompleteEventCache=function(t,r,n,i){if(n||i){var o=this.visibleWrites_.childCompoundWrite(t);if(!i&&o.isEmpty())return r;if(i||null!=r||o.hasCompleteWrite(G.Empty)){var a=function(e){return(e.visible||i)&&(!n||!~n.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))};var s=e.layerTree_(this.allWrites_,a,t);var u=r||at.EMPTY_NODE;return s.apply(u)}return null}var c=this.visibleWrites_.getCompleteNode(t);if(null!=c)return c;var l=this.visibleWrites_.childCompoundWrite(t);if(l.isEmpty())return r;if(null!=r||l.hasCompleteWrite(G.Empty)){var u=r||at.EMPTY_NODE;return l.apply(u)}return null};e.prototype.calcCompleteEventChildren=function(e,t){var r=at.EMPTY_NODE;var n=this.visibleWrites_.getCompleteNode(e);if(n){n.isLeafNode()||n.forEachChild(Ge,function(e,t){r=r.updateImmediateChild(e,t)});return r}if(t){var i=this.visibleWrites_.childCompoundWrite(e);t.forEachChild(Ge,function(e,t){var n=i.childCompoundWrite(new G(e)).apply(t);r=r.updateImmediateChild(e,n)});i.getCompleteChildren().forEach(function(e){r=r.updateImmediateChild(e.name,e.node)});return r}var o=this.visibleWrites_.childCompoundWrite(e);o.getCompleteChildren().forEach(function(e){r=r.updateImmediateChild(e.name,e.node)});return r};e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,r,n){o.assert(r||n,"Either existingEventSnap or existingServerSnap must exist");var i=e.child(t);if(this.visibleWrites_.hasCompleteWrite(i))return null;var a=this.visibleWrites_.childCompoundWrite(i);return a.isEmpty()?n.getChild(t):a.apply(n.getChild(t))};e.prototype.calcCompleteChild=function(e,t,r){var n=e.child(t);var i=this.visibleWrites_.getCompleteNode(n);if(null!=i)return i;if(r.isCompleteForChild(t)){var o=this.visibleWrites_.childCompoundWrite(n);return o.apply(r.getNode().getImmediateChild(t))}return null};e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)};e.prototype.calcIndexedSlice=function(e,t,r,n,i,o){var a;var s=this.visibleWrites_.childCompoundWrite(e);var u=s.getCompleteNode(G.Empty);if(null!=u)a=u;else{if(null==t)return[];a=s.apply(t)}a=a.withIndex(o);if(a.isEmpty()||a.isLeafNode())return[];var c=[];var l=o.getCompare();var h=i?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);var p=h.getNext();while(p&&c.length<n){0!==l(p,r)&&c.push(p);p=h.getNext()}return c};e.prototype.recordContainsPath_=function(e,t){return e.snap?e.path.contains(t):!!o.findKey(e.children,function(r,n){return e.path.child(n).contains(t)})};e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,G.Empty);this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1};e.DefaultFilter_=function(e){return e.visible};e.layerTree_=function(e,t,r){var n=Xt.Empty;for(var i=0;i<e.length;++i){var a=e[i];if(t(a)){var s=a.path;var u=void 0;if(a.snap){if(r.contains(s)){u=G.relativePath(r,s);n=n.addWrite(u,a.snap)}else if(s.contains(r)){u=G.relativePath(s,r);n=n.addWrite(G.Empty,a.snap.getChild(u))}}else{if(!a.children)throw o.assertionError("WriteRecord should have .snap or .children");if(r.contains(s)){u=G.relativePath(r,s);n=n.addWrites(u,a.children)}else if(s.contains(r)){u=G.relativePath(s,r);if(u.isEmpty())n=n.addWrites(G.Empty,a.children);else{var c=o.safeGet(a.children,u.getFront());if(c){var l=c.getChild(u.popFront());n=n.addWrite(G.Empty,l)}}}}}}return n};return e}();var Jt=function(){function e(e,t){this.treePath_=e;this.writeTree_=t}e.prototype.calcCompleteEventCache=function(e,t,r){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,r)};e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)};e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,r){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,r)};e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))};e.prototype.calcIndexedSlice=function(e,t,r,n,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,r,n,i)};e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)};e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)};return e}();var Zt=function(){function e(e){this.listenProvider_=e;this.syncPointTree_=kt.Empty;this.pendingWriteTree_=new $t;this.tagToQueryMap_={};this.queryToTagMap_={}}e.prototype.applyUserOverwrite=function(e,t,r,n){this.pendingWriteTree_.addOverwrite(e,t,r,n);return n?this.applyOperationToSyncPoints_(new Dt(Ot.User,e,t)):[]};e.prototype.applyUserMerge=function(e,t,r){this.pendingWriteTree_.addMerge(e,t,r);var n=kt.fromObject(t);return this.applyOperationToSyncPoints_(new Lt(Ot.User,e,n))};e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=false);var r=this.pendingWriteTree_.getWrite(e);var n=this.pendingWriteTree_.removeWrite(e);if(n){var i=kt.Empty;null!=r.snap?i=i.set(G.Empty,true):o.forEach(r.children,function(e,t){i=i.set(new G(e),t)});return this.applyOperationToSyncPoints_(new Pt(r.path,i,t))}return[]};e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new Dt(Ot.Server,e,t))};e.prototype.applyServerMerge=function(e,t){var r=kt.fromObject(t);return this.applyOperationToSyncPoints_(new Lt(Ot.Server,e,r))};e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new At(Ot.Server,e))};e.prototype.applyTaggedQueryOverwrite=function(t,r,n){var i=this.queryKeyForTag_(n);if(null!=i){var o=e.parseQueryKey_(i);var a=o.path,s=o.queryId;var u=G.relativePath(a,t);var c=new Dt(Ot.forServerTaggedQuery(s),u,r);return this.applyTaggedOperation_(a,c)}return[]};e.prototype.applyTaggedQueryMerge=function(t,r,n){var i=this.queryKeyForTag_(n);if(i){var o=e.parseQueryKey_(i);var a=o.path,s=o.queryId;var u=G.relativePath(a,t);var c=kt.fromObject(r);var l=new Lt(Ot.forServerTaggedQuery(s),u,c);return this.applyTaggedOperation_(a,l)}return[]};e.prototype.applyTaggedListenComplete=function(t,r){var n=this.queryKeyForTag_(r);if(n){var i=e.parseQueryKey_(n);var o=i.path,a=i.queryId;var s=G.relativePath(o,t);var u=new At(Ot.forServerTaggedQuery(a),s);return this.applyTaggedOperation_(o,u)}return[]};e.prototype.addEventRegistration=function(t,r){var n=t.path;var i=null;var a=false;this.syncPointTree_.foreachOnPath(n,function(e,t){var r=G.relativePath(e,n);i=i||t.getCompleteServerCache(r);a=a||t.hasCompleteView()});var s=this.syncPointTree_.get(n);if(s){a=a||s.hasCompleteView();i=i||s.getCompleteServerCache(G.Empty)}else{s=new Yt;this.syncPointTree_=this.syncPointTree_.set(n,s)}var u;if(null!=i)u=true;else{u=false;i=at.EMPTY_NODE;var c=this.syncPointTree_.subtree(n);c.foreachChild(function(e,t){var r=t.getCompleteServerCache(G.Empty);r&&(i=i.updateImmediateChild(e,r))})}var l=s.viewExistsForQuery(t);if(!l&&!t.getQueryParams().loadsAllData()){var h=e.makeQueryKey_(t);o.assert(!(h in this.queryToTagMap_),"View does not exist, but we have a tag");var p=e.getNextQueryTag_();this.queryToTagMap_[h]=p;this.tagToQueryMap_["_"+p]=h}var f=this.pendingWriteTree_.childWrites(n);var d=s.addEventRegistration(t,r,f,i,u);if(!l&&!a){var v=s.viewForQuery(t);d=d.concat(this.setupListener_(t,v))}return d};e.prototype.removeEventRegistration=function(t,r,n){var i=this;var o=t.path;var a=this.syncPointTree_.get(o);var s=[];if(a&&("default"===t.queryIdentifier()||a.viewExistsForQuery(t))){var u=a.removeEventRegistration(t,r,n);a.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var c=u.removed;s=u.events;var l=-1!==c.findIndex(function(e){return e.getQueryParams().loadsAllData()});var h=this.syncPointTree_.findOnPath(o,function(e,t){return t.hasCompleteView()});if(l&&!h){var p=this.syncPointTree_.subtree(o);if(!p.isEmpty()){var f=this.collectDistinctViewsForSubTree_(p);for(var d=0;d<f.length;++d){var v=f[d],_=v.getQuery();var y=this.createListenerForView_(v);this.listenProvider_.startListening(e.queryForListening_(_),this.tagForQuery_(_),y.hashFn,y.onComplete)}}}if(!h&&c.length>0&&!n)if(l){var g=null;this.listenProvider_.stopListening(e.queryForListening_(t),g)}else c.forEach(function(t){var r=i.queryToTagMap_[e.makeQueryKey_(t)];i.listenProvider_.stopListening(e.queryForListening_(t),r)});this.removeTags_(c)}return s};e.prototype.calcCompleteEventCache=function(e,t){var r=true;var n=this.pendingWriteTree_;var i=this.syncPointTree_.findOnPath(e,function(t,r){var n=G.relativePath(t,e);var i=r.getCompleteServerCache(n);if(i)return i});return n.calcCompleteEventCache(e,i,t,r)};e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(e,t,r){if(t&&t.hasCompleteView()){var n=t.getCompleteView();return[n]}var i=[];t&&(i=t.getQueryViews());o.forEach(r,function(e,t){i=i.concat(t)});return i})};e.prototype.removeTags_=function(t){for(var r=0;r<t.length;++r){var n=t[r];if(!n.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(n);var o=this.queryToTagMap_[i];delete this.queryToTagMap_[i];delete this.tagToQueryMap_["_"+o]}}};e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e};e.prototype.setupListener_=function(t,r){var n=t.path;var i=this.tagForQuery_(t);var a=this.createListenerForView_(r);var s=this.listenProvider_.startListening(e.queryForListening_(t),i,a.hashFn,a.onComplete);var u=this.syncPointTree_.subtree(n);if(i)o.assert(!u.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else{var c=u.fold(function(e,t,r){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var n=[];t&&(n=n.concat(t.getQueryViews().map(function(e){return e.getQuery()})));o.forEach(r,function(e,t){n=n.concat(t)});return n});for(var l=0;l<c.length;++l){var h=c[l];this.listenProvider_.stopListening(e.queryForListening_(h),this.tagForQuery_(h))}}return s};e.prototype.createListenerForView_=function(e){var t=this;var r=e.getQuery();var n=this.tagForQuery_(r);return{hashFn:function(){var t=e.getServerCache()||at.EMPTY_NODE;return t.hash()},onComplete:function(e){if("ok"===e)return n?t.applyTaggedListenComplete(r.path,n):t.applyListenComplete(r.path);var i=W(e,r);return t.removeEventRegistration(r,null,i)}}};e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()};e.parseQueryKey_=function(e){var t=e.indexOf("$");o.assert(-1!==t&&t<e.length-1,"Bad queryKey.");return{queryId:e.substr(t+1),path:new G(e.substr(0,t))}};e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap_["_"+e]};e.prototype.tagForQuery_=function(t){var r=e.makeQueryKey_(t);return o.safeGet(this.queryToTagMap_,r)};e.getNextQueryTag_=function(){return e.nextQueryTag_++};e.prototype.applyTaggedOperation_=function(e,t){var r=this.syncPointTree_.get(e);o.assert(r,"Missing sync point for query tag that we're tracking");var n=this.pendingWriteTree_.childWrites(e);return r.applyOperation(t,n,null)};e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(G.Empty))};e.prototype.applyOperationHelper_=function(e,t,r,n){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,r,n);var i=t.get(G.Empty);null==r&&null!=i&&(r=i.getCompleteServerCache(G.Empty));var o=[];var a=e.path.getFront();var s=e.operationForChild(a);var u=t.children.get(a);if(u&&s){var c=r?r.getImmediateChild(a):null;var l=n.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,l))}i&&(o=o.concat(i.applyOperation(e,n,r)));return o};e.prototype.applyOperationDescendantsHelper_=function(e,t,r,n){var i=this;var o=t.get(G.Empty);null==r&&null!=o&&(r=o.getCompleteServerCache(G.Empty));var a=[];t.children.inorderTraversal(function(t,o){var s=r?r.getImmediateChild(t):null;var u=n.child(t);var c=e.operationForChild(t);c&&(a=a.concat(i.applyOperationDescendantsHelper_(c,o,s,u)))});o&&(a=a.concat(o.applyOperation(e,n,r)));return a};e.nextQueryTag_=1;return e}();var er=function(){function e(){this.rootNode_=at.EMPTY_NODE}e.prototype.getNode=function(e){return this.rootNode_.getChild(e)};e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)};return e}();var tr=function(){function e(e){this.app_=e}e.prototype.getToken=function(e){return this.app_["INTERNAL"]["getToken"](e).then(null,function(e){if(e&&"auth/token-not-initialized"===e.code){E("Got auth/token-not-initialized error.  Treating as null token.");return null}return Promise.reject(e)})};e.prototype.addTokenChangeListener=function(e){this.app_["INTERNAL"]["addAuthTokenListener"](e)};e.prototype.removeTokenChangeListener=function(e){this.app_["INTERNAL"]["removeAuthTokenListener"](e)};e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.';S(e)};return e}();var rr=function(){function e(){this.counters_={}}e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1);o.contains(this.counters_,e)||(this.counters_[e]=0);this.counters_[e]+=t};e.prototype.get=function(){return o.deepCopy(this.counters_)};return e}();var nr=function(){function e(){}e.getCollection=function(e){var t=e.toString();this.collections_[t]||(this.collections_[t]=new rr);return this.collections_[t]};e.getOrCreateReporter=function(e,t){var r=e.toString();this.reporters_[r]||(this.reporters_[r]=t());return this.reporters_[r]};e.collections_={};e.reporters_={};return e}();var ir=function(){function e(e){this.collection_=e;this.last_=null}e.prototype.get=function(){var e=this.collection_.get();var t=o.clone(e);this.last_&&o.forEach(this.last_,function(e,r){t[e]=t[e]-r});this.last_=e;return t};return e}();var or=1e4;var ar=3e4;var sr=3e5;var ur=function(){function e(e,t){this.server_=t;this.statsToReport_={};this.statsListener_=new ir(e);var r=or+(ar-or)*Math.random();H(this.reportStats_.bind(this),Math.floor(r))}e.prototype.includeStat=function(e){this.statsToReport_[e]=true};e.prototype.reportStats_=function(){var e=this;var t=this.statsListener_.get();var r={};var n=false;o.forEach(t,function(t,i){if(i>0&&o.contains(e.statsToReport_,t)){r[t]=i;n=true}});n&&this.server_.reportStats(r);H(this.reportStats_.bind(this),Math.floor(2*Math.random()*sr))};return e}();var cr=function(){function e(){this.eventLists_=[];this.recursionDepth_=0}e.prototype.queueEvents=function(e){var t=null;for(var r=0;r<e.length;r++){var n=e[r];var i=n.getPath();if(null!==t&&!i.equals(t.getPath())){this.eventLists_.push(t);t=null}null===t&&(t=new lr(i));t.add(n)}t&&this.eventLists_.push(t)};e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t);this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})};e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t);this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})};e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;var t=true;for(var r=0;r<this.eventLists_.length;r++){var n=this.eventLists_[r];if(n){var i=n.getPath();if(e(i)){this.eventLists_[r].raise();this.eventLists_[r]=null}else t=false}}t&&(this.eventLists_=[]);this.recursionDepth_--};return e}();var lr=function(){function e(e){this.path_=e;this.events_=[]}e.prototype.add=function(e){this.events_.push(e)};e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var r=t.getEventRunner();g&&E("event: "+t.toString());B(r)}}};e.prototype.getPath=function(){return this.path_};return e}();var hr=function(){function e(e){this.allowedEvents_=e;this.listeners_={};o.assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}e.prototype.trigger=function(e){var t=[];for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(Array.isArray(this.listeners_[e])){var n=this.listeners_[e].slice();for(var i=0;i<n.length;i++)n[i].callback.apply(n[i].context,t)}};e.prototype.on=function(e,t,r){this.validateEventType_(e);this.listeners_[e]=this.listeners_[e]||[];this.listeners_[e].push({callback:t,context:r});var n=this.getInitialEvent(e);n&&t.apply(r,n)};e.prototype.off=function(e,t,r){this.validateEventType_(e);var n=this.listeners_[e]||[];for(var i=0;i<n.length;i++)if(n[i].callback===t&&(!r||r===n[i].context)){n.splice(i,1);return}};e.prototype.validateEventType_=function(e){o.assert(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)};return e}();var pr=function(e){s.__extends(t,e);function t(){var t=e.call(this,["visible"])||this;var r;var n;if("undefined"!==typeof document&&"undefined"!==typeof document.addEventListener)if("undefined"!==typeof document["hidden"]){n="visibilitychange";r="hidden"}else if("undefined"!==typeof document["mozHidden"]){n="mozvisibilitychange";r="mozHidden"}else if("undefined"!==typeof document["msHidden"]){n="msvisibilitychange";r="msHidden"}else if("undefined"!==typeof document["webkitHidden"]){n="webkitvisibilitychange";r="webkitHidden"}t.visible_=true;n&&document.addEventListener(n,function(){var e=!document[r];if(e!==t.visible_){t.visible_=e;t.trigger("visible",e)}},false);return t}t.getInstance=function(){return new t};t.prototype.getInitialEvent=function(e){o.assert("visible"===e,"Unknown event type: "+e);return[this.visible_]};return t}(hr);var fr=function(e){s.__extends(t,e);function t(){var t=e.call(this,["online"])||this;t.online_=true;if("undefined"!==typeof window&&"undefined"!==typeof window.addEventListener&&!o.isMobileCordova()){window.addEventListener("online",function(){if(!t.online_){t.online_=true;t.trigger("online",true)}},false);window.addEventListener("offline",function(){if(t.online_){t.online_=false;t.trigger("online",false)}},false)}return t}t.getInstance=function(){return new t};t.prototype.getInitialEvent=function(e){o.assert("online"===e,"Unknown event type: "+e);return[this.online_]};t.prototype.currentlyOnline=function(){return this.online_};return t}(hr);var dr=function(){function e(e){this.onMessage_=e;this.pendingResponses=[];this.currentResponseNum=0;this.closeAfterResponse=-1;this.onClose=null}e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e;this.onClose=t;if(this.closeAfterResponse<this.currentResponseNum){this.onClose();this.onClose=null}};e.prototype.handleResponse=function(e,t){var r=this;this.pendingResponses[e]=t;var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];var t=function(t){e[t]&&B(function(){r.onMessage_(e[t])})};for(var n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse){if(i.onClose){i.onClose();i.onClose=null}return"break"}i.currentResponseNum++};var i=this;while(this.pendingResponses[this.currentResponseNum]){var o=n();if("break"===o)break}};return e}();var vr="start";var _r="close";var yr="pLPCommand";var gr="pRTLPCB";var mr="id";var br="pw";var Er="ser";var wr="cb";var Cr="seg";var Tr="ts";var Sr="d";var Rr="disconn";var Nr="dframe";var Or=1870;var Pr=30;var Ir=Or-Pr;var xr=25e3;var kr=3e4;var Ar=function(){function e(e,t,r,n){this.connId=e;this.repoInfo=t;this.transportSessionId=r;this.lastSessionId=n;this.bytesSent=0;this.bytesReceived=0;this.everConnected_=false;this.log_=w(e);this.stats_=nr.getCollection(t);this.urlFn=function(e){return t.connectionURL(re,e)}}e.prototype.open=function(e,t){var r=this;this.curSegmentNum=0;this.onDisconnect_=t;this.myPacketOrderer=new dr(e);this.isClosed_=false;this.connectTimeoutTimer_=setTimeout(function(){r.log_("Timed out trying to connect.");r.onClosed_();r.connectTimeoutTimer_=null},Math.floor(kr));O(function(){if(r.isClosed_)return;r.scriptTagHolder=new Dr(function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],i=e[1],o=e[2];r.incrementIncomingBytes_(e);if(!r.scriptTagHolder)return;if(r.connectTimeoutTimer_){clearTimeout(r.connectTimeoutTimer_);r.connectTimeoutTimer_=null}r.everConnected_=true;if(n==vr){r.id=i;r.password=o}else{if(n!==_r)throw new Error("Unrecognized command received: "+n);if(i){r.scriptTagHolder.sendNewPolls=false;r.myPacketOrderer.closeAfter(i,function(){r.onClosed_()})}else r.onClosed_()}},function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],i=e[1];r.incrementIncomingBytes_(e);r.myPacketOrderer.handleResponse(n,i)},function(){r.onClosed_()},r.urlFn);var e={};e[vr]="t";e[Er]=Math.floor(1e8*Math.random());r.scriptTagHolder.uniqueCallbackIdentifier&&(e[wr]=r.scriptTagHolder.uniqueCallbackIdentifier);e[Y]=K;r.transportSessionId&&(e[X]=r.transportSessionId);r.lastSessionId&&(e[ee]=r.lastSessionId);!o.isNodeSdk()&&"undefined"!==typeof location&&location.href&&-1!==location.href.indexOf(Z)&&(e[$]=J);var t=r.urlFn(e);r.log_("Connecting via long-poll to "+t);r.scriptTagHolder.addTag(t,function(){})})};e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password);this.addDisconnectPingFrame(this.id,this.password)};e.forceAllow=function(){e.forceAllow_=true};e.forceDisallow=function(){e.forceDisallow_=true};e.isAvailable=function(){return e.forceAllow_||!e.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!M()&&!U()&&!o.isNodeSdk()};e.prototype.markConnectionHealthy=function(){};e.prototype.shutdown_=function(){this.isClosed_=true;if(this.scriptTagHolder){this.scriptTagHolder.close();this.scriptTagHolder=null}if(this.myDisconnFrame){document.body.removeChild(this.myDisconnFrame);this.myDisconnFrame=null}if(this.connectTimeoutTimer_){clearTimeout(this.connectTimeoutTimer_);this.connectTimeoutTimer_=null}};e.prototype.onClosed_=function(){if(!this.isClosed_){this.log_("Longpoll is closing itself");this.shutdown_();if(this.onDisconnect_){this.onDisconnect_(this.everConnected_);this.onDisconnect_=null}}};e.prototype.close=function(){if(!this.isClosed_){this.log_("Longpoll is being closed.");this.shutdown_()}};e.prototype.send=function(e){var t=o.stringify(e);this.bytesSent+=t.length;this.stats_.incrementCounter("bytes_sent",t.length);var r=o.base64Encode(t);var n=L(r,Ir);for(var i=0;i<n.length;i++){this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]);this.curSegmentNum++}};e.prototype.addDisconnectPingFrame=function(e,t){if(o.isNodeSdk())return;this.myDisconnFrame=document.createElement("iframe");var r={};r[Nr]="t";r[mr]=e;r[br]=t;this.myDisconnFrame.src=this.urlFn(r);this.myDisconnFrame.style.display="none";document.body.appendChild(this.myDisconnFrame)};e.prototype.incrementIncomingBytes_=function(e){var t=o.stringify(e).length;this.bytesReceived+=t;this.stats_.incrementCounter("bytes_received",t)};return e}();var Dr=function(){function e(t,r,n,i){this.onDisconnect=n;this.urlFn=i;this.outstandingRequests=new Et;this.pendingSegs=[];this.currentSerial=Math.floor(1e8*Math.random());this.sendNewPolls=true;if(o.isNodeSdk()){this.commandCB=t;this.onMessageCB=r}else{this.uniqueCallbackIdentifier=v();window[yr+this.uniqueCallbackIdentifier]=t;window[gr+this.uniqueCallbackIdentifier]=r;this.myIFrame=e.createIFrame_();var a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){var s=document.domain;a='<script>document.domain="'+s+'";<\/script>'}var u="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open();this.myIFrame.doc.write(u);this.myIFrame.doc.close()}catch(e){E("frame writing exception");e.stack&&E(e.stack);E(e)}}}e.createIFrame_=function(){var e=document.createElement("iframe");e.style.display="none";if(!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{var t=e.contentWindow.document;t||E("No IE domain setting required")}catch(t){var r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document);return e};e.prototype.close=function(){var t=this;this.alive=false;if(this.myIFrame){this.myIFrame.doc.body.innerHTML="";setTimeout(function(){if(null!==t.myIFrame){document.body.removeChild(t.myIFrame);t.myIFrame=null}},Math.floor(0))}if(o.isNodeSdk()&&this.myID){var r={};r[Rr]="t";r[mr]=this.myID;r[br]=this.myPW;var n=this.urlFn(r);e.nodeRestRequest(n)}var i=this.onDisconnect;if(i){this.onDisconnect=null;i()}};e.prototype.startLongPoll=function(e,t){this.myID=e;this.myPW=t;this.alive=true;while(this.newRequest_());};e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e[mr]=this.myID;e[br]=this.myPW;e[Er]=this.currentSerial;var t=this.urlFn(e);var r="";var n=0;while(this.pendingSegs.length>0){var i=this.pendingSegs[0];if(!(i.d.length+Pr+r.length<=Or))break;var o=this.pendingSegs.shift();r=r+"&"+Cr+n+"="+o.seg+"&"+Tr+n+"="+o.ts+"&"+Sr+n+"="+o.d;n++}t+=r;this.addLongPollTag_(t,this.currentSerial);return true}return false};e.prototype.enqueueSegment=function(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r});this.alive&&this.newRequest_()};e.prototype.addLongPollTag_=function(e,t){var r=this;this.outstandingRequests.add(t,1);var n=function(){r.outstandingRequests.remove(t);r.newRequest_()};var i=setTimeout(n,Math.floor(xr));var o=function(){clearTimeout(i);n()};this.addTag(e,o)};e.prototype.addTag=function(e,t){var r=this;o.isNodeSdk()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!r.sendNewPolls)return;var n=r.myIFrame.doc.createElement("script");n.type="text/javascript";n.async=true;n.src=e;n.onload=n.onreadystatechange=function(){var e=n.readyState;if(!e||"loaded"===e||"complete"===e){n.onload=n.onreadystatechange=null;n.parentNode&&n.parentNode.removeChild(n);t()}};n.onerror=function(){E("Long-poll script failed to load: "+e);r.sendNewPolls=false;r.close()};r.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))};return e}();var Lr=16384;var Fr=45e3;var jr=null;"undefined"!==typeof MozWebSocket?jr=MozWebSocket:"undefined"!==typeof WebSocket&&(jr=WebSocket);var Mr=function(){function e(t,r,n,i){this.connId=t;this.keepaliveTimer=null;this.frames=null;this.totalFrames=0;this.bytesSent=0;this.bytesReceived=0;this.log_=w(this.connId);this.stats_=nr.getCollection(r);this.connURL=e.connectionURL_(r,n,i)}e.connectionURL_=function(e,t,r){var n={};n[Y]=K;!o.isNodeSdk()&&"undefined"!==typeof location&&location.href&&-1!==location.href.indexOf(Z)&&(n[$]=J);t&&(n[X]=t);r&&(n[ee]=r);return e.connectionURL(te,n)};e.prototype.open=function(e,t){var r=this;this.onDisconnect=t;this.onMessage=e;this.log_("Websocket connecting to "+this.connURL);this.everConnected_=false;p.set("previous_websocket_failure",true);try{if(o.isNodeSdk()){var i=o.CONSTANTS.NODE_ADMIN?"AdminNode":"Node";var a={headers:{"User-Agent":"Firebase/"+K+"/"+u.SDK_VERSION+"/"+n.platform+"/"+i}};var s=n["env"];var c=0==this.connURL.indexOf("wss://")?s["HTTPS_PROXY"]||s["https_proxy"]:s["HTTP_PROXY"]||s["http_proxy"];c&&(a["proxy"]={origin:c});this.mySock=new jr(this.connURL,[],a)}else this.mySock=new jr(this.connURL)}catch(e){this.log_("Error instantiating WebSocket.");var l=e.message||e.data;l&&this.log_(l);this.onClosed_();return}this.mySock.onopen=function(){r.log_("Websocket connected.");r.everConnected_=true};this.mySock.onclose=function(){r.log_("Websocket connection was disconnected.");r.mySock=null;r.onClosed_()};this.mySock.onmessage=function(e){r.handleIncomingFrame(e)};this.mySock.onerror=function(e){r.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&r.log_(t);r.onClosed_()}};e.prototype.start=function(){};e.forceDisallow=function(){e.forceDisallow_=true};e.isAvailable=function(){var t=false;if("undefined"!==typeof navigator&&navigator.userAgent){var r=/Android ([0-9]{0,}\.[0-9]{0,})/;var n=navigator.userAgent.match(r);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=true)}return!t&&null!==jr&&!e.forceDisallow_};e.previouslyFailed=function(){return p.isInMemoryStorage||true===p.get("previous_websocket_failure")};e.prototype.markConnectionHealthy=function(){p.remove("previous_websocket_failure")};e.prototype.appendFrame_=function(e){this.frames.push(e);if(this.frames.length==this.totalFrames){var t=this.frames.join("");this.frames=null;var r=o.jsonEval(t);this.onMessage(r)}};e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e;this.frames=[]};e.prototype.extractFrameCount_=function(e){o.assert(null===this.frames,"We already have a frame buffer");if(e.length<=6){var t=Number(e);if(!isNaN(t)){this.handleNewFrameCount_(t);return null}}this.handleNewFrameCount_(1);return e};e.prototype.handleIncomingFrame=function(e){if(null===this.mySock)return;var t=e["data"];this.bytesReceived+=t.length;this.stats_.incrementCounter("bytes_received",t.length);this.resetKeepAlive();if(null!==this.frames)this.appendFrame_(t);else{var r=this.extractFrameCount_(t);null!==r&&this.appendFrame_(r)}};e.prototype.send=function(e){this.resetKeepAlive();var t=o.stringify(e);this.bytesSent+=t.length;this.stats_.incrementCounter("bytes_sent",t.length);var r=L(t,Lr);r.length>1&&this.sendString_(String(r.length));for(var n=0;n<r.length;n++)this.sendString_(r[n])};e.prototype.shutdown_=function(){this.isClosed_=true;if(this.keepaliveTimer){clearInterval(this.keepaliveTimer);this.keepaliveTimer=null}if(this.mySock){this.mySock.close();this.mySock=null}};e.prototype.onClosed_=function(){if(!this.isClosed_){this.log_("WebSocket is closing itself");this.shutdown_();if(this.onDisconnect){this.onDisconnect(this.everConnected_);this.onDisconnect=null}}};e.prototype.close=function(){if(!this.isClosed_){this.log_("WebSocket is being closed");this.shutdown_()}};e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer);this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0");e.resetKeepAlive()},Math.floor(Fr))};e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection.");setTimeout(this.onClosed_.bind(this),0)}};e.responsesRequiredToBeHealthy=2;e.healthyTimeout=3e4;return e}();var Ur=function(){function e(e){this.initTransports_(e)}Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Ar,Mr]},enumerable:true,configurable:true});e.prototype.initTransports_=function(t){var r=Mr&&Mr["isAvailable"]();var n=r&&!Mr.previouslyFailed();if(t.webSocketOnly){r||S("wss:// URL used, but browser isn't known to support websockets.  Trying anyway.");n=true}if(n)this.transports_=[Mr];else{var i=this.transports_=[];F(e.ALL_TRANSPORTS,function(e,t){t&&t["isAvailable"]()&&i.push(t)})}};e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")};e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null};return e}();var Wr=6e4;var qr=5e3;var Vr=10240;var Br=102400;var Qr="t";var Hr="d";var Gr="s";var zr="r";var Kr="e";var Yr="o";var Xr="a";var $r="n";var Jr="p";var Zr="h";var en=function(){function e(e,t,r,n,i,o,a){this.id=e;this.repoInfo_=t;this.onMessage_=r;this.onReady_=n;this.onDisconnect_=i;this.onKill_=o;this.lastSessionId=a;this.connectionCount=0;this.pendingDataMessages=[];this.state_=0;this.log_=w("c:"+this.id+":");this.transportManager_=new Ur(t);this.log_("Connection created");this.start_()}e.prototype.start_=function(){var e=this;var t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId);this.primaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;var r=this.connReceiver_(this.conn_);var n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_;this.rx_=this.conn_;this.secondaryConn_=null;this.isHealthy_=false;setTimeout(function(){e.conn_&&e.conn_.open(r,n)},Math.floor(0));var i=t["healthyTimeout"]||0;i>0&&(this.healthyTimeout_=H(function(){e.healthyTimeout_=null;if(!e.isHealthy_)if(e.conn_&&e.conn_.bytesReceived>Br){e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy.");e.isHealthy_=true;e.conn_.markConnectionHealthy()}else if(e.conn_&&e.conn_.bytesSent>Vr)e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive.");else{e.log_("Closing unhealthy connection after timeout.");e.close()}},Math.floor(i)))};e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++};e.prototype.disconnReceiver_=function(e){var t=this;return function(r){if(e===t.conn_)t.onConnectionLost_(r);else if(e===t.secondaryConn_){t.log_("Secondary connection lost.");t.onSecondaryConnectionLost_()}else t.log_("closing an old connection")}};e.prototype.connReceiver_=function(e){var t=this;return function(r){2!=t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(r):e===t.secondaryConn_?t.onSecondaryMessageReceived_(r):t.log_("message on old connection"))}};e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)};e.prototype.tryCleanupConnection=function(){if(this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_){this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId);this.conn_=this.secondaryConn_;this.secondaryConn_=null}};e.prototype.onSecondaryControl_=function(e){if(Qr in e){var t=e[Qr];if(t===Xr)this.upgradeIfSecondaryHealthy_();else if(t===zr){this.log_("Got a reset on secondary, closing it");this.secondaryConn_.close();this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()}else if(t===Yr){this.log_("got pong on secondary.");this.secondaryResponsesRequired_--;this.upgradeIfSecondaryHealthy_()}}};e.prototype.onSecondaryMessageReceived_=function(e){var t=A("t",e);var r=A("d",e);if("c"==t)this.onSecondaryControl_(r);else{if("d"!=t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(r)}};e.prototype.upgradeIfSecondaryHealthy_=function(){if(this.secondaryResponsesRequired_<=0){this.log_("Secondary connection is healthy.");this.isHealthy_=true;this.secondaryConn_.markConnectionHealthy();this.proceedWithUpgrade_()}else{this.log_("sending ping on secondary.");this.secondaryConn_.send({t:"c",d:{t:Jr,d:{}}})}};e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start();this.log_("sending client ack on secondary");this.secondaryConn_.send({t:"c",d:{t:Xr,d:{}}});this.log_("Ending transmission on primary");this.conn_.send({t:"c",d:{t:$r,d:{}}});this.tx_=this.secondaryConn_;this.tryCleanupConnection()};e.prototype.onPrimaryMessageReceived_=function(e){var t=A("t",e);var r=A("d",e);"c"==t?this.onControl_(r):"d"==t&&this.onDataMessage_(r)};e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_();this.onMessage_(e)};e.prototype.onPrimaryResponse_=function(){if(!this.isHealthy_){this.primaryResponsesRequired_--;if(this.primaryResponsesRequired_<=0){this.log_("Primary connection is healthy.");this.isHealthy_=true;this.conn_.markConnectionHealthy()}}};e.prototype.onControl_=function(e){var t=A(Qr,e);if(Hr in e){var r=e[Hr];if(t===Zr)this.onHandshake_(r);else if(t===$r){this.log_("recvd end transmission on primary");this.rx_=this.secondaryConn_;for(var n=0;n<this.pendingDataMessages.length;++n)this.onDataMessage_(this.pendingDataMessages[n]);this.pendingDataMessages=[];this.tryCleanupConnection()}else if(t===Gr)this.onConnectionShutdown_(r);else if(t===zr)this.onReset_(r);else if(t===Kr)C("Server Error: "+r);else if(t===Yr){this.log_("got pong on primary.");this.onPrimaryResponse_();this.sendPingOnPrimaryIfNecessary_()}else C("Unknown control packet command: "+t)}};e.prototype.onHandshake_=function(e){var t=e.ts;var r=e.v;var n=e.h;this.sessionId=e.s;this.repoInfo_.updateHost(n);if(0==this.state_){this.conn_.start();this.onConnectionEstablished_(this.conn_,t);K!==r&&S("Protocol version mismatch detected");this.tryStartUpgrade_()}};e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)};e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId);this.secondaryResponsesRequired_=e["responsesRequiredToBeHealthy"]||0;var r=this.connReceiver_(this.secondaryConn_);var n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(r,n);H(function(){if(t.secondaryConn_){t.log_("Timed out trying to upgrade.");t.secondaryConn_.close()}},Math.floor(Wr))};e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e);this.repoInfo_.updateHost(e);if(1===this.state_)this.close();else{this.closeConnections_();this.start_()}};e.prototype.onConnectionEstablished_=function(e,t){var r=this;this.log_("Realtime connection established.");this.conn_=e;this.state_=1;if(this.onReady_){this.onReady_(t,this.sessionId);this.onReady_=null}if(0===this.primaryResponsesRequired_){this.log_("Primary connection is healthy.");this.isHealthy_=true}else H(function(){r.sendPingOnPrimaryIfNecessary_()},Math.floor(qr))};e.prototype.sendPingOnPrimaryIfNecessary_=function(){if(!this.isHealthy_&&1===this.state_){this.log_("sending ping on primary.");this.sendData_({t:"c",d:{t:Jr,d:{}}})}};e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null;this.tx_!==e&&this.rx_!==e||this.close()};e.prototype.onConnectionLost_=function(e){this.conn_=null;if(e||0!==this.state_)1===this.state_&&this.log_("Realtime connection lost.");else{this.log_("Realtime connection failed.");if(this.repoInfo_.isCacheableHost()){p.remove("host:"+this.repoInfo_.host);this.repoInfo_.internalHost=this.repoInfo_.host}}this.close()};e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down...");if(this.onKill_){this.onKill_(e);this.onKill_=null}this.onDisconnect_=null;this.close()};e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)};e.prototype.close=function(){if(2!==this.state_){this.log_("Closing realtime connection.");this.state_=2;this.closeConnections_();if(this.onDisconnect_){this.onDisconnect_();this.onDisconnect_=null}}};e.prototype.closeConnections_=function(){this.log_("Shutting down all connections");if(this.conn_){this.conn_.close();this.conn_=null}if(this.secondaryConn_){this.secondaryConn_.close();this.secondaryConn_=null}if(this.healthyTimeout_){clearTimeout(this.healthyTimeout_);this.healthyTimeout_=null}};return e}();var tn=function(){function e(){}e.prototype.put=function(e,t,r,n){};e.prototype.merge=function(e,t,r,n){};e.prototype.refreshAuthToken=function(e){};e.prototype.onDisconnectPut=function(e,t,r){};e.prototype.onDisconnectMerge=function(e,t,r){};e.prototype.onDisconnectCancel=function(e,t){};e.prototype.reportStats=function(e){};return e}();var rn=1e3;var nn=3e5;var on=3e4;var an=1.3;var sn=3e4;var un="server_kill";var cn=3;var ln=function(e){s.__extends(t,e);function t(r,n,i,a,s,u){var c=e.call(this)||this;c.repoInfo_=r;c.onDataUpdate_=n;c.onConnectStatus_=i;c.onServerInfoUpdate_=a;c.authTokenProvider_=s;c.authOverride_=u;c.id=t.nextPersistentConnectionId_++;c.log_=w("p:"+c.id+":");c.interruptReasons_={};c.listens_={};c.outstandingPuts_=[];c.outstandingPutCount_=0;c.onDisconnectRequestQueue_=[];c.connected_=false;c.reconnectDelay_=rn;c.maxReconnectDelay_=nn;c.securityDebugCallback_=null;c.lastSessionId=null;c.establishConnectionTimer_=null;c.visible_=false;c.requestCBHash_={};c.requestNumber_=0;c.realtime_=null;c.authToken_=null;c.forceTokenRefresh_=false;c.invalidAuthTokenCount_=0;c.firstConnection_=true;c.lastConnectionAttemptTime_=null;c.lastConnectionEstablishedTime_=null;if(u&&!o.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");c.scheduleConnect_(0);pr.getInstance().on("visible",c.onVisible_,c);-1===r.host.indexOf("fblocal")&&fr.getInstance().on("online",c.onOnline_,c);return c}t.prototype.sendRequest=function(e,t,r){var n=++this.requestNumber_;var i={r:n,a:e,b:t};this.log_(o.stringify(i));o.assert(this.connected_,"sendRequest call when we're not connected not allowed.");this.realtime_.sendRequest(i);r&&(this.requestCBHash_[n]=r)};t.prototype.listen=function(e,t,r,n){var i=e.queryIdentifier();var a=e.path.toString();this.log_("Listen called for "+a+" "+i);this.listens_[a]=this.listens_[a]||{};o.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query");o.assert(!this.listens_[a][i],"listen() called twice for same path/queryId.");var s={onComplete:n,hashFn:t,query:e,tag:r};this.listens_[a][i]=s;this.connected_&&this.sendListen_(s)};t.prototype.sendListen_=function(e){var r=this;var n=e.query;var i=n.path.toString();var o=n.queryIdentifier();this.log_("Listen on "+i+" for "+o);var a={p:i};var s="q";if(e.tag){a["q"]=n.queryObject();a["t"]=e.tag}a["h"]=e.hashFn();this.sendRequest(s,a,function(a){var s=a["d"];var u=a["s"];t.warnOnListenWarnings_(s,n);var c=r.listens_[i]&&r.listens_[i][o];if(c===e){r.log_("listen response",a);"ok"!==u&&r.removeListen_(i,o);e.onComplete&&e.onComplete(u,s)}})};t.warnOnListenWarnings_=function(e,t){if(e&&"object"===typeof e&&o.contains(e,"w")){var r=o.safeGet(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){var n='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"';var i=t.path.toString();S("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+n+" at "+i+" to your security rules for better performance.")}}};t.prototype.refreshAuthToken=function(e){this.authToken_=e;this.log_("Auth token refreshed");this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){});this.reduceReconnectDelayIfAdminCredential_(e)};t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){var t=e&&40===e.length;if(t||o.isAdmin(e)){this.log_("Admin auth credential detected.  Reducing max reconnect time.");this.maxReconnectDelay_=on}};t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_;var r=o.isValidFormat(t)?"auth":"gauth";var n={cred:t};null===this.authOverride_?n["noauth"]=true:"object"===typeof this.authOverride_&&(n["authvar"]=this.authOverride_);this.sendRequest(r,n,function(r){var n=r["s"];var i=r["d"]||"error";e.authToken_===t&&("ok"===n?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(n,i))})}};t.prototype.unlisten=function(e,t){var r=e.path.toString();var n=e.queryIdentifier();this.log_("Unlisten called for "+r+" "+n);o.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query");var i=this.removeListen_(r,n);i&&this.connected_&&this.sendUnlisten_(r,n,e.queryObject(),t)};t.prototype.sendUnlisten_=function(e,t,r,n){this.log_("Unlisten on "+e+" for "+t);var i={p:e};var o="n";if(n){i["q"]=r;i["t"]=n}this.sendRequest(o,i)};t.prototype.onDisconnectPut=function(e,t,r){this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})};t.prototype.onDisconnectMerge=function(e,t,r){this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})};t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})};t.prototype.sendOnDisconnect_=function(e,t,r,n){var i={p:t,d:r};this.log_("onDisconnect "+e,i);this.sendRequest(e,i,function(e){n&&setTimeout(function(){n(e["s"],e["d"])},Math.floor(0))})};t.prototype.put=function(e,t,r,n){this.putInternal("p",e,t,r,n)};t.prototype.merge=function(e,t,r,n){this.putInternal("m",e,t,r,n)};t.prototype.putInternal=function(e,t,r,n,i){var o={p:t,d:r};void 0!==i&&(o["h"]=i);this.outstandingPuts_.push({action:e,request:o,onComplete:n});this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)};t.prototype.sendPut_=function(e){var t=this;var r=this.outstandingPuts_[e].action;var n=this.outstandingPuts_[e].request;var i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_;this.sendRequest(r,n,function(n){t.log_(r+" response",n);delete t.outstandingPuts_[e];t.outstandingPutCount_--;0===t.outstandingPutCount_&&(t.outstandingPuts_=[]);i&&i(n["s"],n["d"])})};t.prototype.reportStats=function(e){var t=this;if(this.connected_){var r={c:e};this.log_("reportStats",r);this.sendRequest("s",r,function(e){var r=e["s"];if("ok"!==r){var n=e["d"];t.log_("reportStats","Error sending stats: "+n)}})}};t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+o.stringify(e));var t=e["r"];var r=this.requestCBHash_[t];if(r){delete this.requestCBHash_[t];r(e["b"])}}else{if("error"in e)throw"A server-side error has occurred: "+e["error"];"a"in e&&this.onDataPush_(e["a"],e["b"])}};t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t);"d"===e?this.onDataUpdate_(t["p"],t["d"],false,t["t"]):"m"===e?this.onDataUpdate_(t["p"],t["d"],true,t["t"]):"c"===e?this.onListenRevoked_(t["p"],t["q"]):"ac"===e?this.onAuthRevoked_(t["s"],t["d"]):"sd"===e?this.onSecurityDebugPacket_(t):C("Unrecognized action received from server: "+o.stringify(e)+"\nAre you using the latest client?")};t.prototype.onReady_=function(e,t){this.log_("connection ready");this.connected_=true;this.lastConnectionEstablishedTime_=(new Date).getTime();this.handleTimestamp_(e);this.lastSessionId=t;this.firstConnection_&&this.sendConnectStats_();this.restoreState_();this.firstConnection_=false;this.onConnectStatus_(true)};t.prototype.scheduleConnect_=function(e){var t=this;o.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?");this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_);this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null;t.establishConnection_()},Math.floor(e))};t.prototype.onVisible_=function(e){if(e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_){this.log_("Window became visible.  Reducing delay.");this.reconnectDelay_=rn;this.realtime_||this.scheduleConnect_(0)}this.visible_=e};t.prototype.onOnline_=function(e){if(e){this.log_("Browser went online.");this.reconnectDelay_=rn;this.realtime_||this.scheduleConnect_(0)}else{this.log_("Browser went offline.  Killing connection.");this.realtime_&&this.realtime_.close()}};t.prototype.onRealtimeDisconnect_=function(){this.log_("data client disconnected");this.connected_=false;this.realtime_=null;this.cancelSentTransactions_();this.requestCBHash_={};if(this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){var e=(new Date).getTime()-this.lastConnectionEstablishedTime_;e>sn&&(this.reconnectDelay_=rn);this.lastConnectionEstablishedTime_=null}}else{this.log_("Window isn't visible.  Delaying reconnect.");this.reconnectDelay_=this.maxReconnectDelay_;this.lastConnectionAttemptTime_=(new Date).getTime()}var t=(new Date).getTime()-this.lastConnectionAttemptTime_;var r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r;this.log_("Trying to reconnect in "+r+"ms");this.scheduleConnect_(r);this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*an)}this.onConnectStatus_(false)};t.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt");this.lastConnectionAttemptTime_=(new Date).getTime();this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this);var r=this.onReady_.bind(this);var n=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+t.nextConnectionId_++;var a=this;var s=this.lastSessionId;var u=false;var c=null;var l=function(){if(c)c.close();else{u=true;n()}};var h=function(e){o.assert(c,"sendRequest call when we're not connected not allowed.");c.sendRequest(e)};this.realtime_={close:l,sendRequest:h};var p=this.forceTokenRefresh_;this.forceTokenRefresh_=false;this.authTokenProvider_.getToken(p).then(function(t){if(u)E("getToken() completed but was canceled");else{E("getToken() completed. Creating connection.");a.authToken_=t&&t.accessToken;c=new en(i,a.repoInfo_,e,r,n,function(e){S(e+" ("+a.repoInfo_.toString()+")");a.interrupt(un)},s)}}).then(null,function(e){a.log_("Failed to get token: "+e);if(!u){o.CONSTANTS.NODE_ADMIN&&S(e);l()}})}};t.prototype.interrupt=function(e){E("Interrupting connection for reason: "+e);this.interruptReasons_[e]=true;if(this.realtime_)this.realtime_.close();else{if(this.establishConnectionTimer_){clearTimeout(this.establishConnectionTimer_);this.establishConnectionTimer_=null}this.connected_&&this.onRealtimeDisconnect_()}};t.prototype.resume=function(e){E("Resuming connection for reason: "+e);delete this.interruptReasons_[e];if(o.isEmpty(this.interruptReasons_)){this.reconnectDelay_=rn;this.realtime_||this.scheduleConnect_(0)}};t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})};t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];if(t&&"h"in t.request&&t.queued){t.onComplete&&t.onComplete("disconnect");delete this.outstandingPuts_[e];this.outstandingPutCount_--}}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])};t.prototype.onListenRevoked_=function(e,t){var r;r=t?t.map(function(e){return D(e)}).join("$"):"default";var n=this.removeListen_(e,r);n&&n.onComplete&&n.onComplete("permission_denied")};t.prototype.removeListen_=function(e,t){var r=new G(e).toString();var n;if(void 0!==this.listens_[r]){n=this.listens_[r][t];delete this.listens_[r][t];0===o.getCount(this.listens_[r])&&delete this.listens_[r]}else n=void 0;return n};t.prototype.onAuthRevoked_=function(e,t){E("Auth token revoked: "+e+"/"+t);this.authToken_=null;this.forceTokenRefresh_=true;this.realtime_.close();if("invalid_token"===e||"permission_denied"===e){this.invalidAuthTokenCount_++;if(this.invalidAuthTokenCount_>=cn){this.reconnectDelay_=on;this.authTokenProvider_.notifyForInvalidToken()}}};t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e["msg"].replace("\n","\nFIREBASE: "))};t.prototype.restoreState_=function(){var e=this;this.tryAuth();o.forEach(this.listens_,function(t,r){o.forEach(r,function(t,r){e.sendListen_(r)})});for(var t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);while(this.onDisconnectRequestQueue_.length){var r=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(r.action,r.pathString,r.data,r.onComplete)}};t.prototype.sendConnectStats_=function(){var e={};var t="js";o.CONSTANTS.NODE_ADMIN?t="admin_node":o.CONSTANTS.NODE_CLIENT&&(t="node");e["sdk."+t+"."+u.SDK_VERSION.replace(/\./g,"-")]=1;o.isMobileCordova()?e["framework.cordova"]=1:o.isReactNative()&&(e["framework.reactnative"]=1);this.reportStats(e)};t.prototype.shouldReconnect_=function(){var e=fr.getInstance().currentlyOnline();return o.isEmpty(this.interruptReasons_)&&e};t.nextPersistentConnectionId_=0;t.nextConnectionId_=0;return t}(tn);var hn=function(e){s.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.repoInfo_=t;i.onDataUpdate_=r;i.authTokenProvider_=n;i.log_=w("p:rest:");i.listens_={};return i}t.prototype.reportStats=function(e){throw new Error("Method not implemented.")};t.getListenId_=function(e,t){if(void 0!==t)return"tag$"+t;o.assert(e.getQueryParams().isDefault(),"should have a tag if it's not a default query.");return e.path.toString()};t.prototype.listen=function(e,r,n,i){var a=this;var s=e.path.toString();this.log_("Listen called for "+s+" "+e.queryIdentifier());var u=t.getListenId_(e,n);var c={};this.listens_[u]=c;var l=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",l,function(e,t){var r=t;if(404===e){r=null;e=null}null===e&&a.onDataUpdate_(s,r,false,n);if(o.safeGet(a.listens_,u)===c){var l;l=e?401==e?"permission_denied":"rest_error:"+e:"ok";i(l,null)}})};t.prototype.unlisten=function(e,r){var n=t.getListenId_(e,r);delete this.listens_[n]};t.prototype.refreshAuthToken=function(e){};t.prototype.restRequest_=function(e,t,r){var n=this;void 0===t&&(t={});t["format"]="export";this.authTokenProvider_.getToken(false).then(function(i){var a=i&&i.accessToken;a&&(t["auth"]=a);var s=(n.repoInfo_.secure?"https://":"http://")+n.repoInfo_.host+e+"?"+o.querystring(t);n.log_("Sending REST request for "+s);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(r&&4===u.readyState){n.log_("REST Response for "+s+" received. status:",u.status,"response:",u.responseText);var e=null;if(u.status>=200&&u.status<300){try{e=o.jsonEval(u.responseText)}catch(e){S("Failed to parse JSON response for "+s+": "+u.responseText)}r(null,e)}else{401!==u.status&&404!==u.status&&S("Got unsuccessful REST response for "+s+" Status: "+u.status);r(u.status)}r=null}};u.open("GET",s,true);u.send()})};return t}(tn);var pn="repo_interrupt";var fn=function(){function e(e,t,r){var n=this;this.repoInfo_=e;this.app=r;this.dataUpdateCount=0;this.statsListener_=null;this.eventQueue_=new cr;this.nextWriteId_=1;this.interceptServerDataCallback_=null;this.onDisconnect_=new wt;this.persistentConnection_=null;var i=new tr(r);this.stats_=nr.getCollection(e);if(t||Q()){this.server_=new hn(this.repoInfo_,this.onDataUpdate_.bind(this),i);setTimeout(this.onConnectStatus_.bind(this,true),0)}else{var a=r.options["databaseAuthVariableOverride"];if("undefined"!==typeof a&&null!==a){if("object"!==typeof a)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{o.stringify(a)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}this.persistentConnection_=new ln(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,a);this.server_=this.persistentConnection_}i.addTokenChangeListener(function(e){n.server_.refreshAuthToken(e)});this.statsReporter_=nr.getOrCreateReporter(e,function(){return new ur(n.stats_,n.server_)});this.transactions_init_();this.infoData_=new er;this.infoSyncTree_=new Zt({startListening:function(e,t,r,i){var o=[];var a=n.infoData_.getNode(e.path);if(!a.isEmpty()){o=n.infoSyncTree_.applyServerOverwrite(e.path,a);setTimeout(function(){i("ok")},0)}return o},stopListening:function(){}});this.updateInfo_("connected",false);this.serverSyncTree_=new Zt({startListening:function(e,t,r,i){n.server_.listen(e,r,t,function(t,r){var o=i(t,r);n.eventQueue_.raiseEventsForChangedPath(e.path,o)});return[]},stopListening:function(e,t){n.server_.unlisten(e,t)}})}e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host};e.prototype.name=function(){return this.repoInfo_.namespace};e.prototype.serverTime=function(){var e=this.infoData_.getNode(new G(".info/serverTimeOffset"));var t=e.val()||0;return(new Date).getTime()+t};e.prototype.generateServerValues=function(){return Ct({timestamp:this.serverTime()})};e.prototype.onDataUpdate_=function(e,t,r,n){this.dataUpdateCount++;var i=new G(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var a=[];if(n)if(r){var s=o.map(t,function(e){return lt(e)});a=this.serverSyncTree_.applyTaggedQueryMerge(i,s,n)}else{var u=lt(t);a=this.serverSyncTree_.applyTaggedQueryOverwrite(i,u,n)}else if(r){var c=o.map(t,function(e){return lt(e)});a=this.serverSyncTree_.applyServerMerge(i,c)}else{var l=lt(t);a=this.serverSyncTree_.applyServerOverwrite(i,l)}var h=i;a.length>0&&(h=this.rerunTransactions_(i));this.eventQueue_.raiseEventsForChangedPath(h,a)};e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e};e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e);false===e&&this.runOnDisconnectEvents_()};e.prototype.onServerInfoUpdate_=function(e){var t=this;F(e,function(e,r){t.updateInfo_(r,e)})};e.prototype.updateInfo_=function(e,t){var r=new G("/.info/"+e);var n=lt(t);this.infoData_.updateSnapshot(r,n);var i=this.infoSyncTree_.applyServerOverwrite(r,n);this.eventQueue_.raiseEventsForChangedPath(r,i)};e.prototype.getNextWriteId_=function(){return this.nextWriteId_++};e.prototype.setWithPriority=function(e,t,r,n){var i=this;this.log_("set",{path:e.toString(),value:t,priority:r});var o=this.generateServerValues();var a=lt(t,r);var s=Rt(a,o);var u=this.getNextWriteId_();var c=this.serverSyncTree_.applyUserOverwrite(e,s,u,true);this.eventQueue_.queueEvents(c);this.server_.put(e.toString(),a.val(true),function(t,r){var o="ok"===t;o||S("set at "+e+" failed: "+t);var a=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(e,a);i.callOnCompleteCallback(n,t,r)});var l=this.abortTransactions_(e);this.rerunTransactions_(l);this.eventQueue_.raiseEventsForChangedPath(l,[])};e.prototype.update=function(e,t,r){var n=this;this.log_("update",{path:e.toString(),value:t});var i=true;var a=this.generateServerValues();var s={};o.forEach(t,function(e,t){i=false;var r=lt(t);s[e]=Rt(r,a)});if(i){E("update() called with empty data.  Don't do anything.");this.callOnCompleteCallback(r,"ok")}else{var u=this.getNextWriteId_();var c=this.serverSyncTree_.applyUserMerge(e,s,u);this.eventQueue_.queueEvents(c);this.server_.merge(e.toString(),t,function(t,i){var o="ok"===t;o||S("update at "+e+" failed: "+t);var a=n.serverSyncTree_.ackUserWrite(u,!o);var s=a.length>0?n.rerunTransactions_(e):e;n.eventQueue_.raiseEventsForChangedPath(s,a);n.callOnCompleteCallback(r,t,i)});o.forEach(t,function(t){var r=n.abortTransactions_(e.child(t));n.rerunTransactions_(r)});this.eventQueue_.raiseEventsForChangedPath(e,[])}};e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues();var r=St(this.onDisconnect_,t);var n=[];r.forEachTree(G.Empty,function(t,r){n=n.concat(e.serverSyncTree_.applyServerOverwrite(t,r));var i=e.abortTransactions_(t);e.rerunTransactions_(i)});this.onDisconnect_=new wt;this.eventQueue_.raiseEventsForChangedPath(G.Empty,n)};e.prototype.onDisconnectCancel=function(e,t){var r=this;this.server_.onDisconnectCancel(e.toString(),function(n,i){"ok"===n&&r.onDisconnect_.forget(e);r.callOnCompleteCallback(t,n,i)})};e.prototype.onDisconnectSet=function(e,t,r){var n=this;var i=lt(t);this.server_.onDisconnectPut(e.toString(),i.val(true),function(t,o){"ok"===t&&n.onDisconnect_.remember(e,i);n.callOnCompleteCallback(r,t,o)})};e.prototype.onDisconnectSetWithPriority=function(e,t,r,n){var i=this;var o=lt(t,r);this.server_.onDisconnectPut(e.toString(),o.val(true),function(t,r){"ok"===t&&i.onDisconnect_.remember(e,o);i.callOnCompleteCallback(n,t,r)})};e.prototype.onDisconnectUpdate=function(e,t,r){var n=this;if(o.isEmpty(t)){E("onDisconnect().update() called with empty data.  Don't do anything.");this.callOnCompleteCallback(r,"ok");return}this.server_.onDisconnectMerge(e.toString(),t,function(i,a){"ok"===i&&o.forEach(t,function(t,r){var i=lt(r);n.onDisconnect_.remember(e.child(t),i)});n.callOnCompleteCallback(r,i,a)})};e.prototype.addEventCallbackForQuery=function(e,t){var r;r=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t);this.eventQueue_.raiseEventsAtPath(e.path,r)};e.prototype.removeEventCallbackForQuery=function(e,t){var r;r=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t);this.eventQueue_.raiseEventsAtPath(e.path,r)};e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(pn)};e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(pn)};e.prototype.stats=function(e){void 0===e&&(e=false);if("undefined"===typeof console)return;var t;if(e){this.statsListener_||(this.statsListener_=new ir(this.stats_));t=this.statsListener_.get()}else t=this.stats_.get();var r=Object.keys(t).reduce(function(e,t){return Math.max(t.length,e)},0);o.forEach(t,function(e,t){for(var n=e.length;n<r+2;n++)e+=" ";console.log(e+t)})};e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e);this.statsReporter_.includeStat(e)};e.prototype.log_=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var r="";this.persistentConnection_&&(r=this.persistentConnection_.id+":");E.apply(void 0,[r].concat(e))};e.prototype.callOnCompleteCallback=function(e,t,r){e&&B(function(){if("ok"==t)e(null);else{var n=(t||"error").toUpperCase();var i=n;r&&(i+=": "+r);var o=new Error(i);o.code=n;e(o)}})};Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new Tn(this))},enumerable:true,configurable:true});return e}();var dn=function(){function e(t){this.indexedFilter_=new Ut(t.getIndex());this.index_=t.getIndex();this.startPost_=e.getStartPost_(t);this.endPost_=e.getEndPost_(t)}e.prototype.getStartPost=function(){return this.startPost_};e.prototype.getEndPost=function(){return this.endPost_};e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0};e.prototype.updateChild=function(e,t,r,n,i,o){this.matches(new Ie(t,r))||(r=at.EMPTY_NODE);return this.indexedFilter_.updateChild(e,t,r,n,i,o)};e.prototype.updateFullNode=function(e,t,r){t.isLeafNode()&&(t=at.EMPTY_NODE);var n=t.withIndex(this.index_);n=n.updatePriority(at.EMPTY_NODE);var i=this;t.forEachChild(Ge,function(e,t){i.matches(new Ie(e,t))||(n=n.updateImmediateChild(e,at.EMPTY_NODE))});return this.indexedFilter_.updateFullNode(e,n,r)};e.prototype.updatePriority=function(e,t){return e};e.prototype.filtersNodes=function(){return true};e.prototype.getIndexedFilter=function(){return this.indexedFilter_};e.prototype.getIndex=function(){return this.index_};e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()};e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()};return e}();var vn=function(){function e(e){this.rangedFilter_=new dn(e);this.index_=e.getIndex();this.limit_=e.getLimit();this.reverse_=!e.isViewFromLeft()}e.prototype.updateChild=function(e,t,r,n,i,o){this.rangedFilter_.matches(new Ie(t,r))||(r=at.EMPTY_NODE);return e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,n,i,o):this.fullLimitUpdateChild_(e,t,r,i,o)};e.prototype.updateFullNode=function(e,t,r){var n;if(t.isLeafNode()||t.isEmpty())n=at.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){n=at.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);var o=0;while(i.hasNext()&&o<this.limit_){var a=i.getNext();var s=void 0;s=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0;if(!s)break;n=n.updateImmediateChild(a.name,a.node);o++}}else{n=t.withIndex(this.index_);n=n.updatePriority(at.EMPTY_NODE);var u=void 0;var c=void 0;var l=void 0;var i=void 0;if(this.reverse_){i=n.getReverseIterator(this.index_);u=this.rangedFilter_.getEndPost();c=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();l=function(e,t){return h(t,e)}}else{i=n.getIterator(this.index_);u=this.rangedFilter_.getStartPost();c=this.rangedFilter_.getEndPost();l=this.index_.getCompare()}var o=0;var p=false;while(i.hasNext()){var a=i.getNext();!p&&l(u,a)<=0&&(p=true);var s=p&&o<this.limit_&&l(a,c)<=0;s?o++:n=n.updateImmediateChild(a.name,at.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,n,r)};e.prototype.updatePriority=function(e,t){return e};e.prototype.filtersNodes=function(){return true};e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()};e.prototype.getIndex=function(){return this.index_};e.prototype.fullLimitUpdateChild_=function(e,t,r,n,i){var a;if(this.reverse_){var s=this.index_.getCompare();a=function(e,t){return s(t,e)}}else a=this.index_.getCompare();var u=e;o.assert(u.numChildren()==this.limit_,"");var c=new Ie(t,r);var l=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_);var h=this.rangedFilter_.matches(c);if(u.hasChild(t)){var p=u.getImmediateChild(t);var f=n.getChildAfterChild(this.index_,l,this.reverse_);while(null!=f&&(f.name==t||u.hasChild(f.name)))f=n.getChildAfterChild(this.index_,f,this.reverse_);var d=null==f?1:a(f,c);var v=h&&!r.isEmpty()&&d>=0;if(v){null!=i&&i.trackChildChange(Mt.childChangedChange(t,r,p));return u.updateImmediateChild(t,r)}null!=i&&i.trackChildChange(Mt.childRemovedChange(t,p));var _=u.updateImmediateChild(t,at.EMPTY_NODE);var y=null!=f&&this.rangedFilter_.matches(f);if(y){null!=i&&i.trackChildChange(Mt.childAddedChange(f.name,f.node));return _.updateImmediateChild(f.name,f.node)}return _}if(r.isEmpty())return e;if(h){if(a(l,c)>=0){if(null!=i){i.trackChildChange(Mt.childRemovedChange(l.name,l.node));i.trackChildChange(Mt.childAddedChange(t,r))}return u.updateImmediateChild(t,r).updateImmediateChild(l.name,at.EMPTY_NODE)}return e}return e};return e}();var _n=function(){function e(){this.limitSet_=false;this.startSet_=false;this.startNameSet_=false;this.endSet_=false;this.endNameSet_=false;this.limit_=0;this.viewFrom_="";this.indexStartValue_=null;this.indexStartName_="";this.indexEndValue_=null;this.indexEndName_="";this.index_=Ge}e.prototype.hasStart=function(){return this.startSet_};e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT};e.prototype.getIndexStartValue=function(){o.assert(this.startSet_,"Only valid if start has been set");return this.indexStartValue_};e.prototype.getIndexStartName=function(){o.assert(this.startSet_,"Only valid if start has been set");return this.startNameSet_?this.indexStartName_:P};e.prototype.hasEnd=function(){return this.endSet_};e.prototype.getIndexEndValue=function(){o.assert(this.endSet_,"Only valid if end has been set");return this.indexEndValue_};e.prototype.getIndexEndName=function(){o.assert(this.endSet_,"Only valid if end has been set");return this.endNameSet_?this.indexEndName_:I};e.prototype.hasLimit=function(){return this.limitSet_};e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_};e.prototype.getLimit=function(){o.assert(this.limitSet_,"Only valid if limit has been set");return this.limit_};e.prototype.getIndex=function(){return this.index_};e.prototype.copy_=function(){var t=new e;t.limitSet_=this.limitSet_;t.limit_=this.limit_;t.startSet_=this.startSet_;t.indexStartValue_=this.indexStartValue_;t.startNameSet_=this.startNameSet_;t.indexStartName_=this.indexStartName_;t.endSet_=this.endSet_;t.indexEndValue_=this.indexEndValue_;t.endNameSet_=this.endNameSet_;t.indexEndName_=this.indexEndName_;t.index_=this.index_;t.viewFrom_=this.viewFrom_;return t};e.prototype.limit=function(e){var t=this.copy_();t.limitSet_=true;t.limit_=e;t.viewFrom_="";return t};e.prototype.limitToFirst=function(t){var r=this.copy_();r.limitSet_=true;r.limit_=t;r.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;return r};e.prototype.limitToLast=function(t){var r=this.copy_();r.limitSet_=true;r.limit_=t;r.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT;return r};e.prototype.startAt=function(e,t){var r=this.copy_();r.startSet_=true;void 0!==e||(e=null);r.indexStartValue_=e;if(null!=t){r.startNameSet_=true;r.indexStartName_=t}else{r.startNameSet_=false;r.indexStartName_=""}return r};e.prototype.endAt=function(e,t){var r=this.copy_();r.endSet_=true;void 0!==e||(e=null);r.indexEndValue_=e;if(void 0!==t){r.endNameSet_=true;r.indexEndName_=t}else{r.endNameSet_=false;r.indexEndName_=""}return r};e.prototype.orderBy=function(e){var t=this.copy_();t.index_=e;return t};e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_;var r={};if(this.startSet_){r[t.INDEX_START_VALUE]=this.indexStartValue_;this.startNameSet_&&(r[t.INDEX_START_NAME]=this.indexStartName_)}if(this.endSet_){r[t.INDEX_END_VALUE]=this.indexEndValue_;this.endNameSet_&&(r[t.INDEX_END_NAME]=this.indexEndName_)}if(this.limitSet_){r[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT);r[t.VIEW_FROM]=n}this.index_!==Ge&&(r[t.INDEX]=this.index_.toString());return r};e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)};e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Ge};e.prototype.getNodeFilter=function(){return this.loadsAllData()?new Ut(this.getIndex()):this.hasLimit()?new vn(this):new dn(this)};e.prototype.toRestQueryStringParameters=function(){var t=e.REST_QUERY_CONSTANTS_;var r={};if(this.isDefault())return r;var n;if(this.index_===Ge)n=t.PRIORITY_INDEX;else if(this.index_===pt)n=t.VALUE_INDEX;else if(this.index_===De)n=t.KEY_INDEX;else{o.assert(this.index_ instanceof ft,"Unrecognized index type!");n=this.index_.toString()}r[t.ORDER_BY]=o.stringify(n);if(this.startSet_){r[t.START_AT]=o.stringify(this.indexStartValue_);this.startNameSet_&&(r[t.START_AT]+=","+o.stringify(this.indexStartName_))}if(this.endSet_){r[t.END_AT]=o.stringify(this.indexEndValue_);this.endNameSet_&&(r[t.END_AT]+=","+o.stringify(this.indexEndName_))}this.limitSet_&&(this.isViewFromLeft()?r[t.LIMIT_TO_FIRST]=this.limit_:r[t.LIMIT_TO_LAST]=this.limit_);return r};e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"};e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"};e.DEFAULT=new e;return e}();var yn=function(e){s.__extends(t,e);function t(t,r){var n=this;if(!(t instanceof fn))throw new Error("new Reference() no longer supported - use app.database().");n=e.call(this,t,r,_n.DEFAULT,false)||this;return n}t.prototype.getKey=function(){o.validateArgCount("Reference.key",0,0,arguments.length);return this.path.isEmpty()?null:this.path.getBack()};t.prototype.child=function(e){o.validateArgCount("Reference.child",1,1,arguments.length);"number"===typeof e?e=String(e):e instanceof G||(null===this.path.getFront()?Ce("Reference.child",1,e,false):we("Reference.child",1,e,false));return new t(this.repo,this.path.child(e))};t.prototype.getParent=function(){o.validateArgCount("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new t(this.repo,e)};t.prototype.getRoot=function(){o.validateArgCount("Reference.root",0,0,arguments.length);var e=this;while(null!==e.getParent())e=e.getParent();return e};t.prototype.databaseProp=function(){return this.repo.database};t.prototype.set=function(e,t){o.validateArgCount("Reference.set",1,2,arguments.length);Te("Reference.set",this.path);ve("Reference.set",1,e,this.path,false);o.validateCallback("Reference.set",2,t,true);var r=new o.Deferred;this.repo.setWithPriority(this.path,e,null,r.wrapCallback(t));return r.promise};t.prototype.update=function(e,t){o.validateArgCount("Reference.update",1,2,arguments.length);Te("Reference.update",this.path);if(Array.isArray(e)){var r={};for(var n=0;n<e.length;++n)r[""+n]=e[n];e=r;S("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ge("Reference.update",1,e,this.path,false);o.validateCallback("Reference.update",2,t,true);var i=new o.Deferred;this.repo.update(this.path,e,i.wrapCallback(t));return i.promise};t.prototype.setWithPriority=function(e,t,r){o.validateArgCount("Reference.setWithPriority",2,3,arguments.length);Te("Reference.setWithPriority",this.path);ve("Reference.setWithPriority",1,e,this.path,false);me("Reference.setWithPriority",2,t,false);o.validateCallback("Reference.setWithPriority",3,r,true);if(".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var n=new o.Deferred;this.repo.setWithPriority(this.path,e,t,n.wrapCallback(r));return n.promise};t.prototype.remove=function(e){o.validateArgCount("Reference.remove",0,1,arguments.length);Te("Reference.remove",this.path);o.validateCallback("Reference.remove",1,e,true);return this.set(null,e)};t.prototype.transaction=function(e,t,r){o.validateArgCount("Reference.transaction",1,3,arguments.length);Te("Reference.transaction",this.path);o.validateCallback("Reference.transaction",1,e,false);o.validateCallback("Reference.transaction",2,t,true);Re("Reference.transaction",3,r,true);if(".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===r&&(r=true);var n=new o.Deferred;"function"===typeof t&&n.promise.catch(function(){});var i=function(e,r,i){e?n.reject(e):n.resolve(new Oe(r,i));"function"===typeof t&&t(e,r,i)};this.repo.startTransaction(this.path,e,i,r);return n.promise};t.prototype.setPriority=function(e,t){o.validateArgCount("Reference.setPriority",1,2,arguments.length);Te("Reference.setPriority",this.path);me("Reference.setPriority",1,e,false);o.validateCallback("Reference.setPriority",2,t,true);var r=new o.Deferred;this.repo.setWithPriority(this.path.child(".priority"),e,null,r.wrapCallback(t));return r.promise};t.prototype.push=function(e,t){o.validateArgCount("Reference.push",0,2,arguments.length);Te("Reference.push",this.path);ve("Reference.push",1,e,this.path,true);o.validateCallback("Reference.push",2,t,true);var r=this.repo.serverTime();var n=Pe(r);var i=this.child(n);var a=this.child(n);var s;s=null!=e?i.set(e,t).then(function(){return a}):Promise.resolve(a);i.then=s.then.bind(s);i.catch=s.then.bind(s,void 0);"function"===typeof t&&s.catch(function(){});return i};t.prototype.onDisconnect=function(){Te("Reference.onDisconnect",this.path);return new Ne(this.repo,this.path)};Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:true,configurable:true});return t}(bt);bt.__referenceConstructor=yn;Yt.__referenceConstructor=yn;var gn=function(){function e(){this.children={};this.childCount=0;this.value=null}return e}();var mn=function(){function e(e,t,r){void 0===e&&(e="");void 0===t&&(t=null);void 0===r&&(r=new gn);this.name_=e;this.parent_=t;this.node_=r}e.prototype.subTree=function(t){var r=t instanceof G?t:new G(t);var n=this,i;while(null!==(i=r.getFront())){var a=o.safeGet(n.node_.children,i)||new gn;n=new e(i,n,a);r=r.popFront()}return n};e.prototype.getValue=function(){return this.node_.value};e.prototype.setValue=function(e){o.assert("undefined"!==typeof e,"Cannot set value to undefined");this.node_.value=e;this.updateParents_()};e.prototype.clear=function(){this.node_.value=null;this.node_.children={};this.node_.childCount=0;this.updateParents_()};e.prototype.hasChildren=function(){return this.node_.childCount>0};e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()};e.prototype.forEachChild=function(t){var r=this;o.forEach(this.node_.children,function(n,i){t(new e(n,r,i))})};e.prototype.forEachDescendant=function(e,t,r){t&&!r&&e(this);this.forEachChild(function(t){t.forEachDescendant(e,true,r)});t&&r&&e(this)};e.prototype.forEachAncestor=function(e,t){var r=t?this:this.parent();while(null!==r){if(e(r))return true;r=r.parent()}return false};e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})};e.prototype.path=function(){return new G(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)};e.prototype.name=function(){return this.name_};e.prototype.parent=function(){return this.parent_};e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)};e.prototype.updateChild_=function(e,t){var r=t.isEmpty();var n=o.contains(this.node_.children,e);if(r&&n){delete this.node_.children[e];this.node_.childCount--;this.updateParents_()}else if(!r&&!n){this.node_.children[e]=t.node_;this.node_.childCount++;this.updateParents_()}};return e}();var bn;(function(e){e[e["RUN"]=0]="RUN";e[e["SENT"]=1]="SENT";e[e["COMPLETED"]=2]="COMPLETED";e[e["SENT_NEEDS_ABORT"]=3]="SENT_NEEDS_ABORT";e[e["NEEDS_ABORT"]=4]="NEEDS_ABORT"})(bn||(bn={}));fn.MAX_TRANSACTION_RETRIES_=25;fn.prototype.transactions_init_=function(){this.transactionQueueTree_=new mn};fn.prototype.startTransaction=function(e,t,r,n){this.log_("transaction on "+e);var i=function(){};var a=new yn(this,e);a.on("value",i);var s=function(){a.off("value",i)};var u={path:e,update:t,onComplete:r,status:null,order:v(),applyLocally:n,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null};var c=this.getLatestState_(e);u.currentInputSnapshot=c;var l=u.update(c.val());if(void 0===l){u.unwatcher();u.currentOutputSnapshotRaw=null;u.currentOutputSnapshotResolved=null;if(u.onComplete){var h=new dt(u.currentInputSnapshot,new yn(this,u.path),Ge);u.onComplete(null,false,h)}}else{_e("transaction failed: Data returned ",l,u.path);u.status=bn.RUN;var p=this.transactionQueueTree_.subTree(e);var f=p.getValue()||[];f.push(u);p.setValue(f);var d=void 0;if("object"===typeof l&&null!==l&&o.contains(l,".priority")){d=o.safeGet(l,".priority");o.assert(de(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")}else{var _=this.serverSyncTree_.calcCompleteEventCache(e)||at.EMPTY_NODE;d=_.getPriority().val()}d=d;var y=this.generateServerValues();var g=lt(l,d);var m=Rt(g,y);u.currentOutputSnapshotRaw=g;u.currentOutputSnapshotResolved=m;u.currentWriteId=this.getNextWriteId_();var b=this.serverSyncTree_.applyUserOverwrite(e,m,u.currentWriteId,u.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,b);this.sendReadyTransactions_()}};fn.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||at.EMPTY_NODE};fn.prototype.sendReadyTransactions_=function(e){var t=this;void 0===e&&(e=this.transactionQueueTree_);e||this.pruneCompletedTransactionsBelowNode_(e);if(null!==e.getValue()){var r=this.buildTransactionQueue_(e);o.assert(r.length>0,"Sending zero length transaction queue");var n=r.every(function(e){return e.status===bn.RUN});n&&this.sendTransactionQueue_(e.path(),r)}else e.hasChildren()&&e.forEachChild(function(e){t.sendReadyTransactions_(e)})};fn.prototype.sendTransactionQueue_=function(e,t){var r=this;var n=t.map(function(e){return e.currentWriteId});var i=this.getLatestState_(e,n);var a=i;var s=i.hash();for(var u=0;u<t.length;u++){var c=t[u];o.assert(c.status===bn.RUN,"tryToSendTransactionQueue_: items in queue should all be run.");c.status=bn.SENT;c.retryCount++;var l=G.relativePath(e,c.path);a=a.updateChild(l,c.currentOutputSnapshotRaw)}var h=a.val(true);var p=e;this.server_.put(p.toString(),h,function(n){r.log_("transaction put response",{path:p.toString(),status:n});var i=[];if("ok"===n){var o=[];for(var a=0;a<t.length;a++){t[a].status=bn.COMPLETED;i=i.concat(r.serverSyncTree_.ackUserWrite(t[a].currentWriteId));if(t[a].onComplete){var s=t[a].currentOutputSnapshotResolved;var u=new yn(r,t[a].path);var c=new dt(s,u,Ge);o.push(t[a].onComplete.bind(null,null,true,c))}t[a].unwatcher()}r.pruneCompletedTransactionsBelowNode_(r.transactionQueueTree_.subTree(e));r.sendReadyTransactions_();r.eventQueue_.raiseEventsForChangedPath(e,i);for(var a=0;a<o.length;a++)B(o[a])}else{if("datastale"===n)for(var a=0;a<t.length;a++)t[a].status===bn.SENT_NEEDS_ABORT?t[a].status=bn.NEEDS_ABORT:t[a].status=bn.RUN;else{S("transaction at "+p.toString()+" failed: "+n);for(var a=0;a<t.length;a++){t[a].status=bn.NEEDS_ABORT;t[a].abortReason=n}}r.rerunTransactions_(e)}},s)};fn.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e);var r=t.path();var n=this.buildTransactionQueue_(t);this.rerunTransactionQueue_(n,r);return r};fn.prototype.rerunTransactionQueue_=function(e,t){if(0===e.length)return;var r=[];var n=[];var i=e.filter(function(e){return e.status===bn.RUN});var a=i.map(function(e){return e.currentWriteId});for(var s=0;s<e.length;s++){var u=e[s];var c=G.relativePath(t,u.path);var l=false,h=void 0;o.assert(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null.");if(u.status===bn.NEEDS_ABORT){l=true;h=u.abortReason;n=n.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,true))}else if(u.status===bn.RUN)if(u.retryCount>=fn.MAX_TRANSACTION_RETRIES_){l=true;h="maxretry";n=n.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,true))}else{var p=this.getLatestState_(u.path,a);u.currentInputSnapshot=p;var f=e[s].update(p.val());if(void 0!==f){_e("transaction failed: Data returned ",f,u.path);var d=lt(f);var v="object"===typeof f&&null!=f&&o.contains(f,".priority");v||(d=d.updatePriority(p.getPriority()));var _=u.currentWriteId;var y=this.generateServerValues();var g=Rt(d,y);u.currentOutputSnapshotRaw=d;u.currentOutputSnapshotResolved=g;u.currentWriteId=this.getNextWriteId_();a.splice(a.indexOf(_),1);n=n.concat(this.serverSyncTree_.applyUserOverwrite(u.path,g,u.currentWriteId,u.applyLocally));n=n.concat(this.serverSyncTree_.ackUserWrite(_,true))}else{l=true;h="nodata";n=n.concat(this.serverSyncTree_.ackUserWrite(u.currentWriteId,true))}}this.eventQueue_.raiseEventsForChangedPath(t,n);n=[];if(l){e[s].status=bn.COMPLETED;(function(e){setTimeout(e,Math.floor(0))})(e[s].unwatcher);if(e[s].onComplete)if("nodata"===h){var m=new yn(this,e[s].path);var b=e[s].currentInputSnapshot;var E=new dt(b,m,Ge);r.push(e[s].onComplete.bind(null,null,false,E))}else r.push(e[s].onComplete.bind(null,new Error(h),false,null))}}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(var s=0;s<r.length;s++)B(r[s]);this.sendReadyTransactions_()};fn.prototype.getAncestorTransactionNode_=function(e){var t;var r=this.transactionQueueTree_;while(null!==(t=e.getFront())&&null===r.getValue()){r=r.subTree(t);e=e.popFront()}return r};fn.prototype.buildTransactionQueue_=function(e){var t=[];this.aggregateTransactionQueuesForNode_(e,t);t.sort(function(e,t){return e.order-t.order});return t};fn.prototype.aggregateTransactionQueuesForNode_=function(e,t){var r=this;var n=e.getValue();if(null!==n)for(var i=0;i<n.length;i++)t.push(n[i]);e.forEachChild(function(e){r.aggregateTransactionQueuesForNode_(e,t)})};fn.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this;var r=e.getValue();if(r){var n=0;for(var i=0;i<r.length;i++)if(r[i].status!==bn.COMPLETED){r[n]=r[i];n++}r.length=n;e.setValue(r.length>0?r:null)}e.forEachChild(function(e){t.pruneCompletedTransactionsBelowNode_(e)})};fn.prototype.abortTransactions_=function(e){var t=this;var r=this.getAncestorTransactionNode_(e).path();var n=this.transactionQueueTree_.subTree(e);n.forEachAncestor(function(e){t.abortTransactionsOnNode_(e)});this.abortTransactionsOnNode_(n);n.forEachDescendant(function(e){t.abortTransactionsOnNode_(e)});return r};fn.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){var r=[];var n=[];var i=-1;for(var a=0;a<t.length;a++)if(t[a].status===bn.SENT_NEEDS_ABORT);else if(t[a].status===bn.SENT){o.assert(i===a-1,"All SENT items should be at beginning of queue.");i=a;t[a].status=bn.SENT_NEEDS_ABORT;t[a].abortReason="set"}else{o.assert(t[a].status===bn.RUN,"Unexpected transaction status in abort");t[a].unwatcher();n=n.concat(this.serverSyncTree_.ackUserWrite(t[a].currentWriteId,true));if(t[a].onComplete){var s=null;r.push(t[a].onComplete.bind(null,new Error("set"),false,s))}}-1===i?e.setValue(null):t.length=i+1;this.eventQueue_.raiseEventsForChangedPath(e.path(),n);for(var a=0;a<r.length;a++)B(r[a])}};var En="databaseURL";var wn;var Cn=function(){function e(){this.repos_={};this.useRestClient_=false}e.getInstance=function(){wn||(wn=new e);return wn};e.prototype.interrupt=function(){for(var e in this.repos_)for(var t in this.repos_[e])this.repos_[e][t].interrupt()};e.prototype.resume=function(){for(var e in this.repos_)for(var t in this.repos_[e])this.repos_[e][t].resume()};e.prototype.databaseFromApp=function(e,t){var r=t||e.options[En];void 0===r&&T("Can't determine Firebase Database URL.  Be sure to include "+En+" option when calling firebase.initializeApp().");var n=ae(r);var i=n.repoInfo;Se("Invalid Firebase Database URL",1,n);n.path.isEmpty()||T("Database URL must point to the root of a Firebase Database (not including a child path).");var o=this.createRepo(i,e);return o.database};e.prototype.deleteRepo=function(e){var t=o.safeGet(this.repos_,e.app.name);t&&o.safeGet(t,e.repoInfo_.toURLString())===e||T("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted.");e.interrupt();delete t[e.repoInfo_.toURLString()]};e.prototype.createRepo=function(e,t){var r=o.safeGet(this.repos_,t.name);if(!r){r={};this.repos_[t.name]=r}var n=o.safeGet(r,e.toURLString());n&&T("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");n=new fn(e,this.useRestClient_,t);r[e.toURLString()]=n;return n};e.prototype.forceRestClient=function(e){this.useRestClient_=e};return e}();var Tn=function(){function e(e){this.repo_=e;e instanceof fn||T("Don't call new Database() directly - please use firebase.database().");this.root_=new yn(e,G.Empty);this.INTERNAL=new Sn(this)}Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:true,configurable:true});e.prototype.ref=function(e){this.checkDeleted_("ref");o.validateArgCount("database.ref",0,1,arguments.length);if(e instanceof yn)return this.refFromURL(e.toString());return void 0!==e?this.root_.child(e):this.root_};e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t);o.validateArgCount(t,1,1,arguments.length);var r=ae(e);Se(t,1,r);var n=r.repoInfo;n.host!==this.repo_.repoInfo_.host&&T(t+": Host name does not match the current database: (found "+n.host+" but expected "+this.repo_.repoInfo_.host+")");return this.ref(r.path.toString())};e.prototype.checkDeleted_=function(e){null===this.repo_&&T("Cannot call "+e+" on a deleted database.")};e.prototype.goOffline=function(){o.validateArgCount("database.goOffline",0,0,arguments.length);this.checkDeleted_("goOffline");this.repo_.interrupt()};e.prototype.goOnline=function(){o.validateArgCount("database.goOnline",0,0,arguments.length);this.checkDeleted_("goOnline");this.repo_.resume()};e.ServerValue={TIMESTAMP:{".sv":"timestamp"}};return e}();var Sn=function(){function e(e){this.database=e}e.prototype.delete=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){this.database.checkDeleted_("delete");Cn.getInstance().deleteRepo(this.database.repo_);this.database.repo_=null;this.database.root_=null;this.database.INTERNAL=null;this.database=null;return[2]})})};return e}();var Rn=function(){Mr.forceDisallow();Ar.forceAllow()};var Nn=function(){Ar.forceDisallow()};var On=function(){return Mr["isAvailable"]()};var Pn=function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t};var In=function(e,t){e.repo.stats(t)};var xn=function(e,t){e.repo.statsIncrementCounter(t)};var kn=function(e){return e.repo.dataUpdateCount};var An=function(e,t){return e.repo.interceptServerData_(t)};var Dn=Object.freeze({forceLongPolling:Rn,forceWebSockets:Nn,isWebSocketsAvailable:On,setSecurityDebugCallback:Pn,stats:In,statsIncrementCounter:xn,dataUpdateCount:kn,interceptServerData:An});var Ln=ln;ln.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)};ln.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Fn=en;var jn=function(e){var t=ln.prototype.put;ln.prototype.put=function(r,n,i,o){void 0!==o&&(o=e());t.call(this,r,n,i,o)};return function(){ln.prototype.put=t}};var Mn=ne;var Un=function(e){return e.queryIdentifier()};var Wn=function(e){return e.repo.persistentConnection_.listens_};var qn=function(e){Cn.getInstance().forceRestClient(e)};var Vn=Object.freeze({DataConnection:Ln,RealTimeConnection:Fn,hijackHash:jn,ConnectionTarget:Mn,queryIdentifier:Un,listens:Wn,forceRestClient:qn});var Bn=Tn.ServerValue;function Qn(t){var r=t.INTERNAL.registerService("database",function(e,t,r){return Cn.getInstance().databaseFromApp(e,r)},{Reference:yn,Query:bt,Database:Tn,enableLogging:b,INTERNAL:Dn,ServerValue:Bn,TEST_ACCESS:Vn},null,true);o.isNodeSdk()&&(e.exports=r)}Qn(u);t.registerDatabase=Qn;t.Database=Tn;t.Query=bt;t.Reference=yn;t.enableLogging=b;t.ServerValue=Bn;t.DataSnapshot=dt;t.OnDisconnect=Ne}).call(t,r("../node_modules/process/browser.js"))},"./node_modules/@firebase/logger/dist/index.esm.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});r.d(t,"setLogLevel",function(){return u});r.d(t,"Logger",function(){return s});r.d(t,"LogLevel",function(){return i});var n=[];var i;(function(e){e[e["DEBUG"]=0]="DEBUG";e[e["VERBOSE"]=1]="VERBOSE";e[e["INFO"]=2]="INFO";e[e["WARN"]=3]="WARN";e[e["ERROR"]=4]="ERROR";e[e["SILENT"]=5]="SILENT"})(i||(i={}));var o=i.INFO;var a=function(e,t){var r=[];for(var n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(t<e.logLevel)return;var o=(new Date).toISOString();switch(t){case i.DEBUG:console.log.apply(console,["["+o+"]  "+e.name+":"].concat(r));break;case i.VERBOSE:console.log.apply(console,["["+o+"]  "+e.name+":"].concat(r));break;case i.INFO:console.info.apply(console,["["+o+"]  "+e.name+":"].concat(r));break;case i.WARN:console.warn.apply(console,["["+o+"]  "+e.name+":"].concat(r));break;case i.ERROR:console.error.apply(console,["["+o+"]  "+e.name+":"].concat(r));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}};var s=function(){function e(e){this.name=e;this._logLevel=o;this._logHandler=a;n.push(this)}Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in i))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:true,configurable:true});e.prototype.debug=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,i.DEBUG].concat(e))};e.prototype.log=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,i.VERBOSE].concat(e))};e.prototype.info=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,i.INFO].concat(e))};e.prototype.warn=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,i.WARN].concat(e))};e.prototype.error=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];this._logHandler.apply(this,[this,i.ERROR].concat(e))};return e}();function u(e){n.forEach(function(t){t.logLevel=e})}},"./node_modules/@firebase/storage/dist/index.esm.js":function(e,t,r){"use strict";var n=r("./node_modules/@firebase/app/dist/index.cjs.js");var i=r.n(n);var o="https://firebasestorage.googleapis.com";var a="https://firebasestorage.googleapis.com";var s="/v0";var u="/v0";var c="storageBucket";var l=12e4;var h=6e4;var p=-9007199254740991;var f=function(){function e(e,t){this.code_=v(e);this.message_="Firebase Storage: "+t;this.serverResponse_=null;this.name_="FirebaseError"}e.prototype.codeProp=function(){return this.code};e.prototype.codeEquals=function(e){return v(e)===this.codeProp()};e.prototype.serverResponseProp=function(){return this.serverResponse_};e.prototype.setServerResponseProp=function(e){this.serverResponse_=e};Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"code",{get:function(){return this.code_},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"message",{get:function(){return this.message_},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:true,configurable:true});return e}();var d={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function v(e){return"storage/"+e}function _(){var e="An unknown error occurred, please check the error payload for server response.";return new f(d.UNKNOWN,e)}function y(e){return new f(d.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}function g(e){return new f(d.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function m(){var e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new f(d.UNAUTHENTICATED,e)}function b(e){return new f(d.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}function E(){return new f(d.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function w(){return new f(d.CANCELED,"User canceled the upload/download.")}function C(e){return new f(d.INVALID_URL,"Invalid URL '"+e+"'.")}function T(e){return new f(d.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function S(){return new f(d.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function R(){return new f(d.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function N(){return new f(d.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function O(e,t,r){return new f(d.INVALID_ARGUMENT,"Invalid argument in `"+t+"` at index "+e+": "+r)}function P(e,t,r,n){var i;var o;if(e===t){i=e;o=1===e?"argument":"arguments"}else{i="between "+e+" and "+t;o="arguments"}return new f(d.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+r+"`: Expected "+i+" "+o+", received "+n+".")}function I(){return new f(d.APP_DELETED,"The Firebase app was deleted.")}function x(e){return new f(d.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function k(e,t){return new f(d.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function A(e){throw new f(d.INTERNAL_ERROR,"Internal error: "+e)}var D={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function L(e){switch(e){case D.RAW:case D.BASE64:case D.BASE64URL:case D.DATA_URL:return;default:throw"Expected one of the event types: ["+D.RAW+", "+D.BASE64+", "+D.BASE64URL+", "+D.DATA_URL+"]."}}var F=function(){function e(e,t){this.data=e;this.contentType=t||null}return e}();function j(e,t){switch(e){case D.RAW:return new F(M(t));case D.BASE64:case D.BASE64URL:return new F(W(e,t));case D.DATA_URL:return new F(V(t),B(t))}throw _()}function M(e){var t=[];for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n<=127)t.push(n);else if(n<=2047)t.push(192|n>>6,128|63&n);else if(55296==(64512&n)){var i=r<e.length-1&&56320==(64512&e.charCodeAt(r+1));if(i){var o=n;var a=e.charCodeAt(++r);n=65536|(1023&o)<<10|1023&a;t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n)}else t.push(239,191,189)}else 56320==(64512&n)?t.push(239,191,189):t.push(224|n>>12,128|n>>6&63,128|63&n)}return new Uint8Array(t)}function U(e){var t;try{t=decodeURIComponent(e)}catch(e){throw k(D.DATA_URL,"Malformed data URL.")}return M(t)}function W(e,t){switch(e){case D.BASE64:var r=-1!==t.indexOf("-");var n=-1!==t.indexOf("_");if(r||n){var i=r?"-":"_";throw k(e,"Invalid character '"+i+"' found: is it base64url encoded?")}break;case D.BASE64URL:var o=-1!==t.indexOf("+");var a=-1!==t.indexOf("/");if(o||a){var i=o?"+":"/";throw k(e,"Invalid character '"+i+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}var s;try{s=atob(t)}catch(t){throw k(e,"Invalid character found")}var u=new Uint8Array(s.length);for(var c=0;c<s.length;c++)u[c]=s.charCodeAt(c);return u}var q=function(){function e(e){this.base64=false;this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw k(D.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var r=t[1]||null;if(null!=r){this.base64=Q(r,";base64");this.contentType=this.base64?r.substring(0,r.length-";base64".length):r}this.rest=e.substring(e.indexOf(",")+1)}return e}();function V(e){var t=new q(e);return t.base64?W(D.BASE64,t.rest):U(t.rest)}function B(e){var t=new q(e);return t.contentType}function Q(e,t){var r=e.length>=t.length;if(!r)return false;return e.substring(e.length-t.length)===t}var H={STATE_CHANGED:"state_changed"};var G={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"};var z={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function K(e){switch(e){case G.RUNNING:case G.PAUSING:case G.CANCELING:return z.RUNNING;case G.PAUSED:return z.PAUSED;case G.SUCCESS:return z.SUCCESS;case G.CANCELED:return z.CANCELED;case G.ERROR:return z.ERROR;default:return z.ERROR}}function Y(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function X(e,t){for(var r in e)Y(e,r)&&t(r,e[r])}function $(e){if(null==e)return{};var t={};X(e,function(e,r){t[e]=r});return t}function J(e){return new Promise(e)}function Z(e){return Promise.resolve(e)}function ee(e){return Promise.reject(e)}function te(e){return null!=e}function re(e){return void 0!==e}function ne(e){return"function"===typeof e}function ie(e){return"object"===typeof e}function oe(e){return ie(e)&&null!==e}function ae(e){return ie(e)&&!Array.isArray(e)}function se(e){return"string"===typeof e||e instanceof String}function ue(e){return"number"===typeof e||e instanceof Number}function ce(e){return le()&&e instanceof Blob}function le(){return"undefined"!==typeof Blob}var he;(function(e){e[e["NO_ERROR"]=0]="NO_ERROR";e[e["NETWORK_ERROR"]=1]="NETWORK_ERROR";e[e["ABORT"]=2]="ABORT"})(he||(he={}));var pe=function(){function e(){var e=this;this.sent_=false;this.xhr_=new XMLHttpRequest;this.errorCode_=he.NO_ERROR;this.sendPromise_=J(function(t,r){e.xhr_.addEventListener("abort",function(r){e.errorCode_=he.ABORT;t(e)});e.xhr_.addEventListener("error",function(r){e.errorCode_=he.NETWORK_ERROR;t(e)});e.xhr_.addEventListener("load",function(r){t(e)})})}e.prototype.send=function(e,t,r,n){var i=this;if(this.sent_)throw A("cannot .send() more than once");this.sent_=true;this.xhr_.open(t,e,true);if(te(n)){var o=n;X(o,function(e,t){i.xhr_.setRequestHeader(e,t.toString())})}te(r)?this.xhr_.send(r):this.xhr_.send();return this.sendPromise_};e.prototype.getErrorCode=function(){if(!this.sent_)throw A("cannot .getErrorCode() before sending");return this.errorCode_};e.prototype.getStatus=function(){if(!this.sent_)throw A("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}};e.prototype.getResponseText=function(){if(!this.sent_)throw A("cannot .getResponseText() before sending");return this.xhr_.responseText};e.prototype.abort=function(){this.xhr_.abort()};e.prototype.getResponseHeader=function(e){return this.xhr_.getResponseHeader(e)};e.prototype.addUploadProgressListener=function(e){te(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",e)};e.prototype.removeUploadProgressListener=function(e){te(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",e)};return e}();var fe=function(){function e(){}e.prototype.createXhrIo=function(){return new pe};return e}();function de(e){var t;try{t=JSON.parse(e)}catch(e){return null}return ae(t)?t:null}var ve=function(){function e(e,t){this.bucket=e;this.path_=t}Object.defineProperty(e.prototype,"path",{get:function(){return this.path_},enumerable:true,configurable:true});e.prototype.fullServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)};e.prototype.bucketOnlyServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"};e.makeFromBucketSpec=function(t){var r;try{r=e.makeFromUrl(t)}catch(r){return new e(t,"")}if(""===r.path)return r;throw T(t)};e.makeFromUrl=function(t){var r=null;var n="([A-Za-z0-9.\\-]+)";function i(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}var o="(/(.*))?$";var a="(/([^?#]*).*)?$";var s=new RegExp("^gs://"+n+o,"i");var u={bucket:1,path:3};function c(e){e.path_=decodeURIComponent(e.path)}var l="v[A-Za-z0-9_]+";var h=new RegExp("^https?://firebasestorage\\.googleapis\\.com/"+l+"/b/"+n+"/o"+a,"i");var p={bucket:1,path:3};var f=[{regex:s,indices:u,postModify:i},{regex:h,indices:p,postModify:c}];for(var d=0;d<f.length;d++){var v=f[d];var _=v.regex.exec(t);if(_){var y=_[v.indices.bucket];var g=_[v.indices.path];g||(g="");r=new e(y,g);v.postModify(r);break}}if(null==r)throw C(t);return r};return e}();function _e(e){if(0==e.length)return null;var t=e.lastIndexOf("/");if(-1===t)return"";var r=e.slice(0,t);return r}function ye(e,t){var r=t.split("/").filter(function(e){return e.length>0}).join("/");return 0===e.length?r:e+"/"+r}function ge(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function me(e){return o+s+e}function be(e){return a+s+e}function Ee(e){return o+u+e}function we(e){var t=encodeURIComponent;var r="?";X(e,function(e,n){var i=t(e)+"="+t(n);r=r+i+"&"});r=r.slice(0,-1);return r}function Ce(e,t){return t}var Te=function(){function e(e,t,r,n){this.server=e;this.local=t||e;this.writable=!!r;this.xform=n||Ce}return e}();var Se=null;function Re(e){var t=se(e);if(!t||e.length<2)return e;e=e;return ge(e)}function Ne(){if(Se)return Se;var e=[];e.push(new Te("bucket"));e.push(new Te("generation"));e.push(new Te("metageneration"));e.push(new Te("name","fullPath",true));function t(e,t){return Re(t)}var r=new Te("name");r.xform=t;e.push(r);function n(e,t){return te(t)?+t:t}var i=new Te("size");i.xform=n;e.push(i);e.push(new Te("timeCreated"));e.push(new Te("updated"));e.push(new Te("md5Hash",null,true));e.push(new Te("cacheControl",null,true));e.push(new Te("contentDisposition",null,true));e.push(new Te("contentEncoding",null,true));e.push(new Te("contentLanguage",null,true));e.push(new Te("contentType",null,true));e.push(new Te("metadata","customMetadata",true));Se=e;return Se}function Oe(e,t){function r(){var r=e["bucket"];var n=e["fullPath"];var i=new ve(r,n);return t.makeStorageReference(i)}Object.defineProperty(e,"ref",{get:r})}function Pe(e,t,r){var n={};n["type"]="file";var i=r.length;for(var o=0;o<i;o++){var a=r[o];n[a.local]=a.xform(n,t[a.server])}Oe(n,e);return n}function Ie(e,t,r){var n=de(t);if(null===n)return null;var i=n;return Pe(e,i,r)}function xe(e,t){var r=de(t);if(null===r)return null;if(!se(r["downloadTokens"]))return null;var n=r["downloadTokens"];if(0===n.length)return null;var i=encodeURIComponent;var o=n.split(",");var a=o.map(function(t){var r=e["bucket"];var n=e["fullPath"];var o="/b/"+i(r)+"/o/"+i(n);var a=be(o);var s=we({alt:"media",token:t});return a+s});return a[0]}function ke(e,t){var r={};var n=t.length;for(var i=0;i<n;i++){var o=t[i];o.writable&&(r[o.server]=e[o.local])}return JSON.stringify(r)}function Ae(e){var t=e&&ie(e);if(!t)throw"Expected Metadata object.";for(var r in e){var n=e[r];if("customMetadata"===r){if(!ie(n))throw"Expected object for 'customMetadata' mapping."}else if(oe(n))throw"Mapping for '"+r+"' cannot be an object."}}function De(e,t,r){var n=t.length;var i=t.length;for(var o=0;o<t.length;o++)if(t[o].optional){n=o;break}var a=n<=r.length&&r.length<=i;if(!a)throw P(n,i,e,r.length);for(var o=0;o<r.length;o++)try{t[o].validator(r[o])}catch(t){throw t instanceof Error?O(o,e,t.message):O(o,e,t)}}var Le=function(){function e(e,t){var r=this;this.validator=function(t){if(r.optional&&!re(t))return;e(t)};this.optional=!!t}return e}();function Fe(e,t){return function(r){e(r);t(r)}}function je(e,t){function r(e){if(!se(e))throw"Expected string."}var n;n=e?Fe(r,e):r;return new Le(n,t)}function Me(){function e(e){var t=e instanceof Uint8Array||e instanceof ArrayBuffer||le()&&e instanceof Blob;if(!t)throw"Expected Blob or File."}return new Le(e)}function Ue(e){return new Le(Ae,e)}function We(){function e(e){var t=ue(e)&&e>=0;if(!t)throw"Expected a number 0 or greater."}return new Le(e)}function qe(e,t){function r(t){var r=null===t||te(t)&&t instanceof Object;if(!r)throw"Expected an Object.";void 0!==e&&null!==e&&e(t)}return new Le(r,t)}function Ve(e){function t(e){var t=null===e||ne(e);if(!t)throw"Expected a Function."}return new Le(t,e)}function Be(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Qe(){var e=[];for(var t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Be();if(void 0!==r){var n=new r;for(var i=0;i<e.length;i++)n.append(e[i]);return n.getBlob()}if(le())return new Blob(e);throw Error("This browser doesn't seem to support creating Blobs")}function He(e,t,r){if(e.webkitSlice)return e.webkitSlice(t,r);if(e.mozSlice)return e.mozSlice(t,r);if(e.slice)return e.slice(t,r);return null}var Ge=function(){function e(e,t){var r=0;var n="";if(ce(e)){this.data_=e;r=e.size;n=e.type}else if(e instanceof ArrayBuffer){if(t)this.data_=new Uint8Array(e);else{this.data_=new Uint8Array(e.byteLength);this.data_.set(new Uint8Array(e))}r=this.data_.length}else if(e instanceof Uint8Array){if(t)this.data_=e;else{this.data_=new Uint8Array(e.length);this.data_.set(e)}r=e.length}this.size_=r;this.type_=n}e.prototype.size=function(){return this.size_};e.prototype.type=function(){return this.type_};e.prototype.slice=function(t,r){if(ce(this.data_)){var n=this.data_;var i=He(n,t,r);if(null===i)return null;return new e(i)}var o=new Uint8Array(this.data_.buffer,t,r-t);return new e(o,true)};e.getBlob=function(){var t=[];for(var r=0;r<arguments.length;r++)t[r]=arguments[r];if(le()){var n=t.map(function(t){return t instanceof e?t.data_:t});return new e(Qe.apply(null,n))}var i=t.map(function(e){return se(e)?j(D.RAW,e).data:e.data_});var o=0;i.forEach(function(e){o+=e.byteLength});var a=new Uint8Array(o);var s=0;i.forEach(function(e){for(var t=0;t<e.length;t++)a[s++]=e[t]});return new e(a,true)};e.prototype.uploadData=function(){return this.data_};return e}();function ze(e,t){return-1!==e.indexOf(t)}function Ke(e){return Array.prototype.slice.call(e)}function Ye(e,t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}var Xe=function(){function e(e,t,r,n){this.url=e;this.method=t;this.handler=r;this.timeout=n;this.urlParams={};this.headers={};this.body=null;this.errorHandler=null;this.progressCallback=null;this.successCodes=[200];this.additionalRetryCodes=[]}return e}();function $e(e){if(!e)throw _()}function Je(e,t){function r(r,n){var i=Ie(e,n,t);$e(null!==i);return i}return r}function Ze(e,t){function r(r,n){var i=Ie(e,n,t);$e(null!==i);return xe(i,n)}return r}function et(e){function t(t,r){var n;n=401===t.getStatus()?m():402===t.getStatus()?g(e.bucket):403===t.getStatus()?b(e.path):r;n.setServerResponseProp(r.serverResponseProp());return n}return t}function tt(e){var t=et(e);function r(r,n){var i=t(r,n);404===r.getStatus()&&(i=y(e.path));i.setServerResponseProp(n.serverResponseProp());return i}return r}function rt(e,t,r){var n=t.fullServerUrl();var i=me(n);var o="GET";var a=e.maxOperationRetryTime();var s=new Xe(i,o,Je(e,r),a);s.errorHandler=tt(t);return s}function nt(e,t,r){var n=t.fullServerUrl();var i=me(n);var o="GET";var a=e.maxOperationRetryTime();var s=new Xe(i,o,Ze(e,r),a);s.errorHandler=tt(t);return s}function it(e,t,r,n){var i=t.fullServerUrl();var o=me(i);var a="PATCH";var s=ke(r,n);var u={"Content-Type":"application/json; charset=utf-8"};var c=e.maxOperationRetryTime();var l=new Xe(o,a,Je(e,n),c);l.headers=u;l.body=s;l.errorHandler=tt(t);return l}function ot(e,t){var r=t.fullServerUrl();var n=me(r);var i="DELETE";var o=e.maxOperationRetryTime();function a(e,t){}var s=new Xe(n,i,a,o);s.successCodes=[200,204];s.errorHandler=tt(t);return s}function at(e,t){return e&&e["contentType"]||t&&t.type()||"application/octet-stream"}function st(e,t,r){var n=$(r);n["fullPath"]=e.path;n["size"]=t.size();n["contentType"]||(n["contentType"]=at(null,t));return n}function ut(e,t,r,n,i){var o=t.bucketOnlyServerUrl();var a={"X-Goog-Upload-Protocol":"multipart"};function s(){var e="";for(var t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}var u=s();a["Content-Type"]="multipart/related; boundary="+u;var c=st(t,n,i);var l=ke(c,r);var h="--"+u+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+l+"\r\n--"+u+"\r\nContent-Type: "+c["contentType"]+"\r\n\r\n";var p="\r\n--"+u+"--";var f=Ge.getBlob(h,n,p);if(null===f)throw S();var d={name:c["fullPath"]};var v=Ee(o);var _="POST";var y=e.maxUploadRetryTime();var g=new Xe(v,_,Je(e,r),y);g.urlParams=d;g.headers=a;g.body=f.uploadData();g.errorHandler=et(t);return g}var ct=function(){function e(e,t,r,n){this.current=e;this.total=t;this.finalized=!!r;this.metadata=n||null}return e}();function lt(e,t){var r;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){$e(false)}var n=t||["active"];$e(ze(n,r));return r}function ht(e,t,r,n,i){var o=t.bucketOnlyServerUrl();var a=st(t,n,i);var s={name:a["fullPath"]};var u=Ee(o);var c="POST";var l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":n.size(),"X-Goog-Upload-Header-Content-Type":a["contentType"],"Content-Type":"application/json; charset=utf-8"};var h=ke(a,r);var p=e.maxUploadRetryTime();function f(e,t){lt(e);var r;try{r=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){$e(false)}$e(se(r));return r}var d=new Xe(u,c,f,p);d.urlParams=s;d.headers=l;d.body=h;d.errorHandler=et(t);return d}function pt(e,t,r,n){var i={"X-Goog-Upload-Command":"query"};function o(e,t){var r=lt(e,["active","final"]);var i;try{i=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){$e(false)}var o=parseInt(i,10);$e(!isNaN(o));return new ct(o,n.size(),"final"===r)}var a="POST";var s=e.maxUploadRetryTime();var u=new Xe(r,a,o,s);u.headers=i;u.errorHandler=et(t);return u}var ft=262144;function dt(e,t,r,n,i,o,a,s){var u=new ct(0,0);if(a){u.current=a.current;u.total=a.total}else{u.current=0;u.total=n.size()}if(n.size()!==u.total)throw R();var c=u.total-u.current;var l=c;i>0&&(l=Math.min(l,i));var h=u.current;var p=h+l;var f=l===c?"upload, finalize":"upload";var d={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":u.current};var v=n.slice(h,p);if(null===v)throw S();function _(e,r){var i=lt(e,["active","final"]);var a=u.current+l;var s=n.size();var c;c="final"===i?Je(t,o)(e,r):null;return new ct(a,s,"final"===i,c)}var y="POST";var g=t.maxUploadRetryTime();var m=new Xe(r,y,_,g);m.headers=d;m.body=v.uploadData();m.progressCallback=s||null;m.errorHandler=et(e);return m}var vt=function(){function e(e,t,r){var n=ne(e)||te(t)||te(r);if(n){this.next=e;this.error=t||null;this.complete=r||null}else{var i=e;this.next=i.next||null;this.error=i.error||null;this.complete=i.complete||null}}return e}();var _t=function(){function e(e,t,r,n,i,o){this.bytesTransferred=e;this.totalBytes=t;this.state=r;this.metadata=n;this.task=i;this.ref=o}return e}();function yt(e){return function(){var t=[];for(var r=0;r<arguments.length;r++)t[r]=arguments[r];Z(true).then(function(){e.apply(null,t)})}}var gt=function(){function e(e,t,r,n,i,o){void 0===o&&(o=null);var a=this;this.transferred_=0;this.needToFetchStatus_=false;this.needToFetchMetadata_=false;this.observers_=[];this.error_=null;this.uploadUrl_=null;this.request_=null;this.chunkMultiplier_=1;this.resolve_=null;this.reject_=null;this.ref_=e;this.authWrapper_=t;this.location_=r;this.blob_=i;this.metadata_=o;this.mappings_=n;this.resumable_=this.shouldDoResumable_(this.blob_);this.state_=G.RUNNING;this.errorHandler_=function(e){a.request_=null;a.chunkMultiplier_=1;if(e.codeEquals(d.CANCELED)){a.needToFetchStatus_=true;a.completeTransitions_()}else{a.error_=e;a.transition_(G.ERROR)}};this.metadataErrorHandler_=function(e){a.request_=null;if(e.codeEquals(d.CANCELED))a.completeTransitions_();else{a.error_=e;a.transition_(G.ERROR)}};this.promise_=J(function(e,t){a.resolve_=e;a.reject_=t;a.start_()});this.promise_.then(null,function(){})}e.prototype.makeProgressCallback_=function(){var e=this;var t=this.transferred_;return function(r,n){e.updateProgress_(t+r)}};e.prototype.shouldDoResumable_=function(e){return e.size()>262144};e.prototype.start_=function(){if(this.state_!==G.RUNNING)return;if(null!==this.request_)return;this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_()};e.prototype.resolveToken_=function(e){var t=this;this.authWrapper_.getAuthToken().then(function(r){switch(t.state_){case G.RUNNING:e(r);break;case G.CANCELING:t.transition_(G.CANCELED);break;case G.PAUSING:t.transition_(G.PAUSED);break;default:}})};e.prototype.createResumable_=function(){var e=this;this.resolveToken_(function(t){var r=ht(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_);var n=e.authWrapper_.makeRequest(r,t);e.request_=n;n.getPromise().then(function(t){e.request_=null;e.uploadUrl_=t;e.needToFetchStatus_=false;e.completeTransitions_()},e.errorHandler_)})};e.prototype.fetchStatus_=function(){var e=this;var t=this.uploadUrl_;this.resolveToken_(function(r){var n=pt(e.authWrapper_,e.location_,t,e.blob_);var i=e.authWrapper_.makeRequest(n,r);e.request_=i;i.getPromise().then(function(t){t=t;e.request_=null;e.updateProgress_(t.current);e.needToFetchStatus_=false;t.finalized&&(e.needToFetchMetadata_=true);e.completeTransitions_()},e.errorHandler_)})};e.prototype.continueUpload_=function(){var e=this;var t=ft*this.chunkMultiplier_;var r=new ct(this.transferred_,this.blob_.size());var n=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=dt(e.location_,e.authWrapper_,n,e.blob_,t,e.mappings_,r,e.makeProgressCallback_())}catch(t){e.error_=t;e.transition_(G.ERROR);return}var a=e.authWrapper_.makeRequest(o,i);e.request_=a;a.getPromise().then(function(t){e.increaseMultiplier_();e.request_=null;e.updateProgress_(t.current);if(t.finalized){e.metadata_=t.metadata;e.transition_(G.SUCCESS)}else e.completeTransitions_()},e.errorHandler_)})};e.prototype.increaseMultiplier_=function(){var e=ft*this.chunkMultiplier_;e<33554432&&(this.chunkMultiplier_*=2)};e.prototype.fetchMetadata_=function(){var e=this;this.resolveToken_(function(t){var r=rt(e.authWrapper_,e.location_,e.mappings_);var n=e.authWrapper_.makeRequest(r,t);e.request_=n;n.getPromise().then(function(t){e.request_=null;e.metadata_=t;e.transition_(G.SUCCESS)},e.metadataErrorHandler_)})};e.prototype.oneShotUpload_=function(){var e=this;this.resolveToken_(function(t){var r=ut(e.authWrapper_,e.location_,e.mappings_,e.blob_,e.metadata_);var n=e.authWrapper_.makeRequest(r,t);e.request_=n;n.getPromise().then(function(t){e.request_=null;e.metadata_=t;e.updateProgress_(e.blob_.size());e.transition_(G.SUCCESS)},e.errorHandler_)})};e.prototype.updateProgress_=function(e){var t=this.transferred_;this.transferred_=e;this.transferred_!==t&&this.notifyObservers_()};e.prototype.transition_=function(e){if(this.state_===e)return;switch(e){case G.CANCELING:this.state_=e;null!==this.request_&&this.request_.cancel();break;case G.PAUSING:this.state_=e;null!==this.request_&&this.request_.cancel();break;case G.RUNNING:var t=this.state_===G.PAUSED;this.state_=e;if(t){this.notifyObservers_();this.start_()}break;case G.PAUSED:this.state_=e;this.notifyObservers_();break;case G.CANCELED:this.error_=w();this.state_=e;this.notifyObservers_();break;case G.ERROR:this.state_=e;this.notifyObservers_();break;case G.SUCCESS:this.state_=e;this.notifyObservers_();break}};e.prototype.completeTransitions_=function(){switch(this.state_){case G.PAUSING:this.transition_(G.PAUSED);break;case G.CANCELING:this.transition_(G.CANCELED);break;case G.RUNNING:this.start_();break;default:break}};Object.defineProperty(e.prototype,"snapshot",{get:function(){var e=K(this.state_);return new _t(this.transferred_,this.blob_.size(),e,this.metadata_,this,this.ref_)},enumerable:true,configurable:true});e.prototype.on=function(e,t,r,n){void 0===t&&(t=void 0);void 0===r&&(r=void 0);void 0===n&&(n=void 0);function i(t){if(e!==H.STATE_CHANGED)throw"Expected one of the event types: ["+H.STATE_CHANGED+"]."}var o="Expected a function or an Object with one of `next`, `error`, `complete` properties.";var a=Ve(true).validator;var s=qe(null,true).validator;function u(e){try{a(e);return}catch(e){}try{s(e);var t=re(e["next"])||re(e["error"])||re(e["complete"]);if(!t)throw"";return}catch(e){throw o}}var c=[je(i),qe(u,true),Ve(true),Ve(true)];De("on",c,arguments);var l=this;function h(e){function t(t,r,i){null!==e&&De("on",e,arguments);var o=new vt(t,r,n);l.addObserver_(o);return function(){l.removeObserver_(o)}}return t}function p(e){if(null===e)throw o;u(e)}var f=[qe(p),Ve(true),Ve(true)];var d=!(re(t)||re(r)||re(n));return d?h(f):h(null)(t,r,n)};e.prototype.then=function(e,t){return this.promise_.then(e,t)};e.prototype.catch=function(e){return this.then(null,e)};e.prototype.addObserver_=function(e){this.observers_.push(e);this.notifyObserver_(e)};e.prototype.removeObserver_=function(e){Ye(this.observers_,e)};e.prototype.notifyObservers_=function(){var e=this;this.finishPromise_();var t=Ke(this.observers_);t.forEach(function(t){e.notifyObserver_(t)})};e.prototype.finishPromise_=function(){if(null!==this.resolve_){var e=true;switch(K(this.state_)){case z.SUCCESS:yt(this.resolve_.bind(null,this.snapshot))();break;case z.CANCELED:case z.ERROR:var t=this.reject_;yt(t.bind(null,this.error_))();break;default:e=false;break}if(e){this.resolve_=null;this.reject_=null}}};e.prototype.notifyObserver_=function(e){var t=K(this.state_);switch(t){case z.RUNNING:case z.PAUSED:null!==e.next&&yt(e.next.bind(e,this.snapshot))();break;case z.SUCCESS:null!==e.complete&&yt(e.complete.bind(e))();break;case z.CANCELED:case z.ERROR:null!==e.error&&yt(e.error.bind(e,this.error_))();break;default:null!==e.error&&yt(e.error.bind(e,this.error_))()}};e.prototype.resume=function(){De("resume",[],arguments);var e=this.state_===G.PAUSED||this.state_===G.PAUSING;e&&this.transition_(G.RUNNING);return e};e.prototype.pause=function(){De("pause",[],arguments);var e=this.state_===G.RUNNING;e&&this.transition_(G.PAUSING);return e};e.prototype.cancel=function(){De("cancel",[],arguments);var e=this.state_===G.RUNNING||this.state_===G.PAUSING;e&&this.transition_(G.CANCELING);return e};return e}();var mt=function(){function e(e,t){this.authWrapper=e;this.location=t instanceof ve?t:ve.makeFromUrl(t)}e.prototype.toString=function(){De("toString",[],arguments);return"gs://"+this.location.bucket+"/"+this.location.path};e.prototype.newRef=function(t,r){return new e(t,r)};e.prototype.mappings=function(){return Ne()};e.prototype.child=function(e){De("child",[je()],arguments);var t=ye(this.location.path,e);var r=new ve(this.location.bucket,t);return this.newRef(this.authWrapper,r)};Object.defineProperty(e.prototype,"parent",{get:function(){var e=_e(this.location.path);if(null===e)return null;var t=new ve(this.location.bucket,e);return this.newRef(this.authWrapper,t)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"root",{get:function(){var e=new ve(this.location.bucket,"");return this.newRef(this.authWrapper,e)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"fullPath",{get:function(){return this.location.path},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"name",{get:function(){return ge(this.location.path)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:true,configurable:true});e.prototype.put=function(e,t){void 0===t&&(t=null);De("put",[Me(),Ue(true)],arguments);this.throwIfRoot_("put");return new gt(this,this.authWrapper,this.location,this.mappings(),new Ge(e),t)};e.prototype.putString=function(e,t,r){void 0===t&&(t=D.RAW);De("putString",[je(),je(L,true),Ue(true)],arguments);this.throwIfRoot_("putString");var n=j(t,e);var i=$(r);!te(i["contentType"])&&te(n.contentType)&&(i["contentType"]=n.contentType);return new gt(this,this.authWrapper,this.location,this.mappings(),new Ge(n.data,true),i)};e.prototype.delete=function(){De("delete",[],arguments);this.throwIfRoot_("delete");var e=this;return this.authWrapper.getAuthToken().then(function(t){var r=ot(e.authWrapper,e.location);return e.authWrapper.makeRequest(r,t).getPromise()})};e.prototype.getMetadata=function(){De("getMetadata",[],arguments);this.throwIfRoot_("getMetadata");var e=this;return this.authWrapper.getAuthToken().then(function(t){var r=rt(e.authWrapper,e.location,e.mappings());return e.authWrapper.makeRequest(r,t).getPromise()})};e.prototype.updateMetadata=function(e){De("updateMetadata",[Ue()],arguments);this.throwIfRoot_("updateMetadata");var t=this;return this.authWrapper.getAuthToken().then(function(r){var n=it(t.authWrapper,t.location,e,t.mappings());return t.authWrapper.makeRequest(n,r).getPromise()})};e.prototype.getDownloadURL=function(){De("getDownloadURL",[],arguments);this.throwIfRoot_("getDownloadURL");var e=this;return this.authWrapper.getAuthToken().then(function(t){var r=nt(e.authWrapper,e.location,e.mappings());return e.authWrapper.makeRequest(r,t).getPromise().then(function(e){if(null===e)throw N();return e})})};e.prototype.throwIfRoot_=function(e){if(""===this.location.path)throw x(e)};return e}();var bt=function(){function e(e){this.promise_=ee(e)}e.prototype.getPromise=function(){return this.promise_};e.prototype.cancel=function(e){void 0===e&&(e=false)};return e}();var Et=function(){function e(){this.map_={};this.id_=p}e.prototype.addRequest=function(e){var t=this.id_;this.id_++;this.map_[t]=e;var r=this;function n(){delete r.map_[t]}e.getPromise().then(n,n)};e.prototype.clear=function(){X(this.map_,function(e,t){t&&t.cancel(true)});this.map_={}};return e}();var wt=function(){function e(t,r,n,i,o){this.bucket_=null;this.deleted_=false;this.app_=t;if(null!==this.app_){var a=this.app_.options;te(a)&&(this.bucket_=e.extractBucket_(a))}this.storageRefMaker_=r;this.requestMaker_=n;this.pool_=o;this.service_=i;this.maxOperationRetryTime_=l;this.maxUploadRetryTime_=h;this.requestMap_=new Et}e.extractBucket_=function(e){var t=e[c]||null;if(null==t)return null;var r=ve.makeFromBucketSpec(t);return r.bucket};e.prototype.getAuthToken=function(){return null!==this.app_&&te(this.app_.INTERNAL)&&te(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(e){return null!==e?e.accessToken:null},function(e){return null}):Z(null)};e.prototype.bucket=function(){if(this.deleted_)throw I();return this.bucket_};e.prototype.service=function(){return this.service_};e.prototype.makeStorageReference=function(e){return this.storageRefMaker_(this,e)};e.prototype.makeRequest=function(e,t){if(this.deleted_)return new bt(I());var r=this.requestMaker_(e,t,this.pool_);this.requestMap_.addRequest(r);return r};e.prototype.deleteApp=function(){this.deleted_=true;this.app_=null;this.requestMap_.clear()};e.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_};e.prototype.setMaxUploadRetryTime=function(e){this.maxUploadRetryTime_=e};e.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_};e.prototype.setMaxOperationRetryTime=function(e){this.maxOperationRetryTime_=e};return e}();function Ct(e,t,r){var n=1;var i=null;var o=false;var a=0;function s(){return 2===a}var u=false;function c(){if(!u){u=true;t.apply(null,arguments)}}function l(t){i=setTimeout(function(){i=null;e(h,s())},t)}function h(e){var t=[];for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(u)return;if(e){c.apply(null,arguments);return}var i=s()||o;if(i){c.apply(null,arguments);return}n<64&&(n*=2);var h;if(1===a){a=2;h=0}else h=1e3*(n+Math.random());l(h)}var p=false;function f(e){if(p)return;p=true;if(u)return;if(null!==i){e||(a=2);clearTimeout(i);l(0)}else e||(a=1)}l(0);setTimeout(function(){o=true;f(true)},r);return f}function Tt(e){e(false)}var St=function(){function e(e,t,r,n,i,o,a,s,u,c,l){this.pendingXhr_=null;this.backoffId_=null;this.resolve_=null;this.reject_=null;this.canceled_=false;this.appDelete_=false;this.url_=e;this.method_=t;this.headers_=r;this.body_=n;this.successCodes_=i.slice();this.additionalRetryCodes_=o.slice();this.callback_=a;this.errorCallback_=s;this.progressCallback_=c;this.timeout_=u;this.pool_=l;var h=this;this.promise_=J(function(e,t){h.resolve_=e;h.reject_=t;h.start_()})}e.prototype.start_=function(){var e=this;function t(t,r){if(r){t(false,new Rt(false,null,true));return}var n=e.pool_.createXhrIo();e.pendingXhr_=n;function i(t){var r=t.loaded;var n=t.lengthComputable?t.total:-1;null!==e.progressCallback_&&e.progressCallback_(r,n)}null!==e.progressCallback_&&n.addUploadProgressListener(i);n.send(e.url_,e.method_,e.body_,e.headers_).then(function(r){null!==e.progressCallback_&&r.removeUploadProgressListener(i);e.pendingXhr_=null;r=r;var n=r.getErrorCode()===he.NO_ERROR;var o=r.getStatus();if(!n||e.isRetryStatusCode_(o)){var a=r.getErrorCode()===he.ABORT;t(false,new Rt(false,null,a));return}var s=ze(e.successCodes_,o);t(true,new Rt(s,r))})}function r(t,r){var n=e.resolve_;var i=e.reject_;var o=r.xhr;if(r.wasSuccessCode)try{var a=e.callback_(o,o.getResponseText());re(a)?n(a):n()}catch(e){i(e)}else if(null!==o){var s=_();s.setServerResponseProp(o.getResponseText());e.errorCallback_?i(e.errorCallback_(o,s)):i(s)}else if(r.canceled){var s=e.appDelete_?I():w();i(s)}else{var s=E();i(s)}}this.canceled_?r(false,new Rt(false,null,true)):this.backoffId_=Ct(t,r,this.timeout_)};e.prototype.getPromise=function(){return this.promise_};e.prototype.cancel=function(e){this.canceled_=true;this.appDelete_=e||false;null!==this.backoffId_&&Tt(this.backoffId_);null!==this.pendingXhr_&&this.pendingXhr_.abort()};e.prototype.isRetryStatusCode_=function(e){var t=e>=500&&e<600;var r=[408,429];var n=ze(r,e);var i=ze(this.additionalRetryCodes_,e);return t||n||i};return e}();var Rt=function(){function e(e,t,r){this.wasSuccessCode=e;this.xhr=t;this.canceled=!!r}return e}();function Nt(e,t){null!==t&&t.length>0&&(e["Authorization"]="Firebase "+t)}function Ot(e){var t="undefined"!==typeof i.a?i.a.SDK_VERSION:"AppManager";e["X-Firebase-Storage-Version"]="webjs/"+t}function Pt(e,t,r){var n=we(e.urlParams);var i=e.url+n;var o=$(e.headers);Nt(o,t);Ot(o);return new St(i,e.method,o,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r)}var It=function(){function e(e,t,r){this.bucket_=null;function n(e,t){return new mt(e,t)}this.authWrapper_=new wt(e,n,Pt,this,t);this.app_=e;if(null!=r)this.bucket_=ve.makeFromBucketSpec(r);else{var i=this.authWrapper_.bucket();null!=i&&(this.bucket_=new ve(i,""))}this.internals_=new xt(this)}e.prototype.ref=function(e){function t(e){if(/^[A-Za-z]+:\/\//.test(e))throw"Expected child path but got a URL, use refFromURL instead."}De("ref",[je(t,true)],arguments);if(null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var r=new mt(this.authWrapper_,this.bucket_);return null!=e?r.child(e):r};e.prototype.refFromURL=function(e){function t(e){if(!/^[A-Za-z]+:\/\//.test(e))throw"Expected full URL but got a child path, use ref instead.";try{ve.makeFromUrl(e)}catch(e){throw"Expected valid full URL but got an invalid one."}}De("refFromURL",[je(t,false)],arguments);return new mt(this.authWrapper_,e)};Object.defineProperty(e.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:true,configurable:true});e.prototype.setMaxUploadRetryTime=function(e){De("setMaxUploadRetryTime",[We()],arguments);this.authWrapper_.setMaxUploadRetryTime(e)};Object.defineProperty(e.prototype,"maxOperationRetryTime",{get:function(){return this.authWrapper_.maxOperationRetryTime()},enumerable:true,configurable:true});e.prototype.setMaxOperationRetryTime=function(e){De("setMaxOperationRetryTime",[We()],arguments);this.authWrapper_.setMaxOperationRetryTime(e)};Object.defineProperty(e.prototype,"app",{get:function(){return this.app_},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:true,configurable:true});return e}();var xt=function(){function e(e){this.service_=e}e.prototype.delete=function(){this.service_.authWrapper_.deleteApp();return Z(void 0)};return e}();var kt="storage";function At(e,t,r){return new It(e,new fe,r)}function Dt(e){var t={TaskState:z,TaskEvent:H,StringFormat:D,Storage:It,Reference:mt};e.INTERNAL.registerService(kt,At,t,void 0,true)}Dt(i.a)},"./node_modules/@firebase/util/dist/index.cjs.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/tslib/tslib.es6.js");var i={NODE_CLIENT:false,NODE_ADMIN:false,SDK_VERSION:"${JSCORE_VERSION}"};var o=function(e,t){if(!e)throw a(t)};var a=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)};var s=function(e){var t=[],r=0;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i<128)t[r++]=i;else if(i<2048){t[r++]=i>>6|192;t[r++]=63&i|128}else if(55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))){i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n));t[r++]=i>>18|240;t[r++]=i>>12&63|128;t[r++]=i>>6&63|128;t[r++]=63&i|128}else{t[r++]=i>>12|224;t[r++]=i>>6&63|128;t[r++]=63&i|128}}return t};var u=function(e){var t=[],r=0,n=0;while(r<e.length){var i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var o=e[r++];var a=e[r++];var s=e[r++];var u=((7&i)<<18|(63&o)<<12|(63&a)<<6|63&s)-65536;t[n++]=String.fromCharCode(55296+(u>>10));t[n++]=String.fromCharCode(56320+(1023&u))}else{var o=e[r++];var a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return t.join("")};var c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_;var n=[];for(var i=0;i<e.length;i+=3){var o=e[i];var a=i+1<e.length;var s=a?e[i+1]:0;var u=i+2<e.length;var c=u?e[i+2]:0;var l=o>>2;var h=(3&o)<<4|s>>4;var p=(15&s)<<2|c>>6;var f=63&c;if(!u){f=64;a||(p=64)}n.push(r[l],r[h],r[p],r[f])}return n.join("")},encodeString:function(e,t){if(this.HAS_NATIVE_SUPPORT&&!t)return btoa(e);return this.encodeByteArray(s(e),t)},decodeString:function(e,t){if(this.HAS_NATIVE_SUPPORT&&!t)return atob(e);return u(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();var r=t?this.charToByteMapWebSafe_:this.charToByteMap_;var n=[];for(var i=0;i<e.length;){var o=r[e.charAt(i++)];var a=i<e.length;var s=a?r[e.charAt(i)]:0;++i;var u=i<e.length;var c=u?r[e.charAt(i)]:64;++i;var l=i<e.length;var h=l?r[e.charAt(i)]:64;++i;if(null==o||null==s||null==c||null==h)throw Error();var p=o<<2|s>>4;n.push(p);if(64!=c){var f=s<<4&240|c>>2;n.push(f);if(64!=h){var d=c<<6&192|h;n.push(d)}}}return n},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={};this.charToByteMap_={};this.byteToCharMapWebSafe_={};this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++){this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e);this.charToByteMap_[this.byteToCharMap_[e]]=e;this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e);this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e;if(e>=this.ENCODED_VALS_BASE.length){this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e;this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e}}}}};var l=function(e){var t=s(e);return c.encodeByteArray(t,true)};var h=function(e){try{return c.decodeString(e,true)}catch(e){console.error("base64Decode failed: ",e)}return null};function p(e){return f(void 0,e)}function f(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:var r=t;return new Date(r.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t){if(!t.hasOwnProperty(n))continue;e[n]=f(e[n],t[n])}return e}function d(e,t,r){e[t]=r}var v=function(){function e(){var e=this;this.promise=new Promise(function(t,r){e.resolve=t;e.reject=r})}e.prototype.wrapCallback=function(e){var t=this;return function(r,n){r?t.reject(r):t.resolve(n);if("function"===typeof e){t.promise.catch(function(){});1===e.length?e(r):e(r,n)}}};return e}();var _=function(){return"undefined"!==typeof navigator&&"string"===typeof navigator["userAgent"]?navigator["userAgent"]:""};var y=function(){return"undefined"!==typeof window&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_())};var g=function(){return"object"===typeof navigator&&"ReactNative"===navigator["product"]};var m=function(){return true===i.NODE_CLIENT||true===i.NODE_ADMIN};var b="FirebaseError";var E=Error.captureStackTrace;function w(e){var t=E;E=e;return t}var C=function(){function e(e,t){this.code=e;this.message=t;if(E)E(this,T.prototype.create);else try{throw Error.apply(this,arguments)}catch(e){this.name=b;Object.defineProperty(this,"stack",{get:function(){return e.stack}})}}return e}();C.prototype=Object.create(Error.prototype);C.prototype.constructor=C;C.prototype.name=b;var T=function(){function e(e,t,r){this.service=e;this.serviceName=t;this.errors=r;this.pattern=/\{\$([^}]+)}/g}e.prototype.create=function(e,t){void 0===t&&(t={});var r=this.errors[e];var n=this.service+"/"+e;var i;i=void 0===r?"Error":r.replace(this.pattern,function(e,r){var n=t[r];return void 0!==n?n.toString():"<"+r+"?>"});i=this.serviceName+": "+i+" ("+n+").";var o=new C(n,i);for(var a in t){if(!t.hasOwnProperty(a)||"_"===a.slice(-1))continue;o[a]=t[a]}return o};return e}();function S(e){return JSON.parse(e)}function R(e){return JSON.stringify(e)}var N=function(e){var t={},r={},n={},i="";try{var o=e.split(".");t=S(h(o[0])||"");r=S(h(o[1])||"");i=o[2];n=r["d"]||{};delete r["d"]}catch(e){}return{header:t,claims:r,data:n,signature:i}};var O=function(e){var t=N(e).claims,r=Math.floor((new Date).getTime()/1e3),n,i;if("object"===typeof t){t.hasOwnProperty("nbf")?n=t["nbf"]:t.hasOwnProperty("iat")&&(n=t["iat"]);i=t.hasOwnProperty("exp")?t["exp"]:n+86400}return r&&n&&i&&r>=n&&r<=i};var P=function(e){var t=N(e).claims;if("object"===typeof t&&t.hasOwnProperty("iat"))return t["iat"];return null};var I=function(e){var t=N(e),r=t.claims;return!!t.signature&&!!r&&"object"===typeof r&&r.hasOwnProperty("iat")};var x=function(e){var t=N(e).claims;return"object"===typeof t&&true===t["admin"]};var k=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var A=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};var D=function(e,t){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])};var L=function(e,t){D(t,function(t,r){e[t]=r});return e};var F=function(e){return L({},e)};var j=function(e){return"object"===typeof e&&null!==e};var M=function(e){for(var t in e)return false;return true};var U=function(e){var t=0;for(var r in e)t++;return t};var W=function(e,t,r){var n={};for(var i in e)n[i]=t.call(r,e[i],i,e);return n};var q=function(e,t,r){for(var n in e)if(t.call(r,e[n],n,e))return n;return};var V=function(e,t,r){var n=q(e,t,r);return n&&e[n]};var B=function(e){for(var t in e)return t};var Q=function(e){var t=[];var r=0;for(var n in e)t[r++]=e[n];return t};var H=function(e,t){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&!t(r,e[r]))return false;return true};var G=function(e){var t=[];D(e,function(e,r){Array.isArray(r)?r.forEach(function(r){t.push(encodeURIComponent(e)+"="+encodeURIComponent(r))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(r))});return t.length?"&"+t.join("&"):""};var z=function(e){var t={};var r=e.replace(/^\?/,"").split("&");r.forEach(function(e){if(e){var r=e.split("=");t[r[0]]=r[1]}});return t};var K=function(){function e(){this.blockSize=-1}return e}();var Y=function(e){n.__extends(t,e);function t(){var t=e.call(this)||this;t.chain_=[];t.buf_=[];t.W_=[];t.pad_=[];t.inbuf_=0;t.total_=0;t.blockSize=64;t.pad_[0]=128;for(var r=1;r<t.blockSize;++r)t.pad_[r]=0;t.reset();return t}t.prototype.reset=function(){this.chain_[0]=1732584193;this.chain_[1]=4023233417;this.chain_[2]=2562383102;this.chain_[3]=271733878;this.chain_[4]=3285377520;this.inbuf_=0;this.total_=0};t.prototype.compress_=function(e,t){t||(t=0);var r=this.W_;if("string"===typeof e)for(var n=0;n<16;n++){r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3);t+=4}else for(var n=0;n<16;n++){r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];t+=4}for(var n=16;n<80;n++){var i=r[n-3]^r[n-8]^r[n-14]^r[n-16];r[n]=4294967295&(i<<1|i>>>31)}var o=this.chain_[0];var a=this.chain_[1];var s=this.chain_[2];var u=this.chain_[3];var c=this.chain_[4];var l,h;for(var n=0;n<80;n++){if(n<40)if(n<20){l=u^a&(s^u);h=1518500249}else{l=a^s^u;h=1859775393}else if(n<60){l=a&s|u&(a|s);h=2400959708}else{l=a^s^u;h=3395469782}var i=(o<<5|o>>>27)+l+c+h+r[n]&4294967295;c=u;u=s;s=4294967295&(a<<30|a>>>2);a=o;o=i}this.chain_[0]=this.chain_[0]+o&4294967295;this.chain_[1]=this.chain_[1]+a&4294967295;this.chain_[2]=this.chain_[2]+s&4294967295;this.chain_[3]=this.chain_[3]+u&4294967295;this.chain_[4]=this.chain_[4]+c&4294967295};t.prototype.update=function(e,t){if(null==e)return;void 0===t&&(t=e.length);var r=t-this.blockSize;var n=0;var i=this.buf_;var o=this.inbuf_;while(n<t){if(0==o)while(n<=r){this.compress_(e,n);n+=this.blockSize}if("string"===typeof e)while(n<t){i[o]=e.charCodeAt(n);++o;++n;if(o==this.blockSize){this.compress_(i);o=0;break}}else while(n<t){i[o]=e[n];++o;++n;if(o==this.blockSize){this.compress_(i);o=0;break}}}this.inbuf_=o;this.total_+=t};t.prototype.digest=function(){var e=[];var t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var r=this.blockSize-1;r>=56;r--){this.buf_[r]=255&t;t/=256}this.compress_(this.buf_);var n=0;for(var r=0;r<5;r++)for(var i=24;i>=0;i-=8){e[n]=this.chain_[r]>>i&255;++n}return e};return t}(K);function X(e,t){var r=new $(e,t);return r.subscribe.bind(r)}var $=function(){function e(e,t){var r=this;this.observers=[];this.unsubscribes=[];this.observerCount=0;this.task=Promise.resolve();this.finalized=false;this.onNoObservers=t;this.task.then(function(){e(r)}).catch(function(e){r.error(e)})}e.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})};e.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)});this.close(e)};e.prototype.complete=function(){this.forEachObserver(function(e){e.complete()});this.close()};e.prototype.subscribe=function(e,t,r){var n=this;var i;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");i=Z(e,["next","error","complete"])?e:{next:e,error:t,complete:r};void 0===i.next&&(i.next=ee);void 0===i.error&&(i.error=ee);void 0===i.complete&&(i.complete=ee);var o=this.unsubscribeOne.bind(this,this.observers.length);this.finalized&&this.task.then(function(){try{n.finalError?i.error(n.finalError):i.complete()}catch(e){}return});this.observers.push(i);return o};e.prototype.unsubscribeOne=function(e){if(void 0===this.observers||void 0===this.observers[e])return;delete this.observers[e];this.observerCount-=1;0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this)};e.prototype.forEachObserver=function(e){if(this.finalized)return;for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)};e.prototype.sendOne=function(e,t){var r=this;this.task.then(function(){if(void 0!==r.observers&&void 0!==r.observers[e])try{t(r.observers[e])}catch(e){"undefined"!==typeof console&&console.error&&console.error(e)}})};e.prototype.close=function(e){var t=this;if(this.finalized)return;this.finalized=true;void 0!==e&&(this.finalError=e);this.task.then(function(){t.observers=void 0;t.onNoObservers=void 0})};return e}();function J(e,t){return function(){var r=[];for(var n=0;n<arguments.length;n++)r[n]=arguments[n];Promise.resolve(true).then(function(){e.apply(void 0,r)}).catch(function(e){t&&t(e)})}}function Z(e,t){if("object"!==typeof e||null===e)return false;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i in e&&"function"===typeof e[i])return true}return false}function ee(){}var te=function(e,t,r,n){var i;n<t?i="at least "+t:n>r&&(i=0===r?"none":"no more than "+r);if(i){var o=e+" failed: Was called with "+n+(1===n?" argument.":" arguments.")+" Expects "+i+".";throw new Error(o)}};function re(e,t,r){var n="";switch(t){case 1:n=r?"first":"First";break;case 2:n=r?"second":"Second";break;case 3:n=r?"third":"Third";break;case 4:n=r?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";i+=n+" argument ";return i}function ne(e,t,r,n){if(n&&!r)return;if("string"!==typeof r)throw new Error(re(e,t,n)+"must be a valid firebase namespace.")}function ie(e,t,r,n){if(n&&!r)return;if("function"!==typeof r)throw new Error(re(e,t,n)+"must be a valid function.")}function oe(e,t,r,n){if(n&&!r)return;if("object"!==typeof r||null===r)throw new Error(re(e,t,n)+"must be a valid context object.")}var ae=function(e){var t=[],r=0;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i>=55296&&i<=56319){var a=i-55296;n++;o(n<e.length,"Surrogate pair missing trail surrogate.");var s=e.charCodeAt(n)-56320;i=65536+(a<<10)+s}if(i<128)t[r++]=i;else if(i<2048){t[r++]=i>>6|192;t[r++]=63&i|128}else if(i<65536){t[r++]=i>>12|224;t[r++]=i>>6&63|128;t[r++]=63&i|128}else{t[r++]=i>>18|240;t[r++]=i>>12&63|128;t[r++]=i>>6&63|128;t[r++]=63&i|128}}return t};var se=function(e){var t=0;for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n<128)t++;else if(n<2048)t+=2;else if(n>=55296&&n<=56319){t+=4;r++}else t+=3}return t};t.assert=o;t.assertionError=a;t.base64=c;t.base64Decode=h;t.base64Encode=l;t.CONSTANTS=i;t.deepCopy=p;t.deepExtend=f;t.patchProperty=d;t.Deferred=v;t.getUA=_;t.isMobileCordova=y;t.isNodeSdk=m;t.isReactNative=g;t.ErrorFactory=T;t.FirebaseError=C;t.patchCapture=w;t.jsonEval=S;t.stringify=R;t.decode=N;t.isAdmin=x;t.issuedAtTime=P;t.isValidFormat=I;t.isValidTimestamp=O;t.clone=F;t.contains=k;t.every=H;t.extend=L;t.findKey=q;t.findValue=V;t.forEach=D;t.getAnyKey=B;t.getCount=U;t.getValues=Q;t.isEmpty=M;t.isNonNullObject=j;t.map=W;t.safeGet=A;t.querystring=G;t.querystringDecode=z;t.Sha1=Y;t.async=J;t.createSubscribe=X;t.errorPrefix=re;t.validateArgCount=te;t.validateCallback=ie;t.validateContextObject=oe;t.validateNamespace=ne;t.stringLength=se;t.stringToByteArray=ae},"./node_modules/cancelable-promise/dist/CancelablePromise.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;"value"in n&&(n.writable=true);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function e(t,r,n,i){try{t(n(i))}catch(e){r(e)}};var a=function(){n(e,null,[{key:"all",value:function t(r){return new e(function(e,t){Promise.all(r).then(e,t)})}},{key:"race",value:function t(r){return new e(function(e,t){Promise.race(r).then(e,t)})}},{key:"reject",value:function t(r){return new e(function(e,t){Promise.reject(r).then(e,t)})}},{key:"resolve",value:function t(r){return new e(function(e,t){Promise.resolve(r).then(e,t)})}}]);function e(t){i(this,e);this._promise=new Promise(t);this._canceled=false}n(e,[{key:"then",value:function t(r,n){var i=this;var a=new e(function(e,t){i._promise.then(function(n){i._canceled&&a.cancel();r&&!i._canceled?o(e,t,r,n):e(n)},function(r){i._canceled&&a.cancel();n&&!i._canceled?o(e,t,n,r):t(r)})});return a}},{key:"catch",value:function e(t){return this.then(void 0,t)}},{key:"cancel",value:function e(){this._canceled=true;return this}}]);return e}();t.default=a},"./node_modules/exenv/index.js":function(e,t,r){var n;
/*!
  Copyright (c) 2015 Jed Watson.
  Based on code that is Copyright 2013-2015, Facebook, Inc.
  All rights reserved.
*/
/*!
  Copyright (c) 2015 Jed Watson.
  Based on code that is Copyright 2013-2015, Facebook, Inc.
  All rights reserved.
*/
(function(){"use strict";var i=!!("undefined"!==typeof window&&window.document&&window.document.createElement);var o={canUseDOM:i,canUseWorkers:"undefined"!==typeof Worker,canUseEventListeners:i&&!!(window.addEventListener||window.attachEvent),canUseViewport:i&&!!window.screen};true;!(n=function(){return o}.call(t,r,t,e),void 0!==n&&(e.exports=n))})()},"./node_modules/firebase/app/dist/index.cjs.js":function(e,t,r){"use strict";function n(e){return e&&"object"===typeof e&&"default"in e?e["default"]:e}r("./node_modules/@firebase/polyfill/dist/index.esm.js");var i=n(r("./node_modules/@firebase/app/dist/index.cjs.js"));e.exports=i},"./node_modules/firebase/auth/dist/index.esm.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/@firebase/auth/dist/auth.esm.js")},"./node_modules/firebase/database/dist/index.esm.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/@firebase/database/dist/index.cjs.js");var i=r.n(n)},"./node_modules/firebase/storage/dist/index.esm.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/@firebase/storage/dist/index.esm.js")},"./node_modules/react-helmet/node_modules/fbjs/lib/emptyFunction.js":function(e,t,r){"use strict";function n(e){return function(){return e}}var i=function e(){};i.thatReturns=n;i.thatReturnsFalse=n(false);i.thatReturnsTrue=n(true);i.thatReturnsNull=n(null);i.thatReturnsThis=function(){return this};i.thatReturnsArgument=function(e){return e};e.exports=i},"./node_modules/react-helmet/node_modules/fbjs/lib/invariant.js":function(e,t,r){"use strict";var n=function e(t){};false;function i(e,t,r,i,o,a,s,u){n(t);if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[r,i,o,a,s,u];var h=0;c=new Error(t.replace(/%s/g,function(){return l[h++]}));c.name="Invariant Violation"}c.framesToPop=1;throw c}}e.exports=i},"./node_modules/react-helmet/node_modules/prop-types/lib/ReactPropTypesSecret.js":function(e,t,r){"use strict";var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";e.exports=n},"./node_modules/redux-immutable/dist/combineReducers.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/immutable/dist/immutable.js");var i=a(n);var o=r("./node_modules/redux-immutable/dist/utilities/index.js");function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.Map;var r=Object.keys(e);return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t();var i=arguments[1];var a;false;return n.withMutations(function(t){r.forEach(function(r){var n=e[r];var a=t.get(r);var s=n(a,i);(0,o.validateNextState)(s,r,i);t.set(r,s)})})}};e.exports=t["default"]},"./node_modules/redux-immutable/dist/index.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.combineReducers=void 0;var n=r("./node_modules/redux-immutable/dist/combineReducers.js");var i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}t.combineReducers=i.default},"./node_modules/redux-immutable/dist/utilities/getStateName.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=function(e){return e&&"@@redux/INIT"===e.type?"initialState argument passed to createStore":"previous state received by the reducer"};e.exports=t["default"]},"./node_modules/redux-immutable/dist/utilities/getUnexpectedInvocationParameterMessage.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/immutable/dist/immutable.js");var i=s(n);var o=r("./node_modules/redux-immutable/dist/utilities/getStateName.js");var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,r){var n=Object.keys(t);if(!n.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";var o=(0,a.default)(r);if(!i.default.Iterable.isIterable(e))return"The "+o+' is of unexpected type. Expected argument to be an instance of Immutable.Iterable with the following properties: "'+n.join('", "')+'".';var s=e.keySeq().toArray().filter(function(e){return!t.hasOwnProperty(e)});if(s.length>0)return"Unexpected "+(1===s.length?"property":"properties")+' "'+s.join('", "')+'" found in '+o+'. Expected to find one of the known reducer property names instead: "'+n.join('", "')+'". Unexpected properties will be ignored.';return null};e.exports=t["default"]},"./node_modules/redux-immutable/dist/utilities/index.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.validateNextState=t.getUnexpectedInvocationParameterMessage=t.getStateName=void 0;var n=r("./node_modules/redux-immutable/dist/utilities/getStateName.js");var i=c(n);var o=r("./node_modules/redux-immutable/dist/utilities/getUnexpectedInvocationParameterMessage.js");var a=c(o);var s=r("./node_modules/redux-immutable/dist/utilities/validateNextState.js");var u=c(s);function c(e){return e&&e.__esModule?e:{default:e}}t.getStateName=i.default;t.getUnexpectedInvocationParameterMessage=a.default;t.validateNextState=u.default},"./node_modules/redux-immutable/dist/utilities/validateNextState.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=function(e,t,r){if(void 0===e)throw new Error('Reducer "'+t+'" returned undefined when handling "'+r.type+'" action. To ignore an action, you must explicitly return the previous state.')};e.exports=t["default"]},"./node_modules/shallowequal/index.js":function(e,t){e.exports=function e(t,r,n,i){var o=n?n.call(i,t,r):void 0;if(void 0!==o)return!!o;if(t===r)return true;if("object"!==typeof t||!t||"object"!==typeof r||!r)return false;var a=Object.keys(t);var s=Object.keys(r);if(a.length!==s.length)return false;var u=Object.prototype.hasOwnProperty.bind(r);for(var c=0;c<a.length;c++){var l=a[c];if(!u(l))return false;var h=t[l];var p=r[l];o=n?n.call(i,h,p,l):void 0;if(false===o||void 0===o&&h!==p)return false}return true}},"./node_modules/tslib/tslib.es6.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t["__extends"]=i;r.d(t,"__assign",function(){return o});t["__rest"]=a;t["__decorate"]=s;t["__param"]=u;t["__metadata"]=c;t["__awaiter"]=l;t["__generator"]=h;t["__exportStar"]=p;t["__values"]=f;t["__read"]=d;t["__spread"]=v;t["__await"]=_;t["__asyncGenerator"]=y;t["__asyncDelegator"]=g;t["__asyncValues"]=m;t["__makeTemplateObject"]=b;t["__importStar"]=E;t["__importDefault"]=w;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};function i(e,t){n(e,t);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var o=Object.assign||function e(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t};function a(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&(r[n[i]]=e[n[i]]);return r}function s(e,t,r,n){var i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n,a;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}function u(e,t){return function(r,n){t(r,n,e)}}function c(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n["throw"](e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})}function h(e,t){var r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return u([e,t])}}function u(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(o=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(i,a[1])).done)return o;(i=0,o)&&(a=[0,o.value]);switch(a[0]){case 0:case 1:o=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;i=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1];o=a;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(a);break}o[2]&&r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:true}}}function p(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function f(e){var t="function"===typeof Symbol&&e[Symbol.iterator],r=0;if(t)return t.call(e);return{next:function(){e&&r>=e.length&&(e=void 0);return{value:e&&e[r++],done:!e}}}}function d(e,t){var r="function"===typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{while((void 0===t||t-- >0)&&!(i=n.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{i&&!i.done&&(r=n["return"])&&r.call(n)}finally{if(a)throw a.error}}return o}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function y(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(e){n[e]&&(i[e]=function(t){return new Promise(function(r,n){o.push([e,t,r,n])>1||s(e,t)})})}function s(e,t){try{u(n[e](t))}catch(e){h(o[0][3],e)}}function u(e){e.value instanceof _?Promise.resolve(e.value.v).then(c,l):h(o[0][2],e)}function c(e){s("next",e)}function l(e){s("throw",e)}function h(e,t){(e(t),o.shift(),o.length)&&s(o[0][0],o[0][1])}}function g(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){e[n]&&(t[n]=function(t){return(r=!r)?{value:_(e[n](t)),done:"return"===n}:i?i(t):t})}}function m(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"===typeof f?f(e):e[Symbol.iterator]()}function b(e,t){Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t;return e}function E(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t}function w(e){return e&&e.__esModule?e:{default:e}}},"./space/models/StateCodeBlocks.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/immutable/dist/immutable.js");function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(e){a(t,e);function t(){i(this,t);return o(this,e.apply(this,arguments))}t.prototype.selectCodeTab=function e(t,r){return this.merge({activeKeys:this.activeKeys.set(t.key,r.key),activeSyntax:r.data.get("syntax")})};t.prototype.getSelectedTabFor=function e(t,r,n){var i=n.readOnly;var o=this.activeKeys,a=this.activeSyntax;var s=o.get(r.key);return(i?null:r.nodes.find(function(e){return t.selection.hasAnchorIn(e)||t.selection.hasFocusIn(e)}))||(s?r.nodes.find(function(e){return e.key==s}):null)||(a?r.nodes.find(function(e){return e.data.get("syntax")==a}):null)||r.nodes.first()};t.prototype.isTabSelected=function e(t,r,n){var i=n.readOnly;var o=t.document;var a=o.getParent(r.key);if(!a)return false;return this.getSelectedTabFor(t,a,{readOnly:i}).key==r.key};return t}((0,n.Record)({activeKeys:(0,n.Map)(),activeSyntax:null}));t.default=s},"./space/models/StateDiff.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./node_modules/immutable/dist/immutable.js");function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s={active:false};var u=function(e){a(t,e);function t(){i(this,t);return o(this,e.apply(this,arguments))}t.prototype.toggleDiff=function e(t){return this.merge({active:t})};return t}((0,n.Record)(s));t.default=u},"./space/models/StateSearch.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.QueryResults=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;"value"in n&&(n.writable=true);Object.defineProperty(e,n.key,n)}}return function(t,r,n){r&&e(t.prototype,r);n&&e(t,n);return t}}();var i=r("./node_modules/immutable/dist/immutable.js");function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(e){s(t,e);function t(){o(this,t);return a(this,e.apply(this,arguments))}n(t,[{key:"all",get:function e(){var t=this.pages,r=this.sections,n=this.users;return r.concat(t,n)}}]);return t}((0,i.Record)({lastUpdated:new Date,users:(0,i.List)(),pages:(0,i.List)(),sections:(0,i.List)()}));var c=6e4;var l=function(e){s(t,e);function t(){o(this,t);return a(this,e.apply(this,arguments))}t.deserialize=function e(r){return new t({})};t.prototype.serialize=function e(){return{}};t.prototype.isOutdated=function e(t){var r=this.queries;var n=r.get(t);if(!n||Date.now()-n.lastUpdated>c)return true;return false};t.prototype.getResults=function e(t){return this.queries.get(t)||null};t.prototype.setResults=function e(t,r,n){var i;var o=this.queries;var a=o.get(t,new u);a=a.merge((i={lastUpdated:new Date},i[r]=n,i));return this.merge({queries:o.set(t,a)})};return t}((0,i.Record)({queries:(0,i.Map)()}));t.default=l;t.QueryResults=u},"./space/reducers/codeBlocks.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./space/constants/ACTIONS.js");var i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){switch(t.type){case i.default.CODEBLOCKS_TAB_SELECT:return e.selectCodeTab(t.codeBlock,t.tab);default:return e}}t.default=a},"./space/reducers/diff.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./space/constants/ACTIONS.js");var i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){switch(t.type){case i.default.DIFF_TOGGLE:return e.toggleDiff(t.diffActive);default:return e}}t.default=a},"./space/reducers/documents.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./space/constants/ACTIONS.js");var i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){switch(t.type){case i.default.DOCUMENTS_FETCHED:return e.setDocumentsByURL(t.documents);default:return e}}t.default=a},"./space/reducers/edition.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./space/constants/ACTIONS.js");var i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){switch(t.type){case i.default.EDITION_START:return e.start(t.base);case i.default.EDITION_DISCARD:return e.discard();case i.default.EDITION_REDO:return e.redo();case i.default.EDITION_UNDO:return e.undo();case i.default.EDITION_RESTORE:return e.restore(t.state);case i.default.EDITION_PAGE_UPDATE:return e.push(e.working.change().setPage(t.version,t.page).state);case i.default.EDITION_PAGE_UPDATE_PATH:var r=t.page,n=t.version,o=t.path;var a=n.page.getParentOf(r);var s=a.getNewPath(o);return e.push(e.working.change().updatePagePath(n,r,s).state);case i.default.EDITION_PAGE_UPDATE_TITLE:return e.push(e.working.change().updatePageTitle(t.version,t.page,t.title).state);case i.default.EDITION_PAGE_INSERT:return e.push(e.working.change().insertPage(t.version,t.parent,t.index,t.page).state);case i.default.EDITION_PAGE_REMOVE:return e.push(e.working.change().removePage(t.version,t.page).state);case i.default.EDITION_PAGE_MOVE:return e.push(e.working.change().movePage(t.version,t.page,t.parent,t.index).state);case i.default.EDITION_EDITORSTATE_UPDATE:return e.setEditorState(t.version,t.page,t.prevEditor,t.editorState);case i.default.EDITION_ASSET_CREATE:return e.push(e.working.change().createAsset(t.asset).state);case i.default.EDITION_ASSET_REMOVE:return e.push(e.working.change().removeAsset(t.asset).state);case i.default.EDITION_VERSION_CREATE:return e.push(e.working.change().createVersion(t.version).state);case i.default.EDITION_VERSION_REMOVE:return e.push(e.working.change().deleteVersion(t.version).state);case i.default.EDITION_VERSION_MOVE:return e.push(e.working.change().moveVersion(t.oldIndex,t.newIndex).state);case i.default.EDITION_VERSION_UPDATE_TITLE:return e.push(e.working.change().updateVersionTitle(t.version,t.title).state);case i.default.EDITION_VERSION_UPDATE_REF:return e.push(e.working.change().updateVersionRef(t.version,t.ref).state);case i.default.EDITION_VERSION_SETPRIMARY:return e.push(e.working.change().markVersionAsPrimary(t.version).state);case i.default.CONFLICT_START:return e.startConflictResolution(t.state);case i.default.CONFLICT_CANCEL:return e.cancelConflictResolution();case i.default.CONFLICT_SET_STATUS:return e.markPageAsResolved(t.version,t.page,t.resolved);case i.default.CONFLICT_TOGGLE_SHOW_ONLY_CONFLICTS:return e.toggleShowingOnlyConflicts();default:return e}}t.default=a},"./space/reducers/navigationPanel.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./space/constants/ACTIONS.js");var i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){switch(t.type){case i.default.NAVIGATION_PANEL_CREATE_RELEASE:return e.openReleaseCreate(t.versionID);case i.default.NAVIGATION_PANEL_EDIT_RELEASE:return e.toggleReleaseEdit(t.versionID);case i.default.NAVIGATION_PANEL_CREATE_PAGE_GROUP:return e.openPageGroupCreate();case i.default.NAVIGATION_PANEL_EDIT_PAGE_GROUP:return e.togglePageGroupEdit(t.pageID);case i.default.NAVIGATION_PANEL_CREATE_PAGE_LINK:return e.openPageLinkCreate(t.parentID,t.index);case i.default.NAVIGATION_PANEL_EDIT_PAGE_LINK:return e.togglePageLinkEdit(t.pageID);case i.default.NAVIGATION_PANEL_CLOSE:return e.close();default:return e}}t.default=a},"./space/reducers/search.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./space/constants/ACTIONS.js");var i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){switch(t.type){case i.default.SEARCH_FETCHED:var r=t.query,n=t.results;return n.reduce(function(e,t,n){return e.setResults(r,n,t)},e);default:return e}}t.default=a},"./space/reducers/sidebarExpanded.js":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r("./space/constants/ACTIONS.js");var i=o(n);function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){switch(t.type){case i.default.SIDEBAR_OPEN:return true;case i.default.SIDEBAR_CLOSE:return false;default:return e}}t.default=a},24:function(e,t,r){"use strict";var n=r("./node_modules/react-helmet/node_modules/fbjs/lib/emptyFunction.js");var i=r("./node_modules/react-helmet/node_modules/fbjs/lib/invariant.js");var o=r("./node_modules/react-helmet/node_modules/prop-types/lib/ReactPropTypesSecret.js");e.exports=function(){function e(e,t,r,n,a,s){if(s===o)return;i(false,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}e.isRequired=e;function t(){return e}var r={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t};r.checkPropTypes=n;r.PropTypes=r;return r}}});
//# space-part-47.7ea60df2.js.map